/*! For license information please see vendors.9457e56317cc89c71cff.js.LICENSE.txt */
(self.webpackChunkchtosar_github_io=self.webpackChunkchtosar_github_io||[]).push([[96],{17:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AnsiStringType:()=>N,Float16_BE:()=>v,Float16_LE:()=>S,Float32_BE:()=>x,Float32_LE:()=>E,Float64_BE:()=>C,Float64_LE:()=>A,Float80_BE:()=>_,Float80_LE:()=>z,INT16_BE:()=>h,INT16_LE:()=>p,INT24_BE:()=>g,INT24_LE:()=>f,INT32_BE:()=>k,INT32_LE:()=>T,INT64_BE:()=>I,INT64_LE:()=>w,INT8:()=>d,IgnoreType:()=>F,StringType:()=>D,UINT16_BE:()=>o,UINT16_LE:()=>s,UINT24_BE:()=>l,UINT24_LE:()=>c,UINT32_BE:()=>m,UINT32_LE:()=>u,UINT64_BE:()=>y,UINT64_LE:()=>b,UINT8:()=>n,Uint8ArrayType:()=>B});var i=a(251);function r(e){return new DataView(e.buffer,e.byteOffset)}const n={len:1,get:(e,t)=>r(e).getUint8(t),put:(e,t,a)=>(r(e).setUint8(t,a),t+1)},s={len:2,get:(e,t)=>r(e).getUint16(t,!0),put:(e,t,a)=>(r(e).setUint16(t,a,!0),t+2)},o={len:2,get:(e,t)=>r(e).getUint16(t),put:(e,t,a)=>(r(e).setUint16(t,a),t+2)},c={len:3,get(e,t){const a=r(e);return a.getUint8(t)+(a.getUint16(t+1,!0)<<8)},put(e,t,a){const i=r(e);return i.setUint8(t,255&a),i.setUint16(t+1,a>>8,!0),t+3}},l={len:3,get(e,t){const a=r(e);return(a.getUint16(t)<<8)+a.getUint8(t+2)},put(e,t,a){const i=r(e);return i.setUint16(t,a>>8),i.setUint8(t+2,255&a),t+3}},u={len:4,get:(e,t)=>r(e).getUint32(t,!0),put:(e,t,a)=>(r(e).setUint32(t,a,!0),t+4)},m={len:4,get:(e,t)=>r(e).getUint32(t),put:(e,t,a)=>(r(e).setUint32(t,a),t+4)},d={len:1,get:(e,t)=>r(e).getInt8(t),put:(e,t,a)=>(r(e).setInt8(t,a),t+1)},h={len:2,get:(e,t)=>r(e).getInt16(t),put:(e,t,a)=>(r(e).setInt16(t,a),t+2)},p={len:2,get:(e,t)=>r(e).getInt16(t,!0),put:(e,t,a)=>(r(e).setInt16(t,a,!0),t+2)},f={len:3,get(e,t){const a=c.get(e,t);return a>8388607?a-16777216:a},put(e,t,a){const i=r(e);return i.setUint8(t,255&a),i.setUint16(t+1,a>>8,!0),t+3}},g={len:3,get(e,t){const a=l.get(e,t);return a>8388607?a-16777216:a},put(e,t,a){const i=r(e);return i.setUint16(t,a>>8),i.setUint8(t+2,255&a),t+3}},k={len:4,get:(e,t)=>r(e).getInt32(t),put:(e,t,a)=>(r(e).setInt32(t,a),t+4)},T={len:4,get:(e,t)=>r(e).getInt32(t,!0),put:(e,t,a)=>(r(e).setInt32(t,a,!0),t+4)},b={len:8,get:(e,t)=>r(e).getBigUint64(t,!0),put:(e,t,a)=>(r(e).setBigUint64(t,a,!0),t+8)},w={len:8,get:(e,t)=>r(e).getBigInt64(t,!0),put:(e,t,a)=>(r(e).setBigInt64(t,a,!0),t+8)},y={len:8,get:(e,t)=>r(e).getBigUint64(t),put:(e,t,a)=>(r(e).setBigUint64(t,a),t+8)},I={len:8,get:(e,t)=>r(e).getBigInt64(t),put:(e,t,a)=>(r(e).setBigInt64(t,a),t+8)},v={len:2,get(e,t){return i.L(e,t,!1,10,this.len)},put(e,t,a){return i.M(e,a,t,!1,10,this.len),t+this.len}},S={len:2,get(e,t){return i.L(e,t,!0,10,this.len)},put(e,t,a){return i.M(e,a,t,!0,10,this.len),t+this.len}},x={len:4,get:(e,t)=>r(e).getFloat32(t),put:(e,t,a)=>(r(e).setFloat32(t,a),t+4)},E={len:4,get:(e,t)=>r(e).getFloat32(t,!0),put:(e,t,a)=>(r(e).setFloat32(t,a,!0),t+4)},C={len:8,get:(e,t)=>r(e).getFloat64(t),put:(e,t,a)=>(r(e).setFloat64(t,a),t+8)},A={len:8,get:(e,t)=>r(e).getFloat64(t,!0),put:(e,t,a)=>(r(e).setFloat64(t,a,!0),t+8)},_={len:10,get(e,t){return i.L(e,t,!1,63,this.len)},put(e,t,a){return i.M(e,a,t,!1,63,this.len),t+this.len}},z={len:10,get(e,t){return i.L(e,t,!0,63,this.len)},put(e,t,a){return i.M(e,a,t,!0,63,this.len),t+this.len}};class F{constructor(e){this.len=e}get(e,t){}}class B{constructor(e){this.len=e}get(e,t){return e.subarray(t,t+this.len)}}class D{constructor(e,t){this.len=e,this.encoding=t,this.textDecoder=new TextDecoder(t)}get(e,t){return this.textDecoder.decode(e.subarray(t,t+this.len))}}class N{constructor(e){this.len=e,this.textDecoder=new TextDecoder("windows-1252")}get(e,t=0){return this.textDecoder.decode(e.subarray(t,t+this.len))}}},31:(e,t,a)=>{"use strict";a.d(t,{e:()=>o});var i=a(523),r=a(185),n=a(324);const s=/^[\x21-\x7eÂ©][\x20-\x7e\x00()]{3}/,o={len:4,get:(e,t)=>{const a=(0,i.SW)(e.slice(t,t+o.len),"latin1");if(!a.match(s))throw new n.gP(`FourCC contains invalid characters: ${r.DY(a)} "${a}"`);return a},put:(e,t,a)=>{const r=(0,i.Al)(a);if(4!==r.length)throw new n.nK("Invalid length");return e.set(r,t),t+4}}},46:(e,t,a)=>{"use strict";a.r(t),a.d(t,{DsdContentParseError:()=>h,DsfParser:()=>p});var i=a(833),r=a(481),n=a(17),s=a(31);const o={len:12,get:(e,t)=>({id:s.e.get(e,t),size:n.UINT64_LE.get(e,t+4)})},c={len:16,get:(e,t)=>({fileSize:n.INT64_LE.get(e,t),metadataPointer:n.INT64_LE.get(e,t+8)})},l={len:40,get:(e,t)=>({formatVersion:n.INT32_LE.get(e,t),formatID:n.INT32_LE.get(e,t+4),channelType:n.INT32_LE.get(e,t+8),channelNum:n.INT32_LE.get(e,t+12),samplingFrequency:n.INT32_LE.get(e,t+16),bitsPerSample:n.INT32_LE.get(e,t+20),sampleCount:n.INT64_LE.get(e,t+24),blockSizePerChannel:n.INT32_LE.get(e,t+32)})};var u=a(621),m=a(324);const d=i("music-metadata:parser:DSF");class h extends((0,m.fO)("DSD")){}class p extends r.k{async postId3v2Parse(){const e=this.tokenizer.position,t=await this.tokenizer.readToken(o);if("DSD "!==t.id)throw new h("Invalid chunk signature");this.metadata.setFormat("container","DSF"),this.metadata.setFormat("lossless",!0);const a=await this.tokenizer.readToken(c);if(a.metadataPointer!==BigInt(0))return d(`expect ID3v2 at offset=${a.metadataPointer}`),await this.parseChunks(a.fileSize-t.size),await this.tokenizer.ignore(Number(a.metadataPointer)-this.tokenizer.position-e),(new u.S).parse(this.metadata,this.tokenizer,this.options);d("No ID3v2 tag present")}async parseChunks(e){for(;e>=o.len;){const t=await this.tokenizer.readToken(o);if(d(`Parsing chunk name=${t.id} size=${t.size}`),"fmt "===t.id){const e=await this.tokenizer.readToken(l);this.metadata.setFormat("numberOfChannels",e.channelNum),this.metadata.setFormat("sampleRate",e.samplingFrequency),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("numberOfSamples",e.sampleCount),this.metadata.setFormat("duration",Number(e.sampleCount)/e.samplingFrequency);const t=e.bitsPerSample*e.samplingFrequency*e.channelNum;return void this.metadata.setFormat("bitrate",t)}this.tokenizer.ignore(Number(t.size)-o.len),e-=t.size}}}},185:(e,t,a)=>{"use strict";a.d(t,{DY:()=>d,F6:()=>l,cD:()=>m,f5:()=>u,mh:()=>n,qW:()=>o,sX:()=>s,sc:()=>c,th:()=>h});var i=a(17),r=a(324);function n(e,t,a){return!!(e[t]&1<<a)}function s(e,t,a,i){let r=t;if("utf-16le"===i){for(;0!==e[r]||0!==e[r+1];){if(r>=a)return a;r+=2}return r}for(;0!==e[r];){if(r>=a)return a;r++}return r}function o(e){const t=e.indexOf("\0");return-1===t?e:e.substr(0,t)}function c(e,t){if(255===e[0]&&254===e[1])return c(e.subarray(2),t);if("utf-16le"===t&&254===e[0]&&255===e[1]){if(1&e.length)throw new r.gP("Expected even number of octets for 16-bit unicode string");return c(function(e){const t=e.length;if(1&t)throw new r.gP("Buffer length must be even");for(let a=0;a<t;a+=2){const t=e[a];e[a]=e[a+1],e[a+1]=t}return e}(e),t)}return new i.StringType(e.length,t).get(e,0)}function l(e){return(e=e.replace(/^\x00+/g,"")).replace(/\x00+$/g,"")}function u(e,t,a,i){const r=a%8;let n=e[t+~~(a/8)];n&=255>>r;const s=8-r,o=i-s;return o<0?n>>=8-r-i:o>0&&(n<<=o,n|=u(e,t,a+s,o)),n}function m(e,t,a){return 1===u(e,t,a,1)}function d(e){const t=[];for(let a=0,i=e.length;a<i;a++){const i=Number(e.charCodeAt(a)).toString(16);t.push(1===i.length?`0${i}`:i)}return t.join(" ")}function h(e){const t=e.split(" ").map((e=>e.trim().toLowerCase()));if(t.length>=1){const e=Number.parseFloat(t[0]);return 2===t.length&&"db"===t[1]?{dB:e,ratio:(i=e,10**(i/10))}:{dB:(a=e,10*Math.log10(a)),ratio:e}}var a,i}},191:(e,t,a)=>{"use strict";a.d(t,{Bn:()=>d,jR:()=>l,zc:()=>h});var i=a(833),r=a(17),n=a(185),s=a(604),o=a(283);const c=i("music-metadata:parser:ID3v1"),l=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","Alt. Rock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta Rap","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychedelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast-Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Cappella","Euro-House","Dance Hall","Goa","Drum & Bass","Club-House","Hardcore","Terror","Indie","BritPop","Negerpunk","Polsk Punk","Beat","Christian Gangsta Rap","Heavy Metal","Black Metal","Crossover","Contemporary Christian","Christian Rock","Merengue","Salsa","Thrash Metal","Anime","JPop","Synthpop","Abstract","Art Rock","Baroque","Bhangra","Big Beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math Rock","New Romantic","Nu-Breakz","Post-Punk","Post-Rock","Psytrance","Shoegaze","Space Rock","Trop Rock","World Music","Neoclassical","Audiobook","Audio Theatre","Neue Deutsche Welle","Podcast","Indie Rock","G-Funk","Dubstep","Garage Rock","Psybient"],u={len:128,get:(e,t)=>{const a=new m(3).get(e,t);return"TAG"===a?{header:a,title:new m(30).get(e,t+3),artist:new m(30).get(e,t+33),album:new m(30).get(e,t+63),year:new m(4).get(e,t+93),comment:new m(28).get(e,t+97),zeroByte:r.UINT8.get(e,t+127),track:r.UINT8.get(e,t+126),genre:r.UINT8.get(e,t+127)}:null}};class m{constructor(e){this.len=e,this.stringType=new r.StringType(e,"latin1")}get(e,t){let a=this.stringType.get(e,t);return a=n.qW(a),a=a.trim(),a.length>0?a:void 0}}class d extends s.s{constructor(e,t,a){super(e,t,a),this.apeHeader=a.apeHeader}static getGenre(e){if(e<l.length)return l[e]}async parse(){if(!this.tokenizer.fileInfo.size)return void c("Skip checking for ID3v1 because the file-size is unknown");if(this.apeHeader){this.tokenizer.ignore(this.apeHeader.offset-this.tokenizer.position);const e=new o.APEv2Parser(this.metadata,this.tokenizer,this.options);await e.parseTags(this.apeHeader.footer)}const e=this.tokenizer.fileInfo.size-u.len;if(this.tokenizer.position>e)return void c("Already consumed the last 128 bytes");const t=await this.tokenizer.readToken(u,e);if(t){c("ID3v1 header found at: pos=%s",this.tokenizer.fileInfo.size-u.len);const e=["title","artist","album","comment","track","year"];for(const a of e)t[a]&&""!==t[a]&&await this.addTag(a,t[a]);const a=d.getGenre(t.genre);a&&await this.addTag("genre",a)}else c("ID3v1 header not found at: pos=%s",this.tokenizer.fileInfo.size-u.len)}async addTag(e,t){await this.metadata.addTag("ID3v1",e,t)}}async function h(e){if(e.fileInfo.size>=128){const t=new Uint8Array(3),a=e.position;return await e.readBuffer(t,{position:e.fileInfo.size-128}),e.setPosition(a),"TAG"===new TextDecoder("latin1").decode(t)}return!1}},207:(e,t,a)=>{"use strict";a.d(t,{S:()=>r,vQ:()=>n,yK:()=>i});const i={10:"shot",20:"scene",30:"track",40:"part",50:"album",60:"edition",70:"collection"},r={video:1,audio:2,complex:3,logo:4,subtitle:17,button:18,control:32},n={[r.video]:"video",[r.audio]:"audio",[r.complex]:"complex",[r.logo]:"logo",[r.subtitle]:"subtitle",[r.button]:"button",[r.control]:"control"}},251:(e,t)=>{t.L=function(e,t,a,i,r){var n,s,o=8*r-i-1,c=(1<<o)-1,l=c>>1,u=-7,m=a?r-1:0,d=a?-1:1,h=e[t+m];for(m+=d,n=h&(1<<-u)-1,h>>=-u,u+=o;u>0;n=256*n+e[t+m],m+=d,u-=8);for(s=n&(1<<-u)-1,n>>=-u,u+=i;u>0;s=256*s+e[t+m],m+=d,u-=8);if(0===n)n=1-l;else{if(n===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,i),n-=l}return(h?-1:1)*s*Math.pow(2,n-i)},t.M=function(e,t,a,i,r,n){var s,o,c,l=8*n-r-1,u=(1<<l)-1,m=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:n-1,p=i?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+m>=1?d/c:d*Math.pow(2,1-m))*c>=2&&(s++,c/=2),s+m>=u?(o=0,s=u):s+m>=1?(o=(t*c-1)*Math.pow(2,r),s+=m):(o=t*Math.pow(2,m-1)*Math.pow(2,r),s=0));r>=8;e[a+h]=255&o,h+=p,o/=256,r-=8);for(s=s<<r|o,l+=r;l>0;e[a+h]=255&s,h+=p,s/=256,l-=8);e[a+h-p]|=128*f}},272:(e,t,a)=>{"use strict";a.r(t),a.d(t,{MP4Parser:()=>j});var i=a(833),r=a(17),n=a(604),s=a(191),o=a(31),c=a(324);const l=i("music-metadata:parser:MP4:atom");class u extends((0,c.fO)("MP4")){}const m={len:8,get:(e,t)=>{const a=r.UINT32_BE.get(e,t);if(a<0)throw new u("Invalid atom header length");return{length:BigInt(a),name:new r.StringType(4,"latin1").get(e,t+4)}},put:(e,t,a)=>(r.UINT32_BE.put(e,t,Number(a.length)),o.e.put(e,t+4,a.name))},d=r.UINT64_BE,h={len:4,get:(e,t)=>({type:new r.StringType(4,"ascii").get(e,t)})};class p{constructor(e,t,a){if(e<t)throw new u(`Atom ${a} expected to be ${t}, but specifies ${e} bytes long.`);e>t&&l(`Warning: atom ${a} expected to be ${t}, but was actually ${e} bytes long.`),this.len=e}}const f=(e,t)=>{const a=r.UINT32_BE.get(e,t)-2082844800;return new Date(1e3*a)};class g extends p{constructor(e){super(e,24,"mdhd")}get(e,t){return{version:r.UINT8.get(e,t+0),flags:r.UINT24_BE.get(e,t+1),creationTime:f(e,t+4),modificationTime:f(e,t+8),timeScale:r.UINT32_BE.get(e,t+12),duration:r.UINT32_BE.get(e,t+16),language:r.UINT16_BE.get(e,t+20),quality:r.UINT16_BE.get(e,t+22)}}}class k extends p{constructor(e){super(e,100,"mvhd")}get(e,t){return{version:r.UINT8.get(e,t),flags:r.UINT24_BE.get(e,t+1),creationTime:f(e,t+4),modificationTime:f(e,t+8),timeScale:r.UINT32_BE.get(e,t+12),duration:r.UINT32_BE.get(e,t+16),preferredRate:r.UINT32_BE.get(e,t+20),preferredVolume:r.UINT16_BE.get(e,t+24),previewTime:r.UINT32_BE.get(e,t+72),previewDuration:r.UINT32_BE.get(e,t+76),posterTime:r.UINT32_BE.get(e,t+80),selectionTime:r.UINT32_BE.get(e,t+84),selectionDuration:r.UINT32_BE.get(e,t+88),currentTime:r.UINT32_BE.get(e,t+92),nextTrackID:r.UINT32_BE.get(e,t+96)}}}class T{constructor(e){this.len=e}get(e,t){return{type:{set:r.UINT8.get(e,t+0),type:r.UINT24_BE.get(e,t+1)},locale:r.UINT24_BE.get(e,t+4),value:new r.Uint8ArrayType(this.len-8).get(e,t+8)}}}class b{constructor(e){this.len=e}get(e,t){return{version:r.UINT8.get(e,t),flags:r.UINT24_BE.get(e,t+1),name:new r.StringType(this.len-4,"utf-8").get(e,t+4)}}}class w{constructor(e){this.len=e}get(e,t){return{version:r.UINT8.get(e,t),flags:r.UINT24_BE.get(e,t+1),creationTime:f(e,t+4),modificationTime:f(e,t+8),trackId:r.UINT32_BE.get(e,t+12),duration:r.UINT32_BE.get(e,t+20),layer:r.UINT16_BE.get(e,t+24),alternateGroup:r.UINT16_BE.get(e,t+26),volume:r.UINT16_BE.get(e,t+28)}}}class y{constructor(e){this.len=e}get(e,t){const a=this.len-12;return{dataFormat:o.e.get(e,t),dataReferenceIndex:r.UINT16_BE.get(e,t+10),description:a>0?new r.Uint8ArrayType(a).get(e,t+12):void 0}}}class I{constructor(e){this.len=e}get(e,t){const a=((e,t)=>({version:r.UINT8.get(e,t),flags:r.UINT24_BE.get(e,t+1),numberOfEntries:r.UINT32_BE.get(e,t+4)}))(e,t);t+=8;const i=[];for(let n=0;n<a.numberOfEntries;++n){const a=r.UINT32_BE.get(e,t);t+=r.UINT32_BE.len,i.push(new y(a-r.UINT32_BE.len).get(e,t)),t+=a}return{header:a,table:i}}}const v=8,S=(e,t)=>({version:r.INT16_BE.get(e,t),revision:r.INT16_BE.get(e,t+2),vendor:r.INT32_BE.get(e,t+4)}),x=(e,t)=>({numAudioChannels:r.INT16_BE.get(e,t+0),sampleSize:r.INT16_BE.get(e,t+2),compressionId:r.INT16_BE.get(e,t+4),packetSize:r.INT16_BE.get(e,t+6),sampleRate:r.UINT16_BE.get(e,t+8)+r.UINT16_BE.get(e,t+10)/1e4});class E{constructor(e,t){this.len=e,this.token=t}get(e,t){const a=r.INT32_BE.get(e,t+4);return{version:r.INT8.get(e,t+0),flags:r.INT24_BE.get(e,t+1),numberOfEntries:a,entries:N(e,this.token,t+8,this.len-8,a)}}}const C={len:8,get:(e,t)=>({count:r.INT32_BE.get(e,t+0),duration:r.INT32_BE.get(e,t+4)})};class A extends E{constructor(e){super(e,C)}}const _={len:12,get:(e,t)=>({firstChunk:r.INT32_BE.get(e,t),samplesPerChunk:r.INT32_BE.get(e,t+4),sampleDescriptionId:r.INT32_BE.get(e,t+8)})};class z extends E{constructor(e){super(e,_)}}class F{constructor(e){this.len=e}get(e,t){const a=r.INT32_BE.get(e,t+8);return{version:r.INT8.get(e,t),flags:r.INT24_BE.get(e,t+1),sampleSize:r.INT32_BE.get(e,t+4),numberOfEntries:a,entries:N(e,r.INT32_BE,t+12,this.len-12,a)}}}class B extends E{constructor(e){super(e,r.INT32_BE),this.len=e}}class D{constructor(e){this.len=e}get(e,t){const a=r.INT16_BE.get(e,t+0);return new r.StringType(a,"utf-8").get(e,t+2)}}function N(e,t,a,i,r){if(l(`remainingLen=${i}, numberOfEntries=${r} * token-len=${t.len}`),0===i)return[];if(i!==r*t.len)throw new u("mismatch number-of-entries with remaining atom-length");const n=[];for(let i=0;i<r;++i)n.push(t.get(e,a)),a+=t.len;return n}const P=i("music-metadata:parser:MP4:Atom");class U{static async readAtom(e,t,a,i){const r=e.position;P(`Reading next token on offset=${r}...`);const n=await e.readToken(m),s=1n===n.length;s&&(n.length=await e.readToken(d));const o=new U(n,s,a),c=o.getPayloadLength(i);return P(`parse atom name=${o.atomPath}, extended=${o.extended}, offset=${r}, len=${o.header.length}`),await o.readData(e,t,c),o}constructor(e,t,a){this.header=e,this.extended=t,this.parent=a,this.children=[],this.atomPath=(this.parent?`${this.parent.atomPath}.`:"")+this.header.name}getHeaderLength(){return this.extended?16:8}getPayloadLength(e){return(0n===this.header.length?e:Number(this.header.length))-this.getHeaderLength()}async readAtoms(e,t,a){for(;a>0;){const i=await U.readAtom(e,t,this,a);this.children.push(i),a-=0n===i.header.length?a:Number(i.header.length)}}async readData(e,t,a){switch(this.header.name){case"moov":case"udta":case"trak":case"mdia":case"minf":case"stbl":case"<id>":case"ilst":case"tref":return this.readAtoms(e,t,this.getPayloadLength(a));case"meta":{const i="hdlr"===(await e.peekToken(m)).name?0:4;return await e.ignore(i),this.readAtoms(e,t,this.getPayloadLength(a)-i)}default:return t(this,a)}}}var M=a(207),L=a(523);const R=i("music-metadata:parser:MP4"),O={raw:{lossy:!1,format:"raw"},MAC3:{lossy:!0,format:"MACE 3:1"},MAC6:{lossy:!0,format:"MACE 6:1"},ima4:{lossy:!0,format:"IMA 4:1"},ulaw:{lossy:!0,format:"uLaw 2:1"},alaw:{lossy:!0,format:"uLaw 2:1"},Qclp:{lossy:!0,format:"QUALCOMM PureVoice"},".mp3":{lossy:!0,format:"MPEG-1 layer 3"},alac:{lossy:!1,format:"ALAC"},"ac-3":{lossy:!0,format:"AC-3"},mp4a:{lossy:!0,format:"MPEG-4/AAC"},mp4s:{lossy:!0,format:"MP4S"},c608:{lossy:!0,format:"CEA-608"},c708:{lossy:!0,format:"CEA-708"}};function $(e,t,a){return a.indexOf(e)===t}class j extends n.s{constructor(){super(...arguments),this.tracks=[],this.atomParsers={mvhd:async e=>{const t=await this.tokenizer.readToken(new k(e));this.metadata.setFormat("creationTime",t.creationTime),this.metadata.setFormat("modificationTime",t.modificationTime)},mdhd:async e=>{const t=await this.tokenizer.readToken(new g(e)),a=this.getTrackDescription();a.creationTime=t.creationTime,a.modificationTime=t.modificationTime,a.timeScale=t.timeScale,a.duration=t.duration},chap:async e=>{const t=this.getTrackDescription(),a=[];for(;e>=r.UINT32_BE.len;)a.push(await this.tokenizer.readNumber(r.UINT32_BE)),e-=r.UINT32_BE.len;t.chapterList=a},tkhd:async e=>{const t=await this.tokenizer.readToken(new w(e));this.tracks.push(t)},mdat:async e=>{if(this.audioLengthInBytes=e,this.calculateBitRate(),this.options.includeChapters){const t=this.tracks.filter((e=>e.chapterList));if(1===t.length){const a=t[0].chapterList,i=this.tracks.filter((e=>-1!==a.indexOf(e.trackId)));if(1===i.length)return this.parseChapterTrack(i[0],t[0],e)}}await this.tokenizer.ignore(e)},ftyp:async e=>{const t=[];for(;e>0;){const a=await this.tokenizer.readToken(h);e-=h.len;const i=a.type.replace(/\W/g,"");i.length>0&&t.push(i)}R(`ftyp: ${t.join("/")}`);const a=t.filter($).join("/");this.metadata.setFormat("container",a)},stsd:async e=>{const t=await this.tokenizer.readToken(new I(e));this.getTrackDescription().soundSampleDescription=t.table.map((e=>this.parseSoundSampleDescription(e)))},stsc:async e=>{const t=await this.tokenizer.readToken(new z(e));this.getTrackDescription().sampleToChunkTable=t.entries},stts:async e=>{const t=await this.tokenizer.readToken(new A(e));this.getTrackDescription().timeToSampleTable=t.entries},stsz:async e=>{const t=await this.tokenizer.readToken(new F(e)),a=this.getTrackDescription();a.sampleSize=t.sampleSize,a.sampleSizeTable=t.entries},stco:async e=>{const t=await this.tokenizer.readToken(new B(e));this.getTrackDescription().chunkOffsetTable=t.entries},date:async e=>{const t=await this.tokenizer.readToken(new r.StringType(e,"utf-8"));await this.addTag("date",t)}}}static read_BE_Integer(e,t){const a=(t?"INT":"UINT")+8*e.length+(e.length>1?"_BE":""),i=r[a];if(!i)throw new u(`Token for integer type not found: "${a}"`);return Number(i.get(e,0))}async parse(){this.tracks=[];let e=this.tokenizer.fileInfo.size||0;for(;!this.tokenizer.fileInfo.size||e>0;){try{if("\0\0\0\0"===(await this.tokenizer.peekToken(m)).name){const e=`Error at offset=${this.tokenizer.position}: box.id=0`;R(e),this.addWarning(e);break}}catch(e){if(!(e instanceof Error))throw e;{const t=`Error at offset=${this.tokenizer.position}: ${e.message}`;R(t),this.addWarning(t)}break}const t=await U.readAtom(this.tokenizer,((e,t)=>this.handleAtom(e,t)),null,e);e-=t.header.length===BigInt(0)?e:Number(t.header.length)}const t=[];this.tracks.forEach((e=>{const a=[];e.soundSampleDescription.forEach((e=>{const t={},i=O[e.dataFormat];if(i?(a.push(i.format),t.codecName=i.format):t.codecName=`<${e.dataFormat}>`,e.description){const{description:a}=e;a.sampleRate>0&&(t.type=M.S.audio,t.audio={samplingFrequency:a.sampleRate,bitDepth:a.sampleSize,channels:a.numAudioChannels})}this.metadata.addStreamInfo(t)})),a.length>=1&&t.push(a.join("/"))})),t.length>0&&this.metadata.setFormat("codec",t.filter($).join("+"));const a=this.tracks.filter((e=>e.soundSampleDescription.length>=1&&e.soundSampleDescription[0].description&&e.soundSampleDescription[0].description.numAudioChannels>0));if(a.length>=1){const e=a[0];if(e.timeScale>0){const t=e.duration/e.timeScale;this.metadata.setFormat("duration",t)}const t=e.soundSampleDescription[0];if(t.description&&(this.metadata.setFormat("sampleRate",t.description.sampleRate),this.metadata.setFormat("bitsPerSample",t.description.sampleSize),this.metadata.setFormat("numberOfChannels",t.description.numAudioChannels),0===e.timeScale&&e.timeToSampleTable.length>0)){const a=e.timeToSampleTable.map((e=>e.count*e.duration)).reduce(((e,t)=>e+t))/t.description.sampleRate;this.metadata.setFormat("duration",a)}const i=O[t.dataFormat];i&&this.metadata.setFormat("lossless",!i.lossy),this.calculateBitRate()}}async handleAtom(e,t){if(e.parent)switch(e.parent.header.name){case"ilst":case"<id>":return this.parseMetadataItemData(e)}if(this.atomParsers[e.header.name])return this.atomParsers[e.header.name](t);R(`No parser for atom path=${e.atomPath}, payload-len=${t}, ignoring atom`),await this.tokenizer.ignore(t)}getTrackDescription(){return this.tracks[this.tracks.length-1]}calculateBitRate(){this.audioLengthInBytes&&this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLengthInBytes/this.metadata.format.duration)}async addTag(e,t){await this.metadata.addTag("iTunes",e,t)}addWarning(e){R(`Warning: ${e}`),this.metadata.addWarning(e)}parseMetadataItemData(e){let t=e.header.name;return e.readAtoms(this.tokenizer,(async(e,a)=>{const i=e.getPayloadLength(a);switch(e.header.name){case"data":return this.parseValueAtom(t,e);case"name":case"mean":case"rate":{const e=await this.tokenizer.readToken(new b(i));t+=`:${e.name}`;break}default:{const a=await this.tokenizer.readToken(new r.Uint8ArrayType(i));this.addWarning(`Unsupported meta-item: ${t}[${e.header.name}] => value=${(0,L.EY)(a)} ascii=${(0,L.SW)(a,"ascii")}`)}}}),e.getPayloadLength(0))}async parseValueAtom(e,t){const a=await this.tokenizer.readToken(new T(Number(t.header.length)-m.len));if(0!==a.type.set)throw new u(`Unsupported type-set != 0: ${a.type.set}`);switch(a.type.type){case 0:switch(e){case"trkn":case"disk":{const t=r.UINT8.get(a.value,3),i=r.UINT8.get(a.value,5);await this.addTag(e,`${t}/${i}`);break}case"gnre":{const t=r.UINT8.get(a.value,1),i=s.jR[t-1];await this.addTag(e,i);break}case"rate":{const t=new TextDecoder("ascii").decode(a.value);await this.addTag(e,t);break}default:R(`unknown proprietary value type for: ${t.atomPath}`)}break;case 1:case 18:await this.addTag(e,new TextDecoder("utf-8").decode(a.value));break;case 13:if(this.options.skipCovers)break;await this.addTag(e,{format:"image/jpeg",data:Uint8Array.from(a.value)});break;case 14:if(this.options.skipCovers)break;await this.addTag(e,{format:"image/png",data:Uint8Array.from(a.value)});break;case 21:await this.addTag(e,j.read_BE_Integer(a.value,!0));break;case 22:await this.addTag(e,j.read_BE_Integer(a.value,!1));break;case 65:await this.addTag(e,r.UINT8.get(a.value,0));break;case 66:await this.addTag(e,r.UINT16_BE.get(a.value,0));break;case 67:await this.addTag(e,r.UINT32_BE.get(a.value,0));break;default:this.addWarning(`atom key=${e}, has unknown well-known-type (data-type): ${a.type.type}`)}}parseSoundSampleDescription(e){const t={dataFormat:e.dataFormat,dataReferenceIndex:e.dataReferenceIndex};let a=0;if(e.description){const i=S(e.description,a);a+=v,0===i.version||1===i.version?t.description=x(e.description,a):R(`Warning: sound-sample-description ${i} not implemented`)}return t}async parseChapterTrack(e,t,a){if(!e.sampleSize&&e.chunkOffsetTable.length!==e.sampleSizeTable.length)throw new Error("Expected equal chunk-offset-table & sample-size-table length.");const i=[];for(let r=0;r<e.chunkOffsetTable.length&&a>0;++r){const n=e.chunkOffsetTable[r]-this.tokenizer.position,s=e.sampleSize>0?e.sampleSize:e.sampleSizeTable[r];if((a-=n+s)<0)throw new u("Chapter chunk exceeding token length");await this.tokenizer.ignore(n);const o=await this.tokenizer.readToken(new D(s));R(`Chapter ${r+1}: ${o}`);const c={title:o,sampleOffset:this.findSampleOffset(t,this.tokenizer.position)};R(`Chapter title=${c.title}, offset=${c.sampleOffset}/${this.tracks[0].duration}`),i.push(c)}this.metadata.setFormat("chapters",i),await this.tokenizer.ignore(a)}findSampleOffset(e,t){let a=0;e.timeToSampleTable.forEach((e=>{a+=e.count*e.duration})),R(`Total duration=${a}`);let i=0;for(;i<e.chunkOffsetTable.length&&e.chunkOffsetTable[i]<t;)++i;return this.getChunkDuration(i+1,e)}getChunkDuration(e,t){let a=0,i=t.timeToSampleTable[a].count,r=t.timeToSampleTable[a].duration,n=1,s=this.getSamplesPerChunk(n,t.sampleToChunkTable),o=0;for(;n<e;){const e=Math.min(i,s);o+=e*r,i-=e,s-=e,0===s?(++n,s=this.getSamplesPerChunk(n,t.sampleToChunkTable)):(++a,i=t.timeToSampleTable[a].count,r=t.timeToSampleTable[a].duration)}return o}getSamplesPerChunk(e,t){for(let a=0;a<t.length-1;++a)if(e>=t[a].firstChunk&&e<t[a+1].firstChunk)return t[a].samplesPerChunk;return t[t.length-1].samplesPerChunk}}},283:(e,t,a)=>{"use strict";a.r(t),a.d(t,{APEv2Parser:()=>y,ApeContentError:()=>w});var i=a(833),r=a(853),n=a(17),s=a(523),o=a(185),c=a(604),l=a(31);const u={len:52,get:(e,t)=>({ID:l.e.get(e,t),version:n.UINT32_LE.get(e,t+4)/1e3,descriptorBytes:n.UINT32_LE.get(e,t+8),headerBytes:n.UINT32_LE.get(e,t+12),seekTableBytes:n.UINT32_LE.get(e,t+16),headerDataBytes:n.UINT32_LE.get(e,t+20),apeFrameDataBytes:n.UINT32_LE.get(e,t+24),apeFrameDataBytesHigh:n.UINT32_LE.get(e,t+28),terminatingDataBytes:n.UINT32_LE.get(e,t+32),fileMD5:new n.Uint8ArrayType(16).get(e,t+36)})},m={len:24,get:(e,t)=>({compressionLevel:n.UINT16_LE.get(e,t),formatFlags:n.UINT16_LE.get(e,t+2),blocksPerFrame:n.UINT32_LE.get(e,t+4),finalFrameBlocks:n.UINT32_LE.get(e,t+8),totalFrames:n.UINT32_LE.get(e,t+12),bitsPerSample:n.UINT16_LE.get(e,t+16),channel:n.UINT16_LE.get(e,t+18),sampleRate:n.UINT32_LE.get(e,t+20)})},d={len:32,get:(e,t)=>({ID:new n.StringType(8,"ascii").get(e,t),version:n.UINT32_LE.get(e,t+8),size:n.UINT32_LE.get(e,t+12),fields:n.UINT32_LE.get(e,t+16),flags:p(n.UINT32_LE.get(e,t+20))})},h={len:8,get:(e,t)=>({size:n.UINT32_LE.get(e,t),flags:p(n.UINT32_LE.get(e,t+4))})};function p(e){return{containsHeader:f(e,31),containsFooter:f(e,30),isHeader:f(e,29),readOnly:f(e,0),dataType:(6&e)>>1}}function f(e,t){return!!(e&1<<t)}var g=a(324);const k=i("music-metadata:parser:APEv2"),T="APEv2",b="APETAGEX";class w extends((0,g.fO)("APEv2")){}class y extends c.s{constructor(){super(...arguments),this.ape={}}static tryParseApeHeader(e,t,a){return new y(e,t,a).tryParseApeHeader()}static calculateDuration(e){let t=e.totalFrames>1?e.blocksPerFrame*(e.totalFrames-1):0;return t+=e.finalFrameBlocks,t/e.sampleRate}static async findApeFooterOffset(e,t){const a=new Uint8Array(d.len),i=e.position;if(t<=d.len)k(`Offset is too small to read APE footer: offset=${t}`);else if(t>d.len){await e.readBuffer(a,{position:t-d.len}),e.setPosition(i);const r=d.get(a,0);if("APETAGEX"===r.ID)return r.flags.isHeader?k("APE Header found at offset="+(t-d.len)):(k("APE Footer found at offset="+(t-d.len)),t-=r.size),{footer:r,offset:t}}}static parseTagFooter(e,t,a){const i=d.get(t,t.length-d.len);if(i.ID!==b)throw new w("Unexpected APEv2 Footer ID preamble value");return r.vY(t),new y(e,r.vY(t),a).parseTags(i)}async tryParseApeHeader(){if(this.tokenizer.fileInfo.size&&this.tokenizer.fileInfo.size-this.tokenizer.position<d.len)return void k("No APEv2 header found, end-of-file reached");const e=await this.tokenizer.peekToken(d);if(e.ID===b)return await this.tokenizer.ignore(d.len),this.parseTags(e);if(k(`APEv2 header not found at offset=${this.tokenizer.position}`),this.tokenizer.fileInfo.size){const e=this.tokenizer.fileInfo.size-this.tokenizer.position,t=new Uint8Array(e);return await this.tokenizer.readBuffer(t),y.parseTagFooter(this.metadata,t,this.options)}}async parse(){const e=await this.tokenizer.readToken(u);if("MAC "!==e.ID)throw new w("Unexpected descriptor ID");this.ape.descriptor=e;const t=e.descriptorBytes-u.len,a=await(t>0?this.parseDescriptorExpansion(t):this.parseHeader());return await this.tokenizer.ignore(a.forwardBytes),this.tryParseApeHeader()}async parseTags(e){const t=new Uint8Array(256);let a=e.size-d.len;k(`Parse APE tags at offset=${this.tokenizer.position}, size=${a}`);for(let i=0;i<e.fields;i++){if(a<h.len){this.metadata.addWarning(`APEv2 Tag-header: ${e.fields-i} items remaining, but no more tag data to read.`);break}const r=await this.tokenizer.readToken(h);a-=h.len+r.size,await this.tokenizer.peekBuffer(t,{length:Math.min(t.length,a)});let c=o.sX(t,0,t.length);const l=await this.tokenizer.readToken(new n.StringType(c,"ascii"));switch(await this.tokenizer.ignore(1),a-=l.length+1,r.flags.dataType){case 0:{const e=(await this.tokenizer.readToken(new n.StringType(r.size,"utf8"))).split(/\x00/g);await Promise.all(e.map((e=>this.metadata.addTag(T,l,e))));break}case 1:if(this.options.skipCovers)await this.tokenizer.ignore(r.size);else{const e=new Uint8Array(r.size);await this.tokenizer.readBuffer(e),c=o.sX(e,0,e.length);const t=(0,s.SW)(e.slice(0,c)),a=e.slice(c+1);await this.metadata.addTag(T,l,{description:t,data:a})}break;case 2:k(`Ignore external info ${l}`),await this.tokenizer.ignore(r.size);break;case 3:k(`Ignore external info ${l}`),this.metadata.addWarning(`APEv2 header declares a reserved datatype for "${l}"`),await this.tokenizer.ignore(r.size)}}}async parseDescriptorExpansion(e){return await this.tokenizer.ignore(e),this.parseHeader()}async parseHeader(){const e=await this.tokenizer.readToken(m);if(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("container","Monkey's Audio"),this.metadata.setFormat("bitsPerSample",e.bitsPerSample),this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("numberOfChannels",e.channel),this.metadata.setFormat("duration",y.calculateDuration(e)),!this.ape.descriptor)throw new w("Missing APE descriptor");return{forwardBytes:this.ape.descriptor.seekTableBytes+this.ape.descriptor.headerDataBytes+this.ape.descriptor.apeFrameDataBytes+this.ape.descriptor.terminatingDataBytes}}}},304:(e,t,a)=>{"use strict";a.d(t,{Sl:()=>o,Z:()=>s,xu:()=>n});var i=a(17),r=a(675);class n{static fromBase64(e){return n.fromBuffer(Uint8Array.from(atob(e),(e=>e.charCodeAt(0))))}static fromBuffer(e){return new n(e.length).get(e,0)}constructor(e){this.len=e}get(e,t){const a=r.n5[i.UINT32_BE.get(e,t)];t+=4;const n=i.UINT32_BE.get(e,t);t+=4;const s=new i.StringType(n,"utf-8").get(e,t);t+=n;const o=i.UINT32_BE.get(e,t);t+=4;const c=new i.StringType(o,"utf-8").get(e,t);t+=o;const l=i.UINT32_BE.get(e,t);t+=4;const u=i.UINT32_BE.get(e,t);t+=4;const m=i.UINT32_BE.get(e,t);t+=4;const d=i.UINT32_BE.get(e,t);t+=4;const h=i.UINT32_BE.get(e,t);return t+=4,{type:a,format:s,description:c,width:l,height:u,colour_depth:m,indexed_color:d,data:Uint8Array.from(e.slice(t,t+h))}}}const s={len:7,get:(e,t)=>({packetType:i.UINT8.get(e,t),vorbis:new i.StringType(6,"ascii").get(e,t+1)})},o={len:23,get:(e,t)=>({version:i.UINT32_LE.get(e,t+0),channelMode:i.UINT8.get(e,t+4),sampleRate:i.UINT32_LE.get(e,t+5),bitrateMax:i.UINT32_LE.get(e,t+9),bitrateNominal:i.UINT32_LE.get(e,t+13),bitrateMin:i.UINT32_LE.get(e,t+17)})}},324:(e,t,a)=>{"use strict";a.d(t,{e6:()=>r,fO:()=>l,gP:()=>o,nK:()=>c,qq:()=>n});const i=e=>class extends Error{constructor(t){super(t),this.name=e}};class r extends(i("CouldNotDetermineFileTypeError")){}class n extends(i("UnsupportedFileTypeError")){}class s extends(i("UnexpectedFileContentError")){constructor(e,t){super(t),this.fileType=e}toString(){return`${this.name} (FileType: ${this.fileType}): ${this.message}`}}class o extends(i("FieldDecodingError")){}class c extends(i("InternalParserError")){}const l=e=>class extends s{constructor(t){super(e,t)}}},408:(e,t,a)=>{"use strict";a.r(t),a.d(t,{DsdiffContentParseError:()=>d,DsdiffParser:()=>h});var i=a(17),r=a(833),n=a(853),s=a(31),o=a(604),c=a(621);const l={len:12,get:(e,t)=>({chunkID:s.e.get(e,t),chunkSize:i.INT64_BE.get(e,t+4)})};var u=a(324);const m=r("music-metadata:parser:aiff");class d extends((0,u.fO)("DSDIFF")){}class h extends o.s{async parse(){const e=await this.tokenizer.readToken(l);if("FRM8"!==e.chunkID)throw new d("Unexpected chunk-ID");const t=(await this.tokenizer.readToken(s.e)).trim();if("DSD"===t)return this.metadata.setFormat("container",`DSDIFF/${t}`),this.metadata.setFormat("lossless",!0),this.readFmt8Chunks(e.chunkSize-BigInt(s.e.len));throw new d(`Unsupported DSDIFF type: ${t}`)}async readFmt8Chunks(e){for(;e>=l.len;){const t=await this.tokenizer.readToken(l);m(`Chunk id=${t.chunkID}`),await this.readData(t),e-=BigInt(l.len)+t.chunkSize}}async readData(e){m(`Reading data of chunk[ID=${e.chunkID}, size=${e.chunkSize}]`);const t=this.tokenizer.position;switch(e.chunkID.trim()){case"FVER":{const e=await this.tokenizer.readToken(i.UINT32_LE);m(`DSDIFF version=${e}`);break}case"PROP":if("SND "!==await this.tokenizer.readToken(s.e))throw new d("Unexpected PROP-chunk ID");await this.handleSoundPropertyChunks(e.chunkSize-BigInt(s.e.len));break;case"ID3":{const t=await this.tokenizer.readToken(new i.Uint8ArrayType(Number(e.chunkSize))),a=n.vY(t);await(new c.S).parse(this.metadata,a,this.options);break}case"DSD":this.metadata.format.numberOfChannels&&this.metadata.setFormat("numberOfSamples",Number(e.chunkSize*BigInt(8)/BigInt(this.metadata.format.numberOfChannels))),this.metadata.format.numberOfSamples&&this.metadata.format.sampleRate&&this.metadata.setFormat("duration",this.metadata.format.numberOfSamples/this.metadata.format.sampleRate);break;default:m(`Ignore chunk[ID=${e.chunkID}, size=${e.chunkSize}]`)}const a=e.chunkSize-BigInt(this.tokenizer.position-t);a>0&&(m(`After Parsing chunk, remaining ${a} bytes`),await this.tokenizer.ignore(Number(a)))}async handleSoundPropertyChunks(e){for(m(`Parsing sound-property-chunks, remainingSize=${e}`);e>0;){const t=await this.tokenizer.readToken(l);m(`Sound-property-chunk[ID=${t.chunkID}, size=${t.chunkSize}]`);const a=this.tokenizer.position;switch(t.chunkID.trim()){case"FS":{const e=await this.tokenizer.readToken(i.UINT32_BE);this.metadata.setFormat("sampleRate",e);break}case"CHNL":{const e=await this.tokenizer.readToken(i.UINT16_BE);this.metadata.setFormat("numberOfChannels",e),await this.handleChannelChunks(t.chunkSize-BigInt(i.UINT16_BE.len));break}case"CMPR":{const e=(await this.tokenizer.readToken(s.e)).trim(),t=await this.tokenizer.readToken(i.UINT8),a=await this.tokenizer.readToken(new i.StringType(t,"ascii"));"DSD"===e&&(this.metadata.setFormat("lossless",!0),this.metadata.setFormat("bitsPerSample",1)),this.metadata.setFormat("codec",`${e} (${a})`);break}case"ABSS":{const e=await this.tokenizer.readToken(i.UINT16_BE),t=await this.tokenizer.readToken(i.UINT8),a=await this.tokenizer.readToken(i.UINT8),r=await this.tokenizer.readToken(i.UINT32_BE);m(`ABSS ${e}:${t}:${a}.${r}`);break}case"LSCO":{const e=await this.tokenizer.readToken(i.UINT16_BE);m(`LSCO lsConfig=${e}`);break}default:m(`Unknown sound-property-chunk[ID=${t.chunkID}, size=${t.chunkSize}]`),await this.tokenizer.ignore(Number(t.chunkSize))}const r=t.chunkSize-BigInt(this.tokenizer.position-a);r>0&&(m(`After Parsing sound-property-chunk ${t.chunkSize}, remaining ${r} bytes`),await this.tokenizer.ignore(Number(r))),e-=BigInt(l.len)+t.chunkSize,m(`Parsing sound-property-chunks, remainingSize=${e}`)}if(this.metadata.format.lossless&&this.metadata.format.sampleRate&&this.metadata.format.numberOfChannels&&this.metadata.format.bitsPerSample){const e=this.metadata.format.sampleRate*this.metadata.format.numberOfChannels*this.metadata.format.bitsPerSample;this.metadata.setFormat("bitrate",e)}}async handleChannelChunks(e){m(`Parsing channel-chunks, remainingSize=${e}`);const t=[];for(;e>=s.e.len;){const a=await this.tokenizer.readToken(s.e);m(`Channel[ID=${a}]`),t.push(a),e-=BigInt(s.e.len)}return m(`Channels: ${t.join(", ")}`),t}}},420:(e,t,a)=>{"use strict";a.r(t),a.d(t,{WavPackContentError:()=>g,WavPackParser:()=>k});var i=a(17),r=a(283),n=a(31),s=a(604);const o=[6e3,8e3,9600,11025,12e3,16e3,22050,24e3,32e3,44100,48e3,64e3,88200,96e3,192e3,-1],c={len:32,get:(e,t)=>{const a=i.UINT32_LE.get(e,t+24),r={BlockID:n.e.get(e,t),blockSize:i.UINT32_LE.get(e,t+4),version:i.UINT16_LE.get(e,t+8),totalSamples:i.UINT32_LE.get(e,t+12),blockIndex:i.UINT32_LE.get(e,t+16),blockSamples:i.UINT32_LE.get(e,t+20),flags:{bitsPerSample:8*(1+m(a,0,2)),isMono:u(a,2),isHybrid:u(a,3),isJointStereo:u(a,4),crossChannel:u(a,5),hybridNoiseShaping:u(a,6),floatingPoint:u(a,7),samplingRate:o[m(a,23,4)],isDSD:u(a,31)},crc:new i.Uint8ArrayType(4).get(e,t+28)};return r.flags.isDSD&&(r.totalSamples*=8),r}},l={len:1,get:(e,t)=>({functionId:m(e[t],0,6),isOptional:u(e[t],5),isOddSize:u(e[t],6),largeBlock:u(e[t],7)})};function u(e,t){return 1===m(e,t,1)}function m(e,t,a){return e>>>t&4294967295>>>32-a}var d=a(833),h=a(523),p=a(324);const f=d("music-metadata:parser:WavPack");class g extends((0,p.fO)("WavPack")){}class k extends s.s{constructor(){super(...arguments),this.audioDataSize=0}async parse(){return this.audioDataSize=0,await this.parseWavPackBlocks(),r.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async parseWavPackBlocks(){do{if("wvpk"!==await this.tokenizer.peekToken(n.e))break;const e=await this.tokenizer.readToken(c);if("wvpk"!==e.BlockID)throw new g("Invalid WavPack Block-ID");f(`WavPack header blockIndex=${e.blockIndex}, len=${c.len}`),0!==e.blockIndex||this.metadata.format.container||(this.metadata.setFormat("container","WavPack"),this.metadata.setFormat("lossless",!e.flags.isHybrid),this.metadata.setFormat("bitsPerSample",e.flags.bitsPerSample),e.flags.isDSD||(this.metadata.setFormat("sampleRate",e.flags.samplingRate),this.metadata.setFormat("duration",e.totalSamples/e.flags.samplingRate)),this.metadata.setFormat("numberOfChannels",e.flags.isMono?1:2),this.metadata.setFormat("numberOfSamples",e.totalSamples),this.metadata.setFormat("codec",e.flags.isDSD?"DSD":"PCM"));const t=e.blockSize-(c.len-8);await(0===e.blockIndex?this.parseMetadataSubBlock(e,t):this.tokenizer.ignore(t)),e.blockSamples>0&&(this.audioDataSize+=e.blockSize)}while(!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=c.len);this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioDataSize/this.metadata.format.duration)}async parseMetadataSubBlock(e,t){let a=t;for(;a>l.len;){const t=await this.tokenizer.readToken(l),r=await this.tokenizer.readNumber(t.largeBlock?i.UINT24_LE:i.UINT8),n=new Uint8Array(2*r-(t.isOddSize?1:0));switch(await this.tokenizer.readBuffer(n),f(`Metadata Sub-Blocks functionId=0x${t.functionId.toString(16)}, id.largeBlock=${t.largeBlock},data-size=${n.length}`),t.functionId){case 0:break;case 14:{f("ID_DSD_BLOCK");const t=1<<i.UINT8.get(n,0),a=e.flags.samplingRate*t*8;if(!e.flags.isDSD)throw new g("Only expect DSD block if DSD-flag is set");this.metadata.setFormat("sampleRate",a),this.metadata.setFormat("duration",e.totalSamples/a);break}case 36:f("ID_ALT_TRAILER: trailer for non-wav files");break;case 38:this.metadata.setFormat("audioMD5",n);break;case 47:f(`ID_BLOCK_CHECKSUM: checksum=${(0,h.EY)(n)}`);break;default:f(`Ignore unsupported meta-sub-block-id functionId=0x${t.functionId.toString(16)}`)}a-=l.len+(t.largeBlock?i.UINT24_LE.len:i.UINT8.len)+2*r,f(`remainingLength=${a}`),t.isOddSize&&this.tokenizer.ignore(1)}if(0!==a)throw new g("metadata-sub-block should fit it remaining length")}}},427:(e,t,a)=>{"use strict";a.d(t,{J:()=>u});var i=a(17),r=a(833),n=a(902),s=a(304),o=a(324);const c=r("music-metadata:parser:ogg:vorbis1");class l extends((0,o.fO)("Vorbis")){}class u{constructor(e,t){this.pageSegments=[],this.metadata=e,this.options=t}async parsePage(e,t){if(e.headerType.firstPage)this.parseFirstPage(e,t);else{if(e.headerType.continued){if(0===this.pageSegments.length)throw new l("Cannot continue on previous page");this.pageSegments.push(t)}if(e.headerType.lastPage||!e.headerType.continued){if(this.pageSegments.length>0){const e=u.mergeUint8Arrays(this.pageSegments);await this.parseFullPage(e)}this.pageSegments=e.headerType.lastPage?[]:[t]}}e.headerType.lastPage&&this.calculateDuration(e)}static mergeUint8Arrays(e){const t=e.reduce(((e,t)=>e+t.length),0),a=new Uint8Array(t);return e.forEach(((e,t,i)=>{const r=i.slice(0,t).reduce(((e,t)=>e+t.length),0);a.set(e,r)})),a}async flush(){await this.parseFullPage(u.mergeUint8Arrays(this.pageSegments))}async parseUserComment(e,t){const a=new n.Y(e,t).parseUserComment();return await this.addTag(a.key,a.value),a.len}async addTag(e,t){if("METADATA_BLOCK_PICTURE"===e&&"string"==typeof t){if(this.options.skipCovers)return void c("Ignore picture");t=s.xu.fromBase64(t),c(`Push picture: id=${e}, format=${t.format}`)}else c(`Push tag: id=${e}, value=${t}`);await this.metadata.addTag("vorbis",e,t)}calculateDuration(e){this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0&&(this.metadata.setFormat("numberOfSamples",e.absoluteGranulePosition),this.metadata.setFormat("duration",e.absoluteGranulePosition/this.metadata.format.sampleRate))}parseFirstPage(e,t){this.metadata.setFormat("codec","Vorbis I"),c("Parse first page");const a=s.Z.get(t,0);if("vorbis"!==a.vorbis)throw new l("Metadata does not look like Vorbis");if(1!==a.packetType)throw new l("First Ogg page should be type 1: the identification header");{const e=s.Sl.get(t,s.Z.len);this.metadata.setFormat("sampleRate",e.sampleRate),this.metadata.setFormat("bitrate",e.bitrateNominal),this.metadata.setFormat("numberOfChannels",e.channelMode),c("sample-rate=%s[hz], bitrate=%s[b/s], channel-mode=%s",e.sampleRate,e.bitrateNominal,e.channelMode)}}async parseFullPage(e){const t=s.Z.get(e,0);if(c("Parse full page: type=%s, byteLength=%s",t.packetType,e.byteLength),3===t.packetType)return this.parseUserCommentList(e,s.Z.len)}async parseUserCommentList(e,t){const a=i.UINT32_LE.get(e,t);t+=4,t+=a;let r=i.UINT32_LE.get(e,t);for(t+=4;r-- >0;)t+=await this.parseUserComment(e,t)}}},438:(e,t,a)=>{"use strict";a.r(t),a.d(t,{WaveParser:()=>B});var i=a(853),r=a(17),n=a(833);const s={len:8,get:(e,t)=>({chunkID:new r.StringType(4,"latin1").get(e,t),chunkSize:r.UINT32_LE.get(e,t+4)})};class o{constructor(e){this.tagHeader=e,this.len=e.chunkSize,this.len+=1&this.len}get(e,t){return new r.StringType(this.tagHeader.chunkSize,"ascii").get(e,t)}}var c=a(324);class l extends((0,c.fO)("Wave")){}const u=1,m=2,d=3,h=5632,p=5634,f=255,g=146,k=8192,T=576,b=577,w=9,y=8193,I=80,v={[u]:"PCM",[m]:"ADPCM",[d]:"IEEE_FLOAT",[h]:"MPEG_ADTS_AAC",[p]:"MPEG_LOAS",[f]:"RAW_AAC1",[g]:"DOLBY_AC3_SPDIF",[k]:"DVM",[T]:"RAW_SPORT",[b]:"ESST_AC3",[w]:"DRM",[y]:"DTS2",[I]:"MPEG"};class S{constructor(e){if(e.chunkSize<16)throw new l("Invalid chunk size");this.len=e.chunkSize}get(e,t){return{wFormatTag:r.UINT16_LE.get(e,t),nChannels:r.UINT16_LE.get(e,t+2),nSamplesPerSec:r.UINT32_LE.get(e,t+4),nAvgBytesPerSec:r.UINT32_LE.get(e,t+8),nBlockAlign:r.UINT16_LE.get(e,t+12),wBitsPerSample:r.UINT16_LE.get(e,t+14)}}}class x{constructor(e){if(e.chunkSize<4)throw new l("Invalid fact chunk size.");this.len=e.chunkSize}get(e,t){return{dwSampleLength:r.UINT32_LE.get(e,t)}}}var E=a(621),C=a(185),A=a(31),_=a(604);const z={len:420,get:(e,t)=>({description:(0,C.F6)(new r.StringType(256,"ascii").get(e,t)).trim(),originator:(0,C.F6)(new r.StringType(32,"ascii").get(e,t+256)).trim(),originatorReference:(0,C.F6)(new r.StringType(32,"ascii").get(e,t+288)).trim(),originationDate:(0,C.F6)(new r.StringType(10,"ascii").get(e,t+320)).trim(),originationTime:(0,C.F6)(new r.StringType(8,"ascii").get(e,t+330)).trim(),timeReferenceLow:r.UINT32_LE.get(e,t+338),timeReferenceHigh:r.UINT32_LE.get(e,t+342),version:r.UINT16_LE.get(e,t+346),umid:new r.Uint8ArrayType(64).get(e,t+348),loudnessValue:r.UINT16_LE.get(e,t+412),maxTruePeakLevel:r.UINT16_LE.get(e,t+414),maxMomentaryLoudness:r.UINT16_LE.get(e,t+416),maxShortTermLoudness:r.UINT16_LE.get(e,t+418)})},F=n("music-metadata:parser:RIFF");class B extends _.s{constructor(){super(...arguments),this.blockAlign=0}async parse(){const e=await this.tokenizer.readToken(s);if(F(`pos=${this.tokenizer.position}, parse: chunkID=${e.chunkID}`),"RIFF"===e.chunkID)return this.parseRiffChunk(e.chunkSize).catch((e=>{if(!(e instanceof i.d1))throw e}))}async parseRiffChunk(e){const t=await this.tokenizer.readToken(A.e);if(this.metadata.setFormat("container",t),"WAVE"===t)return this.readWaveChunk(e-A.e.len);throw new l(`Unsupported RIFF format: RIFF/${t}`)}async readWaveChunk(e){for(;e>=s.len;){const t=await this.tokenizer.readToken(s);switch(e-=s.len+t.chunkSize,t.chunkSize>e&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=t,F(`pos=${this.tokenizer.position}, readChunk: chunkID=RIFF/WAVE/${t.chunkID}`),t.chunkID){case"LIST":await this.parseListTag(t);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new x(t));break;case"fmt ":{const e=await this.tokenizer.readToken(new S(t));let a=v[e.wFormatTag];a||(F(`WAVE/non-PCM format=${e.wFormatTag}`),a=`non-PCM (${e.wFormatTag})`),this.metadata.setFormat("codec",a),this.metadata.setFormat("bitsPerSample",e.wBitsPerSample),this.metadata.setFormat("sampleRate",e.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",e.nChannels),this.metadata.setFormat("bitrate",e.nBlockAlign*e.nSamplesPerSec*8),this.blockAlign=e.nBlockAlign;break}case"id3 ":case"ID3 ":{const e=await this.tokenizer.readToken(new r.Uint8ArrayType(t.chunkSize)),a=i.vY(e);await(new E.S).parse(this.metadata,a,this.options);break}case"data":{!1!==this.metadata.format.lossless&&this.metadata.setFormat("lossless",!0);let e=t.chunkSize;if(this.tokenizer.fileInfo.size){const t=this.tokenizer.fileInfo.size-this.tokenizer.position;t<e&&(this.metadata.addWarning("data chunk length exceeding file length"),e=t)}const a=this.fact?this.fact.dwSampleLength:4294967295===e?void 0:e/this.blockAlign;a&&(this.metadata.setFormat("numberOfSamples",a),this.metadata.format.sampleRate&&this.metadata.setFormat("duration",a/this.metadata.format.sampleRate)),"ADPCM"===this.metadata.format.codec?this.metadata.setFormat("bitrate",352e3):this.metadata.format.sampleRate&&this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(t.chunkSize);break}case"bext":{const e=await this.tokenizer.readToken(z);Object.keys(e).forEach((t=>{this.metadata.addTag("exif",`bext.${t}`,e[t])}));const a=t.chunkSize-z.len;await this.tokenizer.ignore(a);break}case"\0\0\0\0":F(`Ignore padding chunk: RIFF/${t.chunkID} of ${t.chunkSize} bytes`),this.metadata.addWarning(`Ignore chunk: RIFF/${t.chunkID}`),await this.tokenizer.ignore(t.chunkSize);break;default:F(`Ignore chunk: RIFF/${t.chunkID} of ${t.chunkSize} bytes`),this.metadata.addWarning(`Ignore chunk: RIFF/${t.chunkID}`),await this.tokenizer.ignore(t.chunkSize)}this.header.chunkSize%2==1&&(F("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(e){const t=await this.tokenizer.readToken(new r.StringType(4,"latin1"));return F("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,t),"INFO"===t?this.parseRiffInfoTags(e.chunkSize-4):(this.metadata.addWarning(`Ignore chunk: RIFF/WAVE/LIST/${t}`),F(`Ignoring chunkID=RIFF/WAVE/LIST/${t}`),this.tokenizer.ignore(e.chunkSize-4).then())}async parseRiffInfoTags(e){for(;e>=8;){const t=await this.tokenizer.readToken(s),a=new o(t),i=await this.tokenizer.readToken(a);this.addTag(t.chunkID,C.F6(i)),e-=8+a.len}if(0!==e)throw new l(`Illegal remaining size: ${e}`)}addTag(e,t){this.metadata.addTag("exif",e,t)}}},451:()=>{(()=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,i=Array(t);a<t;a++)i[a]=e[a];return i}function i(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(t){var a=function(t){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,"string");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(a)?a:a+""}function n(e){var t="function"==typeof Map?new Map:void 0;return n=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return function(e,t,a){if(s())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var r=new(e.bind.apply(e,i));return a&&o(r,a.prototype),r}(e,arguments,c(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o(a,e)},n(e)}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(s=function(){return!!e})()}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}var l=function(a){function r(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(t=function(t,a){return a=c(a),function(t,a){if(a&&("object"==e(a)||"function"==typeof a))return a;if(void 0!==a)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,s()?Reflect.construct(a,[],c(t).constructor):a.apply(t,void 0))}(this,r)).attachShadow({mode:"open"}),t.fps=30,t.rows=t.getAttribute("rows")||40,t.cols=t.getAttribute("cols")||8,t.height=t.getAttribute("height"),t.debug=!1,t.frequencyRanges=[32,60,170,310,600,1e3,3e3,6e3,12e3,14e3,16e3],t.barsMarginY=2.5,t.barsMarginX=2.5,t.barBorderRadius=2,t.style.width="100%",t.type=t.getAttribute("type")||"canvas";var a=JSON.parse(t.getAttribute("colors")||'{"barBgColor": "#222222", "barColor": "#d7f0ff", "barColor2": "#a6c0ba", "barColor3": "#fcb750"}');return t.barBgColor=a.barBgColor,t.barColor=a.barColor,t.barColor2=a.barColor2,t.barColor3=a.barColor3,t.src=t.getAttribute("src"),t.shadowRoot.innerHTML='\n            <canvas id="equalizer" style="display: none;"></canvas>\n            <div id="domEqualizer" style="display: none;"></div>\n            <div class="frequencys"></div>\n            '.concat(t.src?'<audio id="audio" src="'.concat(t.src,'" controls></audio>'):"","\n            <style>\n                ").concat(t.css(),"\n            </style>"),t.canvas=t.shadowRoot.getElementById("equalizer"),t.domEqualizer=t.shadowRoot.getElementById("domEqualizer"),t.ctx=t.canvas.getContext("2d"),t.oldPos=[],t.dataArray=[],t.stop=!1,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(r,a),n=r,l=[{key:"css",value:function(){return"canvas {\n                    border: 0px solid #000;\n                    display: block;\n                }\n                #domEqualizer {\n                    width: 100%;\n                    background-color: #000;\n                    transform: scale(-1, 1);\n                    height: ".concat(this.height,"px;\n                }\n                #domEqualizer div {\n                    display: inline-block;\n                    margin: ").concat(this.barsMarginY,"px ").concat(this.barsMarginX,"px;\n                    margin-bottom: ").concat(this.barsMarginY-4,"px;\n                    opacity: 1;\n                    border-radius: ").concat(this.barBorderRadius,"px;\n                    \n                    height: ").concat(this.barHeight,"px;\n                    width: ").concat(this.barWidth,"px;\n                }\n                audio {\n                    width: 100%;\n                    margin-top: 20px;\n                }\n                :host {\n                    display: block;\n                }")}},{key:"audio",get:function(){return this._audio},set:function(e){this._audio=e,this.getAudio()}},{key:"getAudio",value:function(){var e=this;this._audio=this._audio?this._audio:this.shadowRoot.getElementById("audio")||document.querySelector(this.getAttribute("audio")),this._audio.addEventListener("play",(function(){e.stop&&(e.stop=!1,e.animate()),e.analyser||(e.analyser=(new(window.AudioContext||window.webkitAudioContext)).createAnalyser(),e.source=e.analyser.context.createMediaElementSource(e._audio),e.source.connect(e.analyser),e.analyser.connect(e.analyser.context.destination),e.analyser.fftSize=1024,e.dataArray=new Uint8Array(e.analyser.frequencyBinCount))})),this._audio.addEventListener("pause",(function(){e.stop=!0}))}},{key:"groupedFrequencies",value:function(e){if(!this.analyser)return[];for(var t=this.analyser.frequencyBinCount,a=this.analyser.context.sampleRate/2,i=this.frequencyRanges.length,r=new Array(i).fill(0),n=this.frequencyRanges.map((function(e){return Math.floor(e/a*t)})),s=0;s<t;s++)for(var o=0;o<i;o++)if(s<=n[o]){r[o]+=e[s];break}for(var c=new Array(i).fill(0),l=0;l<t;l++)for(var u=0;u<i;u++)if(l<=n[u]){c[u]+=1;break}for(var m=0;m<i;m++)c[m]>0&&(r[m]=Math.floor(r[m]/c[m]));return this.columnsTransform(r)}},{key:"attributeChangedCallback",value:function(e,t,a){switch(e){case"cols":this.cols=this.getAttribute("cols"),this.initHtml(),this.calculateBars();break;case"rows":this.rows=this.getAttribute("rows"),this.initHtml(),this.calculateBars();break;case"height":this.height=this.getAttribute("height");break;case"type":this.type=a,this.initHtml();break;case"src":this.src=a,this.getAudio();break;case"audio":this.getAudio();break;case"colors":try{a=JSON.parse(a),this.barBgColor=a.barBgColor,this.barColor=a.barColor,this.barColor2=a.barColor2,this.barColor3=a.barColor3}catch(e){console.error("Error parsing colors config:",e)}}this.shadowRoot.querySelector("style").innerHTML=this.css()}},{key:"initHtml",value:function(){this.shadowRoot.getElementById("domEqualizer").innerHTML="";for(var e=this.rows*this.cols;e>0;e--){var t=document.createElement("div");this.shadowRoot.getElementById("domEqualizer").appendChild(t)}}},{key:"connectedCallback",value:function(){var e=this;this.calculateBars(),this.animate(),window.addEventListener("resize",(function(){e.calculateBars()})),new ResizeObserver((function(){e.calculateBars()})).observe(this)}},{key:"animate",value:function(){var e=this,t=1e3/this.fps,a=performance.now(),i=function(r){e.stop||(r-a>=t&&(a+=t,e.analyser&&e.analyser.getByteFrequencyData(e.dataArray),"canvas"===e.type?e.draw():"html"===e.type&&e.htmlDraw()),requestAnimationFrame(i))};requestAnimationFrame(i)}},{key:"columnsTransform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.cols,a=[],i=(e.length-1)/(t-1);if(1==i)return e;for(var r=0;r<t;r++){var n=r*i,s=Math.floor(n),o=Math.ceil(n);if(s===o)a.push(e[s]);else{var c=n-s,l=1-c,u=e[s]*l+e[o]*c;a.push(u)}}return a}},{key:"calculateBars",value:function(){this.barWidth=(this.offsetWidth-2*this.barsMarginX*this.cols)/this.cols,this.barHeight=((this.height||.45*this.offsetWidth)-2*this.barsMarginY*this.rows)/this.rows}},{key:"draw",value:function(){this.canvas.style.display="block",this.canvas.width=this.offsetWidth,this.canvas.height=this.height||.45*this.offsetWidth,this.domEqualizer.style.display="none",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=this.barWidth,a=this.barHeight,i=0;i<this.rows;i++)for(var r=0;r<this.cols;r++){var n=r*(e+2*this.barsMarginX+(this.barsMarginX/this.cols+1))-1,s=this.canvas.height-i*(a+2*this.barsMarginY)-a,o=Math.min(this.barBorderRadius,e/2,a/2);this.ctx.fillStyle=this.getColor(i,r),this.ctx.globalAlpha=1,this.ctx.beginPath(),this.ctx.moveTo(n+o,s),this.ctx.lineTo(n+e-o,s),this.ctx.quadraticCurveTo(n+e,s,n+e,s+o),this.ctx.lineTo(n+e,s+a-o),this.ctx.quadraticCurveTo(n+e,s+a,n+e-o,s+a),this.ctx.lineTo(n+o,s+a),this.ctx.quadraticCurveTo(n,s+a,n,s+a-o),this.ctx.lineTo(n,s+o),this.ctx.quadraticCurveTo(n,s,n+o,s),this.ctx.closePath(),this.ctx.fill()}this.oldPos=t(this.dataArray)}},{key:"htmlDraw",value:function(){this.domEqualizer.style.display="block",this.domEqualizer.style.height=this.height||.45*this.offsetHeight,this.canvas.style.display="none";for(var e=this.cols*this.rows,a=0;a<this.rows;a++)for(var i=0;i<this.cols;i++)this.domEqualizer.children[--e].style.backgroundColor=this.getColor(a,i);this.oldPos=t(this.dataArray)}},{key:"getColor",value:function(e,t){var a=this.groupedFrequencies(this.dataArray);this.debug&&(this.shadowRoot.querySelector(".frequencys").innerHTML=a.map((function(e){return Math.floor(e)})).join(", "));var i=a[t],r=this.groupedFrequencies(this.oldPos)[t];return i>=(e+1)*(255/this.rows)?this.barColor:r>=(e+1)*(255/this.rows)?this.barColor2:(r>i?r:i)>=e*(255/this.rows)?this.barColor3:this.barBgColor}}],u=[{key:"observedAttributes",get:function(){return["type","colors","src","audio","cols","rows","height"]}}],l&&i(n.prototype,l),u&&i(n,u),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,l,u}(n(HTMLElement));customElements.define("classic-equalizer",l)})()},465:(e,t,a)=>{"use strict";a.r(t),a.d(t,{FlacParser:()=>p});var i=a(17),r=a(833),n=a(185),s=a(304),o=a(481),c=a(31),l=a(427),u=a(902),m=a(324);const d=r("music-metadata:parser:FLAC");class h extends((0,m.fO)("FLAC")){}class p extends o.k{constructor(){super(...arguments),this.vorbisParser=new l.J(this.metadata,this.options),this.padding=0}async postId3v2Parse(){if("fLaC"!==(await this.tokenizer.readToken(c.e)).toString())throw new h("Invalid FLAC preamble");let e;do{e=await this.tokenizer.readToken(f),await this.parseDataBlock(e)}while(!e.lastBlock);if(this.tokenizer.fileInfo.size&&this.metadata.format.duration){const e=this.tokenizer.fileInfo.size-this.tokenizer.position;this.metadata.setFormat("bitrate",8*e/this.metadata.format.duration)}}async parseDataBlock(e){switch(d(`blockHeader type=${e.type}, length=${e.length}`),e.type){case 0:return this.parseBlockStreamInfo(e.length);case 1:this.padding+=e.length;break;case 2:case 3:case 5:break;case 4:return this.parseComment(e.length);case 6:return void await this.parsePicture(e.length);default:this.metadata.addWarning(`Unknown block type: ${e.type}`)}return this.tokenizer.ignore(e.length).then()}async parseBlockStreamInfo(e){if(e!==g.len)throw new h("Unexpected block-stream-info length");const t=await this.tokenizer.readToken(g);this.metadata.setFormat("container","FLAC"),this.metadata.setFormat("codec","FLAC"),this.metadata.setFormat("lossless",!0),this.metadata.setFormat("numberOfChannels",t.channels),this.metadata.setFormat("bitsPerSample",t.bitsPerSample),this.metadata.setFormat("sampleRate",t.sampleRate),t.totalSamples>0&&this.metadata.setFormat("duration",t.totalSamples/t.sampleRate)}async parseComment(e){const t=await this.tokenizer.readToken(new i.Uint8ArrayType(e)),a=new u.Y(t,0);a.readStringUtf8();const r=a.readInt32(),n=new Array(r);for(let e=0;e<r;e++)n[e]=a.parseUserComment();await Promise.all(n.map((e=>this.vorbisParser.addTag(e.key,e.value))))}async parsePicture(e){if(this.options.skipCovers)return this.tokenizer.ignore(e);const t=await this.tokenizer.readToken(new s.xu(e));this.vorbisParser.addTag("METADATA_BLOCK_PICTURE",t)}}const f={len:4,get:(e,t)=>({lastBlock:n.mh(e,t,7),type:n.f5(e,t,1,7),length:i.UINT24_BE.get(e,t+1)})},g={len:34,get:(e,t)=>({minimumBlockSize:i.UINT16_BE.get(e,t),maximumBlockSize:i.UINT16_BE.get(e,t+2)/1e3,minimumFrameSize:i.UINT24_BE.get(e,t+4),maximumFrameSize:i.UINT24_BE.get(e,t+7),sampleRate:i.UINT24_BE.get(e,t+10)>>4,channels:n.f5(e,t+12,4,3)+1,bitsPerSample:n.f5(e,t+12,7,5)+1,totalSamples:n.f5(e,t+13,4,36),fileMD5:new i.Uint8ArrayType(16).get(e,t+18)})}},481:(e,t,a)=>{"use strict";a.d(t,{k:()=>u});var i=a(853),r=a(833),n=a(675),s=a(621),o=a(191),c=a(604);const l=r("music-metadata:parser:ID3");class u extends c.s{constructor(){super(...arguments),this.id3parser=new s.S}static async startsWithID3v2Header(e){return"ID3"===(await e.peekToken(n.yW)).fileIdentifier}async parse(){try{await this.parseID3v2()}catch(e){if(!(e instanceof i.d1))throw e;l("End-of-stream")}}finalize(){}async parseID3v2(){if(await this.tryReadId3v2Headers(),l("End of ID3v2 header, go to MPEG-parser: pos=%s",this.tokenizer.position),await this.postId3v2Parse(),this.options.skipPostHeaders&&this.metadata.hasAny())this.finalize();else{const e=new o.Bn(this.metadata,this.tokenizer,this.options);await e.parse(),this.finalize()}}async tryReadId3v2Headers(){if("ID3"===(await this.tokenizer.peekToken(n.yW)).fileIdentifier)return l("Found ID3v2 header, pos=%s",this.tokenizer.position),await this.id3parser.parse(this.metadata,this.tokenizer,this.options),this.tryReadId3v2Headers()}}},523:(e,t,a)=>{"use strict";a.d(t,{AS:()=>g,AW:()=>k,Al:()=>d,EY:()=>p,SW:()=>l,mK:()=>b,qh:()=>T});const i=Object.prototype.toString,r="[object Uint8Array]",n="[object ArrayBuffer]";function s(e,t,a){return!!e&&(e.constructor===t||i.call(e)===a)}function o(e){return s(e,Uint8Array,r)}const c={utf8:new globalThis.TextDecoder("utf8")};function l(e,t="utf8"){return function(e){if(!function(e){return o(e)||function(e){return s(e,ArrayBuffer,n)}(e)}(e))throw new TypeError(`Expected \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof e}\``)}(e),c[t]??=new globalThis.TextDecoder(t),c[t].decode(e)}function u(e){if("string"!=typeof e)throw new TypeError(`Expected \`string\`, got \`${typeof e}\``)}const m=new globalThis.TextEncoder;function d(e){return u(e),m.encode(e)}const h=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function p(e){!function(e){if(!o(e))throw new TypeError(`Expected \`Uint8Array\`, got \`${typeof e}\``)}(e);let t="";for(let a=0;a<e.length;a++)t+=h[e[a]];return t}const f={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function g(e){if(u(e),e.length%2!=0)throw new Error("Invalid Hex string length.");const t=e.length/2,a=new Uint8Array(t);for(let i=0;i<t;i++){const t=f[e[2*i]],r=f[e[2*i+1]];if(void 0===t||void 0===r)throw new Error("Invalid Hex character encountered at position "+2*i);a[i]=t<<4|r}return a}function k(e){const{byteLength:t}=e;return 6===t?e.getUint16(0)*2**32+e.getUint32(2):5===t?e.getUint8(0)*2**32+e.getUint32(1):4===t?e.getUint32(0):3===t?65536*e.getUint8(0)+e.getUint16(1):2===t?e.getUint16(0):1===t?e.getUint8(0):void 0}function T(e,t){const a=e.length,i=t.length;if(0===i)return-1;if(i>a)return-1;const r=a-i;for(let a=0;a<=r;a++){let r=!0;for(let n=0;n<i;n++)if(e[a+n]!==t[n]){r=!1;break}if(r)return a}return-1}function b(e,t){return-1!==T(e,t)}},585:e=>{var t=1e3,a=60*t,i=60*a,r=24*i,n=7*r;function s(e,t,a,i){var r=t>=1.5*a;return Math.round(e/a)+" "+i+(r?"s":"")}e.exports=function(e,o){o=o||{};var c,l,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var o=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return o*n;case"days":case"day":case"d":return o*r;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*a;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===u&&isFinite(e))return o.long?(c=e,(l=Math.abs(c))>=r?s(c,l,r,"day"):l>=i?s(c,l,i,"hour"):l>=a?s(c,l,a,"minute"):l>=t?s(c,l,t,"second"):c+" ms"):function(e){var n=Math.abs(e);return n>=r?Math.round(e/r)+"d":n>=i?Math.round(e/i)+"h":n>=a?Math.round(e/a)+"m":n>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},597:(e,t)=>{"use strict";var a=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,i=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,r=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,n=/\\([\u000b\u0020-\u00ff])/g,s=/([\\"])/g,o=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function c(e){var t=String(e);if(r.test(t))return t;if(t.length>0&&!i.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(s,"\\$1")+'"'}function l(e){this.parameters=Object.create(null),this.type=e}t.format=function(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var t=e.parameters,a=e.type;if(!a||!o.test(a))throw new TypeError("invalid type");var i=a;if(t&&"object"==typeof t)for(var n,s=Object.keys(t).sort(),l=0;l<s.length;l++){if(n=s[l],!r.test(n))throw new TypeError("invalid parameter name");i+="; "+n+"="+c(t[n])}return i},t.parse=function(e){if(!e)throw new TypeError("argument string is required");var t="object"==typeof e?function(e){var t;if("function"==typeof e.getHeader?t=e.getHeader("content-type"):"object"==typeof e.headers&&(t=e.headers&&e.headers["content-type"]),"string"!=typeof t)throw new TypeError("content-type header is missing from object");return t}(e):e;if("string"!=typeof t)throw new TypeError("argument string is required to be a string");var i=t.indexOf(";"),r=-1!==i?t.slice(0,i).trim():t.trim();if(!o.test(r))throw new TypeError("invalid media type");var s=new l(r.toLowerCase());if(-1!==i){var c,u,m;for(a.lastIndex=i;u=a.exec(t);){if(u.index!==i)throw new TypeError("invalid parameter format");i+=u[0].length,c=u[1].toLowerCase(),34===(m=u[2]).charCodeAt(0)&&-1!==(m=m.slice(1,-1)).indexOf("\\")&&(m=m.replace(n,"$1")),s.parameters[c]=m}if(i!==t.length)throw new TypeError("invalid parameter format")}return s}},604:(e,t,a)=>{"use strict";a.d(t,{s:()=>i});class i{constructor(e,t,a){this.metadata=e,this.tokenizer=t,this.options=a}}},621:(e,t,a)=>{"use strict";a.d(t,{S:()=>f});var i=a(17),r=a(185),n=a(833),s=a(675),o=a(191),c=a(324);const l=n("music-metadata:id3v2:frame-parser"),u="latin1";function m(e){return"RX"===e?"Remix":"CR"===e?"Cover":e.match(/^\d*$/)?o.jR[Number.parseInt(e)]:void 0}class d{constructor(e,t){this.major=e,this.warningCollector=t}readData(e,t,a){if(0===e.length)return void this.warningCollector.addWarning(`id3v2.${this.major} header has empty tag type=${t}`);const{encoding:n,bom:o}=s.YF.get(e,0),c=e.length;let p=0,f=[];const g=d.getNullTerminatorLength(n);let k;switch(l(`Parsing tag type=${t}, encoding=${n}, bom=${o}`),"TXXX"!==t&&"T"===t[0]?"T*":t){case"T*":case"GRP1":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":{let a;try{a=r.sc(e.slice(1),n).replace(/\x00+$/,"")}catch(e){if(e instanceof Error){this.warningCollector.addWarning(`id3v2.${this.major} type=${t} header has invalid string value: ${e.message}`);break}throw e}switch(t){case"TMCL":case"TIPL":case"IPLS":f=d.functionList(this.splitValue(t,a));break;case"TRK":case"TRCK":case"TPOS":f=a;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":f=this.splitValue(t,a);break;case"TCO":case"TCON":f=this.splitValue(t,a).map((e=>function(e){const t=[];let a,i="";for(const r of e)if("string"==typeof a)if("("===r&&""===a)i+="(",a=void 0;else if(")"===r){""!==i&&(t.push(i),i="");const e=m(a);e&&t.push(e),a=void 0}else a+=r;else"("===r?a="":i+=r;return i&&(0===t.length&&i.match(/^\d*$/)&&(i=m(i)),i&&t.push(i)),t}(e))).reduce(((e,t)=>e.concat(t)),[]);break;case"PCS":case"PCST":f=this.major>=4?this.splitValue(t,a):[a],f=Array.isArray(f)&&""===f[0]?1:0;break;default:f=this.major>=4?this.splitValue(t,a):[a]}break}case"TXXX":{const a=d.readIdentifierAndData(e,p+1,c,n);f={description:a.id,text:this.splitValue(t,r.sc(a.data,n).replace(/\x00+$/,""))};break}case"PIC":case"APIC":if(a){const t={};switch(p+=1,this.major){case 2:t.format=r.sc(e.slice(p,p+3),"latin1"),p+=3;break;case 3:case 4:k=r.sX(e,p,c,u),t.format=r.sc(e.slice(p,k),u),p=k+1;break;default:throw function(e){throw new h(`Unexpected majorVer: ${e}`)}(this.major)}t.format=d.fixPictureMimeType(t.format),t.type=s.n5[e[p]],p+=1,k=r.sX(e,p,c,n),t.description=r.sc(e.slice(p,k),n),p=k+g,t.data=e.slice(p,c),f=t}break;case"CNT":case"PCNT":f=i.UINT32_BE.get(e,0);break;case"SYLT":{const t=s.aY.get(e,0);p+=s.aY.len;const a={descriptor:"",language:t.language,contentType:t.contentType,timeStampFormat:t.timeStampFormat,syncText:[]};let r=!1;for(;p<c;){const n=d.readNullTerminatedString(e.subarray(p),t.encoding);if(p+=n.len,r){const t=i.UINT32_BE.get(e,p);p+=i.UINT32_BE.len,a.syncText.push({text:n.text,timestamp:t})}else a.descriptor=n.text,r=!0}f=a;break}case"ULT":case"USLT":case"COM":case"COMM":{const t=s.Jp.get(e,p);p+=s.Jp.len;const a=d.readNullTerminatedString(e.subarray(p),t.encoding);p+=a.len;const i=d.readNullTerminatedString(e.subarray(p),t.encoding);f={language:t.language,descriptor:a.text,text:i.text};break}case"UFID":{const t=d.readIdentifierAndData(e,p,c,u);f={owner_identifier:t.id,identifier:t.data};break}case"PRIV":{const t=d.readIdentifierAndData(e,p,c,u);f={owner_identifier:t.id,data:t.data};break}case"POPM":{k=r.sX(e,p,c,u);const t=r.sc(e.slice(p,k),u);p=k+1;const a=c-p;f={email:t,rating:i.UINT8.get(e,p),counter:a>=5?i.UINT32_BE.get(e,p+1):void 0};break}case"GEOB":{k=r.sX(e,p+1,c,n);const t=r.sc(e.slice(p+1,k),u);p=k+1,k=r.sX(e,p,c,n);const a=r.sc(e.slice(p,k),u);p=k+1,k=r.sX(e,p,c,n);const i=r.sc(e.slice(p,k),u);p=k+1,f={type:t,filename:a,description:i,data:e.slice(p,c)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":k=r.sX(e,p+1,c,n),f=r.sc(e.slice(p,k),u);break;case"WXXX":{k=r.sX(e,p+1,c,n);const t=r.sc(e.slice(p+1,k),n);p=k+("utf-16le"===n?2:1),f={description:t,url:r.sc(e.slice(p,c),u)};break}case"WFD":case"WFED":f=r.sc(e.slice(p+1,r.sX(e,p+1,c,n)),n);break;case"MCDI":f=e.slice(0,c);break;default:l(`Warning: unsupported id3v2-tag-type: ${t}`)}return f}static readNullTerminatedString(e,t){let a=t.bom?2:0;const i=r.sX(e,a,e.length,t.encoding),n=e.slice(a,i);return a="utf-16le"===t.encoding?i+2:i+1,{text:r.sc(n,t.encoding),len:a}}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){const t={};for(let a=0;a+1<e.length;a+=2){const i=e[a+1].split(",");t[e[a]]=t[e[a]]?t[e[a]].concat(i):i}return t}splitValue(e,t){let a;return this.major<4?(a=t.split(/\x00/g),a.length>1?this.warningCollector.addWarning(`ID3v2.${this.major} ${e} uses non standard null-separator.`):a=t.split(/\//g)):a=t.split(/\x00/g),d.trimArray(a)}static trimArray(e){return e.map((e=>e.replace(/\x00+$/,"").trim()))}static readIdentifierAndData(e,t,a,i){const n=r.sX(e,t,a,i),s=r.sc(e.slice(t,n),i);return t=n+d.getNullTerminatorLength(i),{id:s,data:e.slice(t,a)}}static getNullTerminatorLength(e){return"utf-16le"===e?2:1}}class h extends((0,c.fO)("id3v2")){}const p=new TextDecoder("ascii");class f{constructor(){this.tokenizer=void 0,this.id3Header=void 0,this.metadata=void 0,this.headerType=void 0,this.options=void 0}static removeUnsyncBytes(e){let t=0,a=0;for(;t<e.length-1;)t!==a&&(e[a]=e[t]),t+=255===e[t]&&0===e[t+1]?2:1,a++;return t<e.length&&(e[a++]=e[t]),e.slice(0,a)}static getFrameHeaderLength(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw g(e)}}static readFrameFlags(e){return{status:{tag_alter_preservation:r.mh(e,0,6),file_alter_preservation:r.mh(e,0,5),read_only:r.mh(e,0,4)},format:{grouping_identity:r.mh(e,1,7),compression:r.mh(e,1,3),encryption:r.mh(e,1,2),unsynchronisation:r.mh(e,1,1),data_length_indicator:r.mh(e,1,0)}}}static readFrameData(e,t,a,i,r){const n=new d(a,r);switch(a){case 2:return n.readData(e,t.id,i);case 3:case 4:return t.flags?.format.unsynchronisation&&(e=f.removeUnsyncBytes(e)),t.flags?.format.data_length_indicator&&(e=e.slice(4,e.length)),n.readData(e,t.id,i);default:throw g(a)}}static makeDescriptionTagName(e,t){return e+(t?`:${t}`:"")}async parse(e,t,a){this.tokenizer=t,this.metadata=e,this.options=a;const i=await this.tokenizer.readToken(s.yW);if("ID3"!==i.fileIdentifier)throw new h("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=i,this.headerType=`ID3v2.${i.version.major}`,i.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(i.size)}async parseExtendedHeader(){const e=await this.tokenizer.readToken(s.nl),t=e.size-s.nl.len;return t>0?this.parseExtendedHeaderData(t,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,t){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-t)}async parseId3Data(e){const t=await this.tokenizer.readToken(new i.Uint8ArrayType(e));for(const e of this.parseMetadata(t))"TXXX"===e.id?e.value&&await this.handleTag(e,e.value.text,(()=>e.value.description)):await(Array.isArray(e.value)?Promise.all(e.value.map((t=>this.addTag(e.id,t)))):this.addTag(e.id,e.value))}async handleTag(e,t,a,i=e=>e){await Promise.all(t.map((t=>this.addTag(f.makeDescriptionTagName(e.id,a(t)),i(t)))))}async addTag(e,t){await this.metadata.addTag(this.headerType,e,t)}parseMetadata(e){let t=0;const a=[];for(;t!==e.length;){const i=f.getFrameHeaderLength(this.id3Header.version.major);if(t+i>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const r=e.slice(t,t+i);t+=i;const n=this.readFrameHeader(r,this.id3Header.version.major),s=e.slice(t,t+n.length);t+=n.length;const o=f.readFrameData(s,n,this.id3Header.version.major,!this.options.skipCovers,this.metadata);o&&a.push({id:n.id,value:o})}return a}readFrameHeader(e,t){let a;switch(t){case 2:a={id:p.decode(e.slice(0,3)),length:i.UINT24_BE.get(e,3)},a.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${a.id}`);break;case 3:case 4:a={id:p.decode(e.slice(0,4)),length:(4===t?s.St:i.UINT32_BE).get(e,4),flags:f.readFrameFlags(e.slice(8,10))},a.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning(`Invalid ID3v2.${this.id3Header.version.major} frame-header-ID: ${a.id}`);break;default:throw g(t)}return a}}function g(e){throw new h(`Unexpected majorVer: ${e}`)}},626:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AsfParser:()=>M});var i=a(833),r=a(207),n=a(523);class s{static fromBin(e,t=0){return new s(s.decode(e,t))}static decode(e,t=0){const a=new DataView(e.buffer,t);return`${a.getUint32(0,!0).toString(16)}-${a.getUint16(4,!0).toString(16)}-${a.getUint16(6,!0).toString(16)}-${a.getUint16(8).toString(16)}-${(0,n.EY)(e.slice(t+10,t+16))}`.toUpperCase()}static decodeMediaType(e){switch(e.str){case s.AudioMedia.str:return"audio";case s.VideoMedia.str:return"video";case s.CommandMedia.str:return"command";case s.Degradable_JPEG_Media.str:return"degradable-jpeg";case s.FileTransferMedia.str:return"file-transfer";case s.BinaryMedia.str:return"binary"}}static encode(e){const t=new Uint8Array(16),a=new DataView(t.buffer);return a.setUint32(0,Number.parseInt(e.slice(0,8),16),!0),a.setUint16(4,Number.parseInt(e.slice(9,13),16),!0),a.setUint16(6,Number.parseInt(e.slice(14,18),16),!0),t.set((0,n.AS)(e.slice(19,23)),8),t.set((0,n.AS)(e.slice(24)),10),t}constructor(e){this.str=e}equals(e){return this.str===e.str}toBin(){return s.encode(this.str)}}s.HeaderObject=new s("75B22630-668E-11CF-A6D9-00AA0062CE6C"),s.DataObject=new s("75B22636-668E-11CF-A6D9-00AA0062CE6C"),s.SimpleIndexObject=new s("33000890-E5B1-11CF-89F4-00A0C90349CB"),s.IndexObject=new s("D6E229D3-35DA-11D1-9034-00A0C90349BE"),s.MediaObjectIndexObject=new s("FEB103F8-12AD-4C64-840F-2A1D2F7AD48C"),s.TimecodeIndexObject=new s("3CB73FD0-0C4A-4803-953D-EDF7B6228F0C"),s.FilePropertiesObject=new s("8CABDCA1-A947-11CF-8EE4-00C00C205365"),s.StreamPropertiesObject=new s("B7DC0791-A9B7-11CF-8EE6-00C00C205365"),s.HeaderExtensionObject=new s("5FBF03B5-A92E-11CF-8EE3-00C00C205365"),s.CodecListObject=new s("86D15240-311D-11D0-A3A4-00A0C90348F6"),s.ScriptCommandObject=new s("1EFB1A30-0B62-11D0-A39B-00A0C90348F6"),s.MarkerObject=new s("F487CD01-A951-11CF-8EE6-00C00C205365"),s.BitrateMutualExclusionObject=new s("D6E229DC-35DA-11D1-9034-00A0C90349BE"),s.ErrorCorrectionObject=new s("75B22635-668E-11CF-A6D9-00AA0062CE6C"),s.ContentDescriptionObject=new s("75B22633-668E-11CF-A6D9-00AA0062CE6C"),s.ExtendedContentDescriptionObject=new s("D2D0A440-E307-11D2-97F0-00A0C95EA850"),s.ContentBrandingObject=new s("2211B3FA-BD23-11D2-B4B7-00A0C955FC6E"),s.StreamBitratePropertiesObject=new s("7BF875CE-468D-11D1-8D82-006097C9A2B2"),s.ContentEncryptionObject=new s("2211B3FB-BD23-11D2-B4B7-00A0C955FC6E"),s.ExtendedContentEncryptionObject=new s("298AE614-2622-4C17-B935-DAE07EE9289C"),s.DigitalSignatureObject=new s("2211B3FC-BD23-11D2-B4B7-00A0C955FC6E"),s.PaddingObject=new s("1806D474-CADF-4509-A4BA-9AABCB96AAE8"),s.ExtendedStreamPropertiesObject=new s("14E6A5CB-C672-4332-8399-A96952065B5A"),s.AdvancedMutualExclusionObject=new s("A08649CF-4775-4670-8A16-6E35357566CD"),s.GroupMutualExclusionObject=new s("D1465A40-5A79-4338-B71B-E36B8FD6C249"),s.StreamPrioritizationObject=new s("D4FED15B-88D3-454F-81F0-ED5C45999E24"),s.BandwidthSharingObject=new s("A69609E6-517B-11D2-B6AF-00C04FD908E9"),s.LanguageListObject=new s("7C4346A9-EFE0-4BFC-B229-393EDE415C85"),s.MetadataObject=new s("C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA"),s.MetadataLibraryObject=new s("44231C94-9498-49D1-A141-1D134E457054"),s.IndexParametersObject=new s("D6E229DF-35DA-11D1-9034-00A0C90349BE"),s.MediaObjectIndexParametersObject=new s("6B203BAD-3F11-48E4-ACA8-D7613DE2CFA7"),s.TimecodeIndexParametersObject=new s("F55E496D-9797-4B5D-8C8B-604DFE9BFB24"),s.CompatibilityObject=new s("26F18B5D-4584-47EC-9F5F-0E651F0452C9"),s.AdvancedContentEncryptionObject=new s("43058533-6981-49E6-9B74-AD12CB86D58C"),s.AudioMedia=new s("F8699E40-5B4D-11CF-A8FD-00805F5C442B"),s.VideoMedia=new s("BC19EFC0-5B4D-11CF-A8FD-00805F5C442B"),s.CommandMedia=new s("59DACFC0-59E6-11D0-A3AC-00A0C90348F6"),s.JFIF_Media=new s("B61BE100-5B4E-11CF-A8FD-00805F5C442B"),s.Degradable_JPEG_Media=new s("35907DE0-E415-11CF-A917-00805F5C442B"),s.FileTransferMedia=new s("91BD222C-F21C-497A-8B6D-5AA86BFC0185"),s.BinaryMedia=new s("3AFB65E2-47EF-40F2-AC2C-70A90D71D343"),s.ASF_Index_Placeholder_Object=new s("D9AADE20-7C17-4F9C-BC28-8555DD98E2A2");const o=s;var c=a(17),l=a(185);function u(e){return l.F6(l.sc(e,"utf-16le"))}const m=[u,d,function(e,t=0){return 1===h(e,t)},function(e,t=0){return c.UINT32_LE.get(e,t)},function(e,t=0){return c.UINT64_LE.get(e,t)},h,d];function d(e){return new Uint8Array(e)}function h(e,t=0){return c.UINT16_LE.get(e,t)}var p=a(675),f=a(324);class g extends((0,f.fO)("ASF")){}const k={len:30,get:(e,t)=>({objectId:o.fromBin(e,t),objectSize:Number(c.UINT64_LE.get(e,t+16)),numberOfHeaderObjects:c.UINT32_LE.get(e,t+24)})},T={len:24,get:(e,t)=>({objectId:o.fromBin(e,t),objectSize:Number(c.UINT64_LE.get(e,t+16))})};class b{constructor(e){this.len=Number(e.objectSize)-T.len}postProcessTag(e,t,a,i){if("WM/Picture"===t)e.push({id:t,value:N.fromBuffer(i)});else{const r=m[a];if(!r)throw new g(`unexpected value headerType: ${a}`);e.push({id:t,value:r(i)})}}}class w extends b{get(e,t){return null}}class y extends b{get(e,t){return{fileId:o.fromBin(e,t),fileSize:c.UINT64_LE.get(e,t+16),creationDate:c.UINT64_LE.get(e,t+24),dataPacketsCount:c.UINT64_LE.get(e,t+32),playDuration:c.UINT64_LE.get(e,t+40),sendDuration:c.UINT64_LE.get(e,t+48),preroll:c.UINT64_LE.get(e,t+56),flags:{broadcast:l.mh(e,t+64,24),seekable:l.mh(e,t+64,25)},minimumDataPacketSize:c.UINT32_LE.get(e,t+68),maximumDataPacketSize:c.UINT32_LE.get(e,t+72),maximumBitrate:c.UINT32_LE.get(e,t+76)}}}y.guid=o.FilePropertiesObject;class I extends b{get(e,t){return{streamType:o.decodeMediaType(o.fromBin(e,t)),errorCorrectionType:o.fromBin(e,t+8)}}}I.guid=o.StreamPropertiesObject;class v{constructor(){this.len=22}get(e,t){const a=new DataView(e.buffer,t);return{reserved1:o.fromBin(e,t),reserved2:a.getUint16(16,!0),extensionDataSize:a.getUint16(18,!0)}}}v.guid=o.HeaderExtensionObject;const S={len:20,get:(e,t)=>({entryCount:new DataView(e.buffer,t).getUint16(16,!0)})};async function x(e){const t=await e.readNumber(c.UINT16_LE);return(await e.readToken(new c.StringType(2*t,"utf-16le"))).replace("\0","")}async function E(e){const t=await e.readToken(S),a=[];for(let i=0;i<t.entryCount;++i)a.push(await A(e));return a}async function C(e){const t=await e.readNumber(c.UINT16_LE),a=new Uint8Array(t);return await e.readBuffer(a),a}async function A(e){const t=await e.readNumber(c.UINT16_LE);return{type:{videoCodec:!(1&~t),audioCodec:!(2&~t)},codecName:await x(e),description:await x(e),information:await C(e)}}class _ extends b{get(e,t){const a=[],i=new DataView(e.buffer,t);let r=10;for(let n=0;n<_.contentDescTags.length;++n){const s=i.getUint16(2*n,!0);if(s>0){const i=_.contentDescTags[n],o=r+s;a.push({id:i,value:u(e.slice(t+r,t+o))}),r=o}}return a}}_.guid=o.ContentDescriptionObject,_.contentDescTags=["Title","Author","Copyright","Description","Rating"];class z extends b{get(e,t){const a=[],i=new DataView(e.buffer,t),r=i.getUint16(0,!0);let n=2;for(let s=0;s<r;s+=1){const r=i.getUint16(n,!0);n+=2;const s=u(e.slice(t+n,t+n+r));n+=r;const o=i.getUint16(n,!0);n+=2;const c=i.getUint16(n,!0);n+=2;const l=e.slice(t+n,t+n+c);n+=c,this.postProcessTag(a,s,o,l)}return a}}z.guid=o.ExtendedContentDescriptionObject;class F extends b{get(e,t){const a=new DataView(e.buffer,t);return{startTime:c.UINT64_LE.get(e,t),endTime:c.UINT64_LE.get(e,t+8),dataBitrate:a.getInt32(12,!0),bufferSize:a.getInt32(16,!0),initialBufferFullness:a.getInt32(20,!0),alternateDataBitrate:a.getInt32(24,!0),alternateBufferSize:a.getInt32(28,!0),alternateInitialBufferFullness:a.getInt32(32,!0),maximumObjectSize:a.getInt32(36,!0),flags:{reliableFlag:l.mh(e,t+40,0),seekableFlag:l.mh(e,t+40,1),resendLiveCleanpointsFlag:l.mh(e,t+40,2)},streamNumber:a.getInt16(42,!0),streamLanguageId:a.getInt16(44,!0),averageTimePerFrame:a.getInt32(52,!0),streamNameCount:a.getInt32(54,!0),payloadExtensionSystems:a.getInt32(56,!0),streamNames:[],streamPropertiesObject:null}}}F.guid=o.ExtendedStreamPropertiesObject;class B extends b{get(e,t){const a=[],i=new DataView(e.buffer,t),r=i.getUint16(0,!0);let n=2;for(let s=0;s<r;s+=1){n+=4;const r=i.getUint16(n,!0);n+=2;const s=i.getUint16(n,!0);n+=2;const o=i.getUint32(n,!0);n+=4;const c=u(e.slice(t+n,t+n+r));n+=r;const l=e.slice(t+n,t+n+o);n+=o,this.postProcessTag(a,c,s,l)}return a}}B.guid=o.MetadataObject;class D extends B{}D.guid=o.MetadataLibraryObject;class N{static fromBuffer(e){return new N(e.length).get(e,0)}constructor(e){this.len=e}get(e,t){const a=new DataView(e.buffer,t),i=a.getUint8(0),r=a.getInt32(1,!0);let n=5;for(;0!==a.getUint16(n);)n+=2;const s=new c.StringType(n-5,"utf-16le").get(e,5);for(;0!==a.getUint16(n);)n+=2;const o=new c.StringType(n-5,"utf-16le").get(e,5);return{type:p.n5[i],format:s,description:o,size:r,data:e.slice(n+4)}}}var P=a(604);const U=i("music-metadata:parser:ASF");class M extends P.s{async parse(){const e=await this.tokenizer.readToken(k);if(!e.objectId.equals(o.HeaderObject))throw new g(`expected asf header; but was not found; got: ${e.objectId.str}`);try{await this.parseObjectHeader(e.numberOfHeaderObjects)}catch(e){U("Error while parsing ASF: %s",e)}}async parseObjectHeader(e){let t;do{const e=await this.tokenizer.readToken(T);switch(U("header GUID=%s",e.objectId.str),e.objectId.str){case y.guid.str:{const t=await this.tokenizer.readToken(new y(e));this.metadata.setFormat("duration",Number(t.playDuration/BigInt(1e3))/1e4-Number(t.preroll)/1e3),this.metadata.setFormat("bitrate",t.maximumBitrate);break}case I.guid.str:{const t=await this.tokenizer.readToken(new I(e));this.metadata.setFormat("container",`ASF/${t.streamType}`);break}case v.guid.str:{const e=await this.tokenizer.readToken(new v);await this.parseExtensionObject(e.extensionDataSize);break}case _.guid.str:t=await this.tokenizer.readToken(new _(e)),await this.addTags(t);break;case z.guid.str:t=await this.tokenizer.readToken(new z(e)),await this.addTags(t);break;case o.CodecListObject.str:{const e=await E(this.tokenizer);e.forEach((e=>{this.metadata.addStreamInfo({type:e.type.videoCodec?r.S.video:r.S.audio,codecName:e.codecName})}));const t=e.filter((e=>e.type.audioCodec)).map((e=>e.codecName)).join("/");this.metadata.setFormat("codec",t);break}case o.StreamBitratePropertiesObject.str:await this.tokenizer.ignore(e.objectSize-T.len);break;case o.PaddingObject.str:U("Padding: %s bytes",e.objectSize-T.len),await this.tokenizer.ignore(e.objectSize-T.len);break;default:this.metadata.addWarning(`Ignore ASF-Object-GUID: ${e.objectId.str}`),U("Ignore ASF-Object-GUID: %s",e.objectId.str),await this.tokenizer.readToken(new w(e))}}while(--e)}async addTags(e){await Promise.all(e.map((({id:e,value:t})=>this.metadata.addTag("asf",e,t))))}async parseExtensionObject(e){do{const t=await this.tokenizer.readToken(T),a=t.objectSize-T.len;switch(t.objectId.str){case F.guid.str:await this.tokenizer.readToken(new F(t));break;case B.guid.str:{const e=await this.tokenizer.readToken(new B(t));await this.addTags(e);break}case D.guid.str:{const e=await this.tokenizer.readToken(new D(t));await this.addTags(e);break}case o.PaddingObject.str:case o.CompatibilityObject.str:case o.ASF_Index_Placeholder_Object.str:await this.tokenizer.ignore(a);break;default:this.metadata.addWarning(`Ignore ASF-Object-GUID: ${t.objectId.str}`),await this.tokenizer.readToken(new w(t))}e-=t.objectSize}while(e>0)}}},628:(e,t,a)=>{"use strict";a.r(t),a.d(t,{OggContentError:()=>T,OggParser:()=>y,SegmentTable:()=>w});var i=a(17),r=a(853),n=a(833),s=a(185),o=a(31),c=a(604),l=a(427),u=a(324);class m extends((0,u.fO)("Opus")){}class d{constructor(e){if(e<19)throw new m("ID-header-page 0 should be at least 19 bytes long");this.len=e}get(e,t){return{magicSignature:new i.StringType(8,"ascii").get(e,t+0),version:i.UINT8.get(e,t+8),channelCount:i.UINT8.get(e,t+9),preSkip:i.UINT16_LE.get(e,t+10),inputSampleRate:i.UINT32_LE.get(e,t+12),outputGain:i.UINT16_LE.get(e,t+16),channelMapping:i.UINT8.get(e,t+18)}}}class h extends l.J{constructor(e,t,a){super(e,t),this.idHeader=null,this.lastPos=-1,this.tokenizer=a}parseFirstPage(e,t){if(this.metadata.setFormat("codec","Opus"),this.idHeader=new d(t.length).get(t,0),"OpusHead"!==this.idHeader.magicSignature)throw new m("Illegal ogg/Opus magic-signature");this.metadata.setFormat("sampleRate",this.idHeader.inputSampleRate),this.metadata.setFormat("numberOfChannels",this.idHeader.channelCount)}async parseFullPage(e){"OpusTags"===new i.StringType(8,"ascii").get(e,0)&&(await this.parseUserCommentList(e,8),this.lastPos=this.tokenizer.position-e.length)}calculateDuration(e){if(this.metadata.format.sampleRate&&e.absoluteGranulePosition>=0){const t=e.absoluteGranulePosition-this.idHeader.preSkip;if(this.metadata.setFormat("numberOfSamples",t),this.metadata.setFormat("duration",t/48e3),-1!==this.lastPos&&this.tokenizer.fileInfo.size&&this.metadata.format.duration){const e=this.tokenizer.fileInfo.size-this.lastPos;this.metadata.setFormat("bitrate",8*e/this.metadata.format.duration)}}}}const p=n("music-metadata:parser:ogg:speex");class f extends l.J{constructor(e,t,a){super(e,t),this.tokenizer=a}parseFirstPage(e,t){p("First Ogg/Speex page");const a=(r=t,n=0,{speex:new i.StringType(8,"ascii").get(r,n+0),version:s.qW(new i.StringType(20,"ascii").get(r,n+8)),version_id:i.INT32_LE.get(r,n+28),header_size:i.INT32_LE.get(r,n+32),rate:i.INT32_LE.get(r,n+36),mode:i.INT32_LE.get(r,n+40),mode_bitstream_version:i.INT32_LE.get(r,n+44),nb_channels:i.INT32_LE.get(r,n+48),bitrate:i.INT32_LE.get(r,n+52),frame_size:i.INT32_LE.get(r,n+56),vbr:i.INT32_LE.get(r,n+60),frames_per_packet:i.INT32_LE.get(r,n+64),extra_headers:i.INT32_LE.get(r,n+68),reserved1:i.INT32_LE.get(r,n+72),reserved2:i.INT32_LE.get(r,n+76)});var r,n;this.metadata.setFormat("codec",`Speex ${a.version}`),this.metadata.setFormat("numberOfChannels",a.nb_channels),this.metadata.setFormat("sampleRate",a.rate),-1!==a.bitrate&&this.metadata.setFormat("bitrate",a.bitrate)}}const g=n("music-metadata:parser:ogg:theora");class k{constructor(e,t,a){this.metadata=e,this.tokenizer=a}async parsePage(e,t){e.headerType.firstPage&&await this.parseFirstPage(e,t)}async flush(){g("flush")}calculateDuration(e){g("duration calculation not implemented")}async parseFirstPage(e,t){g("First Ogg/Theora page"),this.metadata.setFormat("codec","Theora");const a=(r=t,n=0,{id:new i.StringType(7,"ascii").get(r,n),vmaj:i.UINT8.get(r,n+7),vmin:i.UINT8.get(r,n+8),vrev:i.UINT8.get(r,n+9),vmbw:i.UINT16_BE.get(r,n+10),vmbh:i.UINT16_BE.get(r,n+17),nombr:i.UINT24_BE.get(r,n+37),nqual:i.UINT8.get(r,n+40)});var r,n;this.metadata.setFormat("bitrate",a.nombr)}}class T extends((0,u.fO)("Ogg")){}const b=n("music-metadata:parser:ogg");class w{static sum(e,t,a){const i=new DataView(e.buffer,0);let r=0;for(let e=t;e<t+a;++e)r+=i.getUint8(e);return r}constructor(e){this.len=e.page_segments}get(e,t){return{totalPageSize:w.sum(e,t,this.len)}}}class y extends c.s{constructor(){super(...arguments),this.header=null,this.pageNumber=0,this.pageConsumer=null}async parse(){b("pos=%s, parsePage()",this.tokenizer.position);try{let e;do{if(e=await this.tokenizer.readToken(y.Header),"OggS"!==e.capturePattern)throw new T("Invalid Ogg capture pattern");this.metadata.setFormat("container","Ogg"),this.header=e,this.pageNumber=e.pageSequenceNo,b("page#=%s, Ogg.id=%s",e.pageSequenceNo,e.capturePattern);const t=await this.tokenizer.readToken(new w(e));b("totalPageSize=%s",t.totalPageSize);const a=await this.tokenizer.readToken(new i.Uint8ArrayType(t.totalPageSize));if(b("firstPage=%s, lastPage=%s, continued=%s",e.headerType.firstPage,e.headerType.lastPage,e.headerType.continued),e.headerType.firstPage){const e=new TextDecoder("ascii").decode(a.subarray(0,7));switch(e){case"vorbis":b("Set page consumer to Ogg/Vorbis"),this.pageConsumer=new l.J(this.metadata,this.options);break;case"OpusHea":b("Set page consumer to Ogg/Opus"),this.pageConsumer=new h(this.metadata,this.options,this.tokenizer);break;case"Speex  ":b("Set page consumer to Ogg/Speex"),this.pageConsumer=new f(this.metadata,this.options,this.tokenizer);break;case"fishead":case"\0theora":b("Set page consumer to Ogg/Theora"),this.pageConsumer=new k(this.metadata,this.options,this.tokenizer);break;default:throw new T(`gg audio-codec not recognized (id=${e})`)}}await this.pageConsumer.parsePage(e,a)}while(!e.headerType.lastPage)}catch(e){if(!(e instanceof Error))throw e;e instanceof r.d1?(this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),b("End-of-stream"),this.metadata.addWarning("Last OGG-page is not marked with last-page flag"),this.header&&this.pageConsumer.calculateDuration(this.header)):e.message.startsWith("FourCC")&&this.pageNumber>0&&(this.metadata.addWarning("Invalid FourCC ID, maybe last OGG-page is not marked with last-page flag"),await this.pageConsumer.flush())}}}y.Header={len:27,get:(e,t)=>({capturePattern:o.e.get(e,t),version:i.UINT8.get(e,t+4),headerType:{continued:s.mh(e,t+5,0),firstPage:s.mh(e,t+5,1),lastPage:s.mh(e,t+5,2)},absoluteGranulePosition:Number(i.UINT64_LE.get(e,t+6)),streamSerialNumber:i.UINT32_LE.get(e,t+14),pageSequenceNo:i.UINT32_LE.get(e,t+18),pageChecksum:i.UINT32_LE.get(e,t+22),page_segments:i.UINT8.get(e,t+26)})}},675:(e,t,a)=>{"use strict";a.d(t,{Jp:()=>d,MW:()=>s,St:()=>c,YF:()=>m,aY:()=>h,n5:()=>n,nl:()=>u,sd:()=>o,yW:()=>l});var i=a(17),r=a(185);const n={0:"Other",1:"32x32 pixels 'file icon' (PNG only)",2:"Other file icon",3:"Cover (front)",4:"Cover (back)",5:"Leaflet page",6:"Media (e.g. label side of CD)",7:"Lead artist/lead performer/soloist",8:"Artist/performer",9:"Conductor",10:"Band/Orchestra",11:"Composer",12:"Lyricist/text writer",13:"Recording Location",14:"During recording",15:"During performance",16:"Movie/video screen capture",17:"A bright coloured fish",18:"Illustration",19:"Band/artist logotype",20:"Publisher/Studio logotype"},s={other:0,lyrics:1,text:2,movement_part:3,events:4,chord:5,trivia_pop:6},o={notSynchronized0:0,mpegFrameNumber:1,milliseconds:2},c={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4},l={len:10,get:(e,t)=>({fileIdentifier:new i.StringType(3,"ascii").get(e,t),version:{major:i.INT8.get(e,t+3),revision:i.INT8.get(e,t+4)},flags:{unsynchronisation:r.mh(e,t+5,7),isExtendedHeader:r.mh(e,t+5,6),expIndicator:r.mh(e,t+5,5),footer:r.mh(e,t+5,4)},size:c.get(e,t+6)})},u={len:10,get:(e,t)=>({size:i.UINT32_BE.get(e,t),extendedFlags:i.UINT16_BE.get(e,t+4),sizeOfPadding:i.UINT32_BE.get(e,t+6),crcDataPresent:r.mh(e,t+4,31)})},m={len:1,get:(e,t)=>{switch(e[t]){case 0:return{encoding:"latin1"};case 1:return{encoding:"utf-16le",bom:!0};case 2:return{encoding:"utf-16le",bom:!1};default:return{encoding:"utf8",bom:!1}}}},d={len:4,get:(e,t)=>({encoding:m.get(e,t),language:new i.StringType(3,"latin1").get(e,t+1)})},h={len:6,get:(e,t)=>{const a=d.get(e,t);return{encoding:a.encoding,language:a.language,timeStampFormat:i.UINT8.get(e,t+4),contentType:i.UINT8.get(e,t+5)}}}},709:(e,t,a)=>{"use strict";a.d(t,{Xs:()=>ge,cc:()=>ke});var i=a(853),r=a(17);class n extends Error{constructor(){super("End-Of-Stream")}}class s{constructor(){this.maxStreamReadSize=1048576,this.endOfStream=!1,this.peekQueue=[]}async peek(e,t,a){const i=await this.read(e,t,a);return this.peekQueue.push(e.subarray(t,t+i)),i}async read(e,t,a){if(0===a)return 0;let i=this.readFromPeekBuffer(e,t,a);if(i+=await this.readRemainderFromStream(e,t+i,a-i),0===i)throw new n;return i}readFromPeekBuffer(e,t,a){let i=a,r=0;for(;this.peekQueue.length>0&&i>0;){const a=this.peekQueue.pop();if(!a)throw new Error("peekData should be defined");const n=Math.min(a.length,i);e.set(a.subarray(0,n),t+r),r+=n,i-=n,n<a.length&&this.peekQueue.push(a.subarray(n))}return r}async readRemainderFromStream(e,t,a){let i=a,r=0;for(;i>0&&!this.endOfStream;){const a=Math.min(i,this.maxStreamReadSize),n=await this.readFromStream(e,t+r,a);if(0===n)break;r+=n,i-=n}return r}}class o extends s{constructor(e){super(),this.reader=e.getReader({mode:"byob"})}async readFromStream(e,t,a){if(this.endOfStream)throw new n;const i=await this.reader.read(new Uint8Array(a));return i.done&&(this.endOfStream=i.done),i.value?(e.set(i.value,t),i.value.byteLength):0}abort(){return this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}class c{constructor(e){this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=e?.onClose,e?.abortSignal&&e.abortSignal.addEventListener("abort",(()=>{this.abort()}))}async readToken(e,t=this.position){const a=new Uint8Array(e.len);if(await this.readBuffer(a,{position:t})<e.len)throw new n;return e.get(a,0)}async peekToken(e,t=this.position){const a=new Uint8Array(e.len);if(await this.peekBuffer(a,{position:t})<e.len)throw new n;return e.get(a,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new n;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new n;return e.get(this.numBuffer,0)}async ignore(e){if(void 0!==this.fileInfo.size){const t=this.fileInfo.size-this.position;if(e>t)return this.position+=t,t}return this.position+=e,e}async close(){await this.abort(),await(this.onClose?.())}normalizeOptions(e,t){if(t&&void 0!==t.position&&t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return t?{mayBeLess:!0===t.mayBeLess,offset:t.offset?t.offset:0,length:t.length?t.length:e.length-(t.offset?t.offset:0),position:t.position?t.position:this.position}:{mayBeLess:!1,offset:0,length:e.length,position:this.position}}abort(){return Promise.resolve()}}class l extends c{constructor(e,t){super(t),this.streamReader=e,this.fileInfo=t?.fileInfo??{}}async readBuffer(e,t){const a=this.normalizeOptions(e,t),i=a.position-this.position;if(i>0)return await this.ignore(i),this.readBuffer(e,t);if(i<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(0===a.length)return 0;const r=await this.streamReader.read(e,a.offset,a.length);if(this.position+=r,(!t||!t.mayBeLess)&&r<a.length)throw new n;return r}async peekBuffer(e,t){const a=this.normalizeOptions(e,t);let i=0;if(a.position){const t=a.position-this.position;if(t>0){const r=new Uint8Array(a.length+t);return i=await this.peekBuffer(r,{mayBeLess:a.mayBeLess}),e.set(r.subarray(t),a.offset),i-t}if(t<0)throw new Error("Cannot peek from a negative offset in a stream")}if(a.length>0){try{i=await this.streamReader.peek(e,a.offset,a.length)}catch(e){if(t?.mayBeLess&&e instanceof n)return 0;throw e}if(!a.mayBeLess&&i<a.length)throw new n}return i}async ignore(e){const t=Math.min(256e3,e),a=new Uint8Array(t);let i=0;for(;i<e;){const r=e-i,n=await this.readBuffer(a,{length:Math.min(t,r)});if(n<0)return n;i+=n}return i}abort(){return this.streamReader.abort()}supportsRandomAccess(){return!1}}class u extends c{constructor(e,t){super(t),this.uint8Array=e,this.fileInfo={...t?.fileInfo??{},size:e.length}}async readBuffer(e,t){if(t?.position){if(t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");this.position=t.position}const a=await this.peekBuffer(e,t);return this.position+=a,a}async peekBuffer(e,t){const a=this.normalizeOptions(e,t),i=Math.min(this.uint8Array.length-a.position,a.length);if(!a.mayBeLess&&i<a.length)throw new n;return e.set(this.uint8Array.subarray(a.position,a.position+i),a.offset),i}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(e){this.position=e}}var m=a(523);const d={get:(e,t)=>127&e[t+3]|e[t+2]<<7|e[t+1]<<14|e[t]<<21,len:4},h=4100;async function p(e){return(new g).fromBuffer(e)}function f(e,t,a){a={offset:0,...a};for(const[i,r]of t.entries())if(a.mask){if(r!==(a.mask[i]&e[i+a.offset]))return!1}else if(r!==e[i+a.offset])return!1;return!0}class g{constructor(e){this.detectors=e?.customDetectors,this.tokenizerOptions={abortSignal:e?.signal},this.fromTokenizer=this.fromTokenizer.bind(this),this.fromBuffer=this.fromBuffer.bind(this),this.parse=this.parse.bind(this)}async fromTokenizer(e){const t=e.position;for(const a of this.detectors||[]){const i=await a(e);if(i)return i;if(t!==e.position)return}return this.parse(e)}async fromBuffer(e){if(!(e instanceof Uint8Array||e instanceof ArrayBuffer))throw new TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof e}\``);const t=e instanceof Uint8Array?e:new Uint8Array(e);var a,i;if(t?.length>1)return this.fromTokenizer((a=t,i=this.tokenizerOptions,new u(a,i)))}async fromBlob(e){return this.fromStream(e.stream())}async fromStream(e){const t=await(a=e,i=this.tokenizerOptions,new l(new o(a),i));var a,i;try{return await this.fromTokenizer(t)}finally{await t.close()}}async toDetectionStream(e,t){const{sampleSize:a=h}=t;let i,r;const s=e.getReader({mode:"byob"});try{const{value:e,done:t}=await s.read(new Uint8Array(a));if(r=e,!t&&e)try{i=await this.fromBuffer(e.slice(0,a))}catch(e){if(!(e instanceof n))throw e;i=void 0}r=e}finally{s.releaseLock()}const o=new TransformStream({async start(e){e.enqueue(r)},transform(e,t){t.enqueue(e)}}),c=e.pipeThrough(o);return c.fileType=i,c}check(e,t){return f(this.buffer,e,t)}checkString(e,t){return this.check((a=e,[...a].map((e=>e.charCodeAt(0)))),t);var a}async parse(e){if(this.buffer=new Uint8Array(h),void 0===e.fileInfo.size&&(e.fileInfo.size=Number.MAX_SAFE_INTEGER),this.tokenizer=e,await e.peekBuffer(this.buffer,{length:12,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33]))return await e.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14})?{ext:"eps",mime:"application/eps"}:{ext:"ps",mime:"application/postscript"};if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.parse(e);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8]))return{ext:"gz",mime:"application/gzip"};if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await e.ignore(6);const t=await e.readToken(d);return e.position+t>e.fileInfo.size?{ext:"mp3",mime:"audio/mpeg"}:(await e.ignore(t),this.fromTokenizer(e))}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((67===this.buffer[0]||70===this.buffer[0])&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255]))return this.check([247],{offset:3})?{ext:"jls",mime:"image/jls"}:{ext:"jpg",mime:"image/jpeg"};if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){try{for(;e.position+30<e.fileInfo.size;){await e.readBuffer(this.buffer,{length:30});const a=new DataView(this.buffer.buffer),i={compressedSize:a.getUint32(18,!0),uncompressedSize:a.getUint32(22,!0),filenameLength:a.getUint16(26,!0),extraFieldLength:a.getUint16(28,!0)};if(i.filename=await e.readToken(new r.StringType(i.filenameLength,"utf-8")),await e.ignore(i.extraFieldLength),/classes\d*\.dex/.test(i.filename))return{ext:"apk",mime:"application/vnd.android.package-archive"};if("META-INF/mozilla.rsa"===i.filename)return{ext:"xpi",mime:"application/x-xpinstall"};if(i.filename.endsWith(".rels")||i.filename.endsWith(".xml"))switch(i.filename.split("/")[0]){case"_rels":default:break;case"word":return{ext:"docx",mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};case"ppt":return{ext:"pptx",mime:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};case"xl":return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};case"visio":return{ext:"vsdx",mime:"application/vnd.visio"}}if(i.filename.startsWith("xl/"))return{ext:"xlsx",mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"};if(i.filename.startsWith("3D/")&&i.filename.endsWith(".model"))return{ext:"3mf",mime:"model/3mf"};if("mimetype"===i.filename&&i.compressedSize===i.uncompressedSize){let s=await e.readToken(new r.StringType(i.compressedSize,"utf-8"));switch(s=s.trim(),s){case"application/epub+zip":return{ext:"epub",mime:"application/epub+zip"};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:"application/vnd.oasis.opendocument.text"};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:"application/vnd.oasis.opendocument.spreadsheet"};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:"application/vnd.oasis.opendocument.presentation"}}}if(0===i.compressedSize){let o=-1;for(;o<0&&e.position<e.fileInfo.size;)await e.peekBuffer(this.buffer,{mayBeLess:!0}),o=(0,m.qh)(this.buffer,new Uint8Array([80,75,3,4])),await e.ignore(o>=0?o:this.buffer.length)}else await e.ignore(i.compressedSize)}}catch(c){if(!(c instanceof n))throw c}return{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await e.ignore(28);const l=new Uint8Array(8);return await e.readBuffer(l),f(l,[79,112,117,115,72,101,97,100])?{ext:"opus",mime:"audio/ogg; codecs=opus"}:f(l,[128,116,104,101,111,114,97])?{ext:"ogv",mime:"video/ogg"}:f(l,[1,118,105,100,101,111,0])?{ext:"ogm",mime:"video/ogg"}:f(l,[127,70,76,65,67])?{ext:"oga",mime:"audio/ogg"}:f(l,[83,112,101,101,120,32,32])?{ext:"spx",mime:"audio/ogg"}:f(l,[1,118,111,114,98,105,115])?{ext:"ogg",mime:"audio/ogg"}:{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(3===this.buffer[2]||5===this.buffer[2]||7===this.buffer[2])&&(4===this.buffer[3]||6===this.buffer[3]||8===this.buffer[3]))return{ext:"zip",mime:"application/zip"};if(this.checkString("ftyp",{offset:4})&&96&this.buffer[8]){const u=new r.StringType(4,"latin1").get(this.buffer,8).replace("\0"," ").trim();switch(u){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:return u.startsWith("3g")?u.startsWith("3g2")?{ext:"3g2",mime:"video/3gpp2"}:{ext:"3gp",mime:"video/3gpp"}:{ext:"mp4",mime:"video/mp4"}}}if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/x-flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF")){try{await e.ignore(1350);const p=10485760,g=new Uint8Array(Math.min(p,e.fileInfo.size));if(await e.readBuffer(g,{mayBeLess:!0}),(0,m.mK)(g,(new TextEncoder).encode("AIPrivateData")))return{ext:"ai",mime:"application/postscript"}}catch(k){if(!(k instanceof n))throw k}return{ext:"pdf",mime:"application/pdf"}}if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){const T=await this.readTiffHeader(!1);if(T)return T}if(this.check([77,77])){const b=await this.readTiffHeader(!0);if(b)return b}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function w(){const t=await e.peekNumber(r.UINT8);let a=128,i=0;for(;!(t&a)&&0!==a;)++i,a>>=1;const n=new Uint8Array(i+1);return await e.readBuffer(n),n}async function y(){const e=await w(),t=await w();t[0]^=128>>t.length-1;const a=Math.min(6,t.length),i=new DataView(e.buffer),r=new DataView(t.buffer,t.length-a,a);return{id:(0,m.AW)(i),len:(0,m.AW)(r)}}async function I(t){for(;t>0;){const a=await y();if(17026===a.id)return(await e.readToken(new r.StringType(a.len))).replaceAll(/\00.*$/g,"");await e.ignore(a.len),--t}}const v=await y();switch(await I(v.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/x-matroska"};default:return}}if(this.check([82,73,70,70])){if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1"))return{ext:"parquet",mime:"application/x-parquet"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(0===this.buffer[6]||1===this.buffer[6]))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){const S=new r.StringType(4,"latin1").get(this.buffer,2);if(S.match("^d*")&&S>=1e3&&S<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>"))return await e.ignore(8),"debian-binary"===await e.readToken(new r.StringType(13,"ascii"))?{ext:"deb",mime:"application/x-deb"}:{ext:"ar",mime:"application/x-unix-archive"};if(this.checkString("WEBVTT")&&["\n","\r","\t"," ","\0"].some((e=>this.checkString(e,{offset:6}))))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){async function x(){return{length:await e.readToken(r.INT32_BE),type:await e.readToken(new r.StringType(4,"latin1"))}}await e.ignore(8);do{const E=await x();if(E.length<0)return;switch(E.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await e.ignore(E.length+4)}}while(e.position+8<e.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/x-apache-arrow"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function C(){const t=new Uint8Array(16);return await e.readBuffer(t),{id:t,size:Number(await e.readToken(r.UINT64_LE))}}for(await e.ignore(30);e.position+24<e.fileInfo.size;){const A=await C();let _=A.size-24;if(f(A.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){const z=new Uint8Array(16);if(_-=await e.readBuffer(z),f(z,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(f(z,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await e.ignore(_)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await e.ignore(20),await e.readToken(new r.StringType(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255]))return this.check([0,60,0,63,0,120,0,109,0,108],{offset:2})?{ext:"xml",mime:"application/xml"}:void 0;if(this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await e.peekBuffer(this.buffer,{length:Math.min(256,e.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){const F=new DataView(this.buffer.buffer).getUint32(12,!0);if(F>12&&this.buffer.length>=F+16)try{const B=(new TextDecoder).decode(this.buffer.slice(16,F+16));if(JSON.parse(B).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.checkString("Kaydara FBX Binary  \0"))return{ext:"fbx",mime:"application/x.autodesk.fbx"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await e.peekBuffer(this.buffer,{length:Math.min(512,e.fileInfo.size),mayBeLess:!0}),function(e,t=0){const a=Number.parseInt(new r.StringType(6).get(e,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(a))return!1;let i=256;for(let a=t;a<t+148;a++)i+=e[a];for(let a=t+156;a<t+512;a++)i+=e[a];return a===i}(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254]))return this.check([60,0,63,0,120,0,109,0,108,0],{offset:2})?{ext:"xml",mime:"application/xml"}:this.check([255,14,83,0,107,0,101,0,116,0,99,0,104,0,85,0,112,0,32,0,77,0,111,0,100,0,101,0,108,0],{offset:2})?{ext:"skp",mime:"application/vnd.sketchup.skp"}:void 0;if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"};if(this.buffer.length>=2&&this.check([255,224],{offset:0,mask:[255,224]})){if(this.check([16],{offset:1,mask:[22]}))return this.check([8],{offset:1,mask:[8]}),{ext:"aac",mime:"audio/aac"};if(this.check([2],{offset:1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}async readTiffTag(e){const t=await this.tokenizer.readToken(e?r.UINT16_BE:r.UINT16_LE);switch(this.tokenizer.ignore(10),t){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"}}}async readTiffIFD(e){const t=await this.tokenizer.readToken(e?r.UINT16_BE:r.UINT16_LE);for(let a=0;a<t;++a){const t=await this.readTiffTag(e);if(t)return t}}async readTiffHeader(e){const t=(e?r.UINT16_BE:r.UINT16_LE).get(this.buffer,2),a=(e?r.UINT32_BE:r.UINT32_LE).get(this.buffer,4);if(42===t){if(a>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(a>=8&&(this.check([28,0,254,0],{offset:8})||this.check([31,0,11,0],{offset:8})))return{ext:"nef",mime:"image/x-nikon-nef"}}return await this.tokenizer.ignore(a),await this.readTiffIFD(e)??{ext:"tif",mime:"image/tiff"}}if(43===t)return{ext:"tif",mime:"image/tiff"}}}new Set(["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","ai","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk"]),new Set(["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/x-apache-arrow","video/mp4","audio/midi","video/x-matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/x-flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/x-parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive"]);var k=a(597),T=a(864),b=a(833),w=a(207);const y={multiple:!1},I={year:y,track:y,disk:y,title:y,artist:y,artists:{multiple:!0,unique:!0},albumartist:y,album:y,date:y,originaldate:y,originalyear:y,releasedate:y,comment:{multiple:!0,unique:!1},genre:{multiple:!0,unique:!0},picture:{multiple:!0,unique:!0},composer:{multiple:!0,unique:!0},lyrics:{multiple:!0,unique:!1},albumsort:{multiple:!1,unique:!0},titlesort:{multiple:!1,unique:!0},work:{multiple:!1,unique:!0},artistsort:{multiple:!1,unique:!0},albumartistsort:{multiple:!1,unique:!0},composersort:{multiple:!1,unique:!0},lyricist:{multiple:!0,unique:!0},writer:{multiple:!0,unique:!0},conductor:{multiple:!0,unique:!0},remixer:{multiple:!0,unique:!0},arranger:{multiple:!0,unique:!0},engineer:{multiple:!0,unique:!0},producer:{multiple:!0,unique:!0},technician:{multiple:!0,unique:!0},djmixer:{multiple:!0,unique:!0},mixer:{multiple:!0,unique:!0},label:{multiple:!0,unique:!0},grouping:y,subtitle:{multiple:!0},discsubtitle:y,totaltracks:y,totaldiscs:y,compilation:y,rating:{multiple:!0},bpm:y,mood:y,media:y,catalognumber:{multiple:!0,unique:!0},tvShow:y,tvShowSort:y,tvSeason:y,tvEpisode:y,tvEpisodeId:y,tvNetwork:y,podcast:y,podcasturl:y,releasestatus:y,releasetype:{multiple:!0},releasecountry:y,script:y,language:y,copyright:y,license:y,encodedby:y,encodersettings:y,gapless:y,barcode:y,isrc:{multiple:!0},asin:y,musicbrainz_recordingid:y,musicbrainz_trackid:y,musicbrainz_albumid:y,musicbrainz_artistid:{multiple:!0},musicbrainz_albumartistid:{multiple:!0},musicbrainz_releasegroupid:y,musicbrainz_workid:y,musicbrainz_trmid:y,musicbrainz_discid:y,acoustid_id:y,acoustid_fingerprint:y,musicip_puid:y,musicip_fingerprint:y,website:y,"performer:instrument":{multiple:!0,unique:!0},averageLevel:y,peakLevel:y,notes:{multiple:!0,unique:!1},key:y,originalalbum:y,originalartist:y,discogs_artist_id:{multiple:!0,unique:!0},discogs_release_id:y,discogs_label_id:y,discogs_master_release_id:y,discogs_votes:y,discogs_rating:y,replaygain_track_peak:y,replaygain_track_gain:y,replaygain_album_peak:y,replaygain_album_gain:y,replaygain_track_minmax:y,replaygain_album_minmax:y,replaygain_undo:y,description:{multiple:!0},longDescription:y,category:{multiple:!0},hdVideo:y,keywords:{multiple:!0},movement:y,movementIndex:y,movementTotal:y,podcastId:y,showMovement:y,stik:y};class v{static toIntOrNull(e){const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t}static normalizeTrack(e){const t=e.toString().split("/");return{no:Number.parseInt(t[0],10)||null,of:Number.parseInt(t[1],10)||null}}constructor(e,t){this.tagTypes=e,this.tagMap=t}mapGenericTag(e,t){e={id:e.id,value:e.value},this.postMap(e,t);const a=this.getCommonName(e.id);return a?{id:a,value:e.value}:null}getCommonName(e){return this.tagMap[e]}postMap(e,t){}}v.maxRatingScore=1;const S={title:"title",artist:"artist",album:"album",year:"year",comment:"comment",track:"track",genre:"genre"};class x extends v{constructor(){super(["ID3v1"],S)}}class E extends v{constructor(e,t){const a={};for(const e of Object.keys(t))a[e.toUpperCase()]=t[e];super(e,a)}getCommonName(e){return this.tagMap[e.toUpperCase()]}}var C=a(185);const A={TIT2:"title",TPE1:"artist","TXXX:Artists":"artists",TPE2:"albumartist",TALB:"album",TDRV:"date",TORY:"originalyear",TPOS:"disk",TCON:"genre",APIC:"picture",TCOM:"composer",USLT:"lyrics",TSOA:"albumsort",TSOT:"titlesort",TOAL:"originalalbum",TSOP:"artistsort",TSO2:"albumartistsort",TSOC:"composersort",TEXT:"lyricist","TXXX:Writer":"writer",TPE3:"conductor",TPE4:"remixer","IPLS:arranger":"arranger","IPLS:engineer":"engineer","IPLS:producer":"producer","IPLS:DJ-mix":"djmixer","IPLS:mix":"mixer",TPUB:"label",TIT1:"grouping",TIT3:"subtitle",TRCK:"track",TCMP:"compilation",POPM:"rating",TBPM:"bpm",TMED:"media","TXXX:CATALOGNUMBER":"catalognumber","TXXX:MusicBrainz Album Status":"releasestatus","TXXX:MusicBrainz Album Type":"releasetype","TXXX:MusicBrainz Album Release Country":"releasecountry","TXXX:RELEASECOUNTRY":"releasecountry","TXXX:SCRIPT":"script",TLAN:"language",TCOP:"copyright",WCOP:"license",TENC:"encodedby",TSSE:"encodersettings","TXXX:BARCODE":"barcode","TXXX:ISRC":"isrc",TSRC:"isrc","TXXX:ASIN":"asin","TXXX:originalyear":"originalyear","UFID:http://musicbrainz.org":"musicbrainz_recordingid","TXXX:MusicBrainz Release Track Id":"musicbrainz_trackid","TXXX:MusicBrainz Album Id":"musicbrainz_albumid","TXXX:MusicBrainz Artist Id":"musicbrainz_artistid","TXXX:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","TXXX:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","TXXX:MusicBrainz Work Id":"musicbrainz_workid","TXXX:MusicBrainz TRM Id":"musicbrainz_trmid","TXXX:MusicBrainz Disc Id":"musicbrainz_discid","TXXX:ACOUSTID_ID":"acoustid_id","TXXX:Acoustid Id":"acoustid_id","TXXX:Acoustid Fingerprint":"acoustid_fingerprint","TXXX:MusicIP PUID":"musicip_puid","TXXX:MusicMagic Fingerprint":"musicip_fingerprint",WOAR:"website",TDRC:"date",TYER:"year",TDOR:"originaldate","TIPL:arranger":"arranger","TIPL:engineer":"engineer","TIPL:producer":"producer","TIPL:DJ-mix":"djmixer","TIPL:mix":"mixer",TMOO:"mood",SYLT:"lyrics",TSST:"discsubtitle",TKEY:"key",COMM:"comment",TOPE:"originalartist","PRIV:AverageLevel":"averageLevel","PRIV:PeakLevel":"peakLevel","TXXX:DISCOGS_ARTIST_ID":"discogs_artist_id","TXXX:DISCOGS_ARTISTS":"artists","TXXX:DISCOGS_ARTIST_NAME":"artists","TXXX:DISCOGS_ALBUM_ARTISTS":"albumartist","TXXX:DISCOGS_CATALOG":"catalognumber","TXXX:DISCOGS_COUNTRY":"releasecountry","TXXX:DISCOGS_DATE":"originaldate","TXXX:DISCOGS_LABEL":"label","TXXX:DISCOGS_LABEL_ID":"discogs_label_id","TXXX:DISCOGS_MASTER_RELEASE_ID":"discogs_master_release_id","TXXX:DISCOGS_RATING":"discogs_rating","TXXX:DISCOGS_RELEASED":"date","TXXX:DISCOGS_RELEASE_ID":"discogs_release_id","TXXX:DISCOGS_VOTES":"discogs_votes","TXXX:CATALOGID":"catalognumber","TXXX:STYLE":"genre","TXXX:REPLAYGAIN_TRACK_PEAK":"replaygain_track_peak","TXXX:REPLAYGAIN_TRACK_GAIN":"replaygain_track_gain","TXXX:REPLAYGAIN_ALBUM_PEAK":"replaygain_album_peak","TXXX:REPLAYGAIN_ALBUM_GAIN":"replaygain_album_gain","TXXX:MP3GAIN_MINMAX":"replaygain_track_minmax","TXXX:MP3GAIN_ALBUM_MINMAX":"replaygain_album_minmax","TXXX:MP3GAIN_UNDO":"replaygain_undo",MVNM:"movement",MVIN:"movementIndex",PCST:"podcast",TCAT:"category",TDES:"description",TDRL:"releasedate",TGID:"podcastId",TKWD:"keywords",WFED:"podcasturl",GRP1:"grouping"};class _ extends E{static toRating(e){return{source:e.email,rating:e.rating>0?(e.rating-1)/254*v.maxRatingScore:void 0}}constructor(){super(["ID3v2.3","ID3v2.4"],A)}postMap(e,t){switch(e.id){case"UFID":{const t=e.value;"http://musicbrainz.org"===t.owner_identifier&&(e.id+=`:${t.owner_identifier}`,e.value=(0,C.sc)(t.identifier,"latin1"))}break;case"PRIV":{const a=e.value;switch(a.owner_identifier){case"AverageLevel":case"PeakValue":e.id+=`:${a.owner_identifier}`,e.value=4===a.data.length?r.UINT32_LE.get(a.data,0):null,null===e.value&&t.addWarning("Failed to parse PRIV:PeakValue");break;default:t.addWarning(`Unknown PRIV owner-identifier: ${a.data}`)}}break;case"POPM":e.value=_.toRating(e.value)}}}const z={Title:"title",Author:"artist","WM/AlbumArtist":"albumartist","WM/AlbumTitle":"album","WM/Year":"date","WM/OriginalReleaseTime":"originaldate","WM/OriginalReleaseYear":"originalyear",Description:"comment","WM/TrackNumber":"track","WM/PartOfSet":"disk","WM/Genre":"genre","WM/Composer":"composer","WM/Lyrics":"lyrics","WM/AlbumSortOrder":"albumsort","WM/TitleSortOrder":"titlesort","WM/ArtistSortOrder":"artistsort","WM/AlbumArtistSortOrder":"albumartistsort","WM/ComposerSortOrder":"composersort","WM/Writer":"lyricist","WM/Conductor":"conductor","WM/ModifiedBy":"remixer","WM/Engineer":"engineer","WM/Producer":"producer","WM/DJMixer":"djmixer","WM/Mixer":"mixer","WM/Publisher":"label","WM/ContentGroupDescription":"grouping","WM/SubTitle":"subtitle","WM/SetSubTitle":"discsubtitle","WM/IsCompilation":"compilation","WM/SharedUserRating":"rating","WM/BeatsPerMinute":"bpm","WM/Mood":"mood","WM/Media":"media","WM/CatalogNo":"catalognumber","MusicBrainz/Album Status":"releasestatus","MusicBrainz/Album Type":"releasetype","MusicBrainz/Album Release Country":"releasecountry","WM/Script":"script","WM/Language":"language",Copyright:"copyright",LICENSE:"license","WM/EncodedBy":"encodedby","WM/EncodingSettings":"encodersettings","WM/Barcode":"barcode","WM/ISRC":"isrc","MusicBrainz/Track Id":"musicbrainz_recordingid","MusicBrainz/Release Track Id":"musicbrainz_trackid","MusicBrainz/Album Id":"musicbrainz_albumid","MusicBrainz/Artist Id":"musicbrainz_artistid","MusicBrainz/Album Artist Id":"musicbrainz_albumartistid","MusicBrainz/Release Group Id":"musicbrainz_releasegroupid","MusicBrainz/Work Id":"musicbrainz_workid","MusicBrainz/TRM Id":"musicbrainz_trmid","MusicBrainz/Disc Id":"musicbrainz_discid","Acoustid/Id":"acoustid_id","Acoustid/Fingerprint":"acoustid_fingerprint","MusicIP/PUID":"musicip_puid","WM/ARTISTS":"artists","WM/InitialKey":"key",ASIN:"asin","WM/Work":"work","WM/AuthorURL":"website","WM/Picture":"picture"};class F extends v{static toRating(e){return{rating:Number.parseFloat(e+1)/5}}constructor(){super(["asf"],z)}postMap(e){switch(e.id){case"WM/SharedUserRating":{const t=e.id.split(":");e.value=F.toRating(e.value),e.id=t[0];break}}}}const B={TT2:"title",TP1:"artist",TP2:"albumartist",TAL:"album",TYE:"year",COM:"comment",TRK:"track",TPA:"disk",TCO:"genre",PIC:"picture",TCM:"composer",TOR:"originaldate",TOT:"originalalbum",TXT:"lyricist",TP3:"conductor",TPB:"label",TT1:"grouping",TT3:"subtitle",TLA:"language",TCR:"copyright",WCP:"license",TEN:"encodedby",TSS:"encodersettings",WAR:"website",PCS:"podcast",TCP:"compilation",TDR:"date",TS2:"albumartistsort",TSA:"albumsort",TSC:"composersort",TSP:"artistsort",TST:"titlesort",WFD:"podcasturl",TBP:"bpm"};class D extends E{constructor(){super(["ID3v2.2"],B)}}const N={Title:"title",Artist:"artist",Artists:"artists","Album Artist":"albumartist",Album:"album",Year:"date",Originalyear:"originalyear",Originaldate:"originaldate",Releasedate:"releasedate",Comment:"comment",Track:"track",Disc:"disk",DISCNUMBER:"disk",Genre:"genre","Cover Art (Front)":"picture","Cover Art (Back)":"picture",Composer:"composer",Lyrics:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",Lyricist:"lyricist",Writer:"writer",Conductor:"conductor",MixArtist:"remixer",Arranger:"arranger",Engineer:"engineer",Producer:"producer",DJMixer:"djmixer",Mixer:"mixer",Label:"label",Grouping:"grouping",Subtitle:"subtitle",DiscSubtitle:"discsubtitle",Compilation:"compilation",BPM:"bpm",Mood:"mood",Media:"media",CatalogNumber:"catalognumber",MUSICBRAINZ_ALBUMSTATUS:"releasestatus",MUSICBRAINZ_ALBUMTYPE:"releasetype",RELEASECOUNTRY:"releasecountry",Script:"script",Language:"language",Copyright:"copyright",LICENSE:"license",EncodedBy:"encodedby",EncoderSettings:"encodersettings",Barcode:"barcode",ISRC:"isrc",ASIN:"asin",musicbrainz_trackid:"musicbrainz_recordingid",musicbrainz_releasetrackid:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",Acoustid_Id:"acoustid_id",ACOUSTID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",Weblink:"website",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",MP3GAIN_MINMAX:"replaygain_track_minmax",MP3GAIN_UNDO:"replaygain_undo"};class P extends E{constructor(){super(["APEv2"],N)}}const U={"Â©nam":"title","Â©ART":"artist",aART:"albumartist","----:com.apple.iTunes:Band":"albumartist","Â©alb":"album","Â©day":"date","Â©cmt":"comment","Â©com":"comment",trkn:"track",disk:"disk","Â©gen":"genre",covr:"picture","Â©wrt":"composer","Â©lyr":"lyrics",soal:"albumsort",sonm:"titlesort",soar:"artistsort",soaa:"albumartistsort",soco:"composersort","----:com.apple.iTunes:LYRICIST":"lyricist","----:com.apple.iTunes:CONDUCTOR":"conductor","----:com.apple.iTunes:REMIXER":"remixer","----:com.apple.iTunes:ENGINEER":"engineer","----:com.apple.iTunes:PRODUCER":"producer","----:com.apple.iTunes:DJMIXER":"djmixer","----:com.apple.iTunes:MIXER":"mixer","----:com.apple.iTunes:LABEL":"label","Â©grp":"grouping","----:com.apple.iTunes:SUBTITLE":"subtitle","----:com.apple.iTunes:DISCSUBTITLE":"discsubtitle",cpil:"compilation",tmpo:"bpm","----:com.apple.iTunes:MOOD":"mood","----:com.apple.iTunes:MEDIA":"media","----:com.apple.iTunes:CATALOGNUMBER":"catalognumber",tvsh:"tvShow",tvsn:"tvSeason",tves:"tvEpisode",sosn:"tvShowSort",tven:"tvEpisodeId",tvnn:"tvNetwork",pcst:"podcast",purl:"podcasturl","----:com.apple.iTunes:MusicBrainz Album Status":"releasestatus","----:com.apple.iTunes:MusicBrainz Album Type":"releasetype","----:com.apple.iTunes:MusicBrainz Album Release Country":"releasecountry","----:com.apple.iTunes:SCRIPT":"script","----:com.apple.iTunes:LANGUAGE":"language",cprt:"copyright","Â©cpy":"copyright","----:com.apple.iTunes:LICENSE":"license","Â©too":"encodedby",pgap:"gapless","----:com.apple.iTunes:BARCODE":"barcode","----:com.apple.iTunes:ISRC":"isrc","----:com.apple.iTunes:ASIN":"asin","----:com.apple.iTunes:NOTES":"comment","----:com.apple.iTunes:MusicBrainz Track Id":"musicbrainz_recordingid","----:com.apple.iTunes:MusicBrainz Release Track Id":"musicbrainz_trackid","----:com.apple.iTunes:MusicBrainz Album Id":"musicbrainz_albumid","----:com.apple.iTunes:MusicBrainz Artist Id":"musicbrainz_artistid","----:com.apple.iTunes:MusicBrainz Album Artist Id":"musicbrainz_albumartistid","----:com.apple.iTunes:MusicBrainz Release Group Id":"musicbrainz_releasegroupid","----:com.apple.iTunes:MusicBrainz Work Id":"musicbrainz_workid","----:com.apple.iTunes:MusicBrainz TRM Id":"musicbrainz_trmid","----:com.apple.iTunes:MusicBrainz Disc Id":"musicbrainz_discid","----:com.apple.iTunes:Acoustid Id":"acoustid_id","----:com.apple.iTunes:Acoustid Fingerprint":"acoustid_fingerprint","----:com.apple.iTunes:MusicIP PUID":"musicip_puid","----:com.apple.iTunes:fingerprint":"musicip_fingerprint","----:com.apple.iTunes:replaygain_track_gain":"replaygain_track_gain","----:com.apple.iTunes:replaygain_track_peak":"replaygain_track_peak","----:com.apple.iTunes:replaygain_album_gain":"replaygain_album_gain","----:com.apple.iTunes:replaygain_album_peak":"replaygain_album_peak","----:com.apple.iTunes:replaygain_track_minmax":"replaygain_track_minmax","----:com.apple.iTunes:replaygain_album_minmax":"replaygain_album_minmax","----:com.apple.iTunes:replaygain_undo":"replaygain_undo",gnre:"genre","----:com.apple.iTunes:ALBUMARTISTSORT":"albumartistsort","----:com.apple.iTunes:ARTISTS":"artists","----:com.apple.iTunes:ORIGINALDATE":"originaldate","----:com.apple.iTunes:ORIGINALYEAR":"originalyear","----:com.apple.iTunes:RELEASEDATE":"releasedate",desc:"description",ldes:"longDescription","Â©mvn":"movement","Â©mvi":"movementIndex","Â©mvc":"movementTotal","Â©wrk":"work",catg:"category",egid:"podcastId",hdvd:"hdVideo",keyw:"keywords",shwm:"showMovement",stik:"stik",rate:"rating"};class M extends E{constructor(){super(["iTunes"],U)}postMap(e,t){"rate"===e.id&&(e.value={source:void 0,rating:Number.parseFloat(e.value)/100})}}const L={TITLE:"title",ARTIST:"artist",ARTISTS:"artists",ALBUMARTIST:"albumartist","ALBUM ARTIST":"albumartist",ALBUM:"album",DATE:"date",ORIGINALDATE:"originaldate",ORIGINALYEAR:"originalyear",RELEASEDATE:"releasedate",COMMENT:"comment",TRACKNUMBER:"track",DISCNUMBER:"disk",GENRE:"genre",METADATA_BLOCK_PICTURE:"picture",COMPOSER:"composer",LYRICS:"lyrics",ALBUMSORT:"albumsort",TITLESORT:"titlesort",WORK:"work",ARTISTSORT:"artistsort",ALBUMARTISTSORT:"albumartistsort",COMPOSERSORT:"composersort",LYRICIST:"lyricist",WRITER:"writer",CONDUCTOR:"conductor",REMIXER:"remixer",ARRANGER:"arranger",ENGINEER:"engineer",PRODUCER:"producer",DJMIXER:"djmixer",MIXER:"mixer",LABEL:"label",GROUPING:"grouping",SUBTITLE:"subtitle",DISCSUBTITLE:"discsubtitle",TRACKTOTAL:"totaltracks",DISCTOTAL:"totaldiscs",COMPILATION:"compilation",RATING:"rating",BPM:"bpm",KEY:"key",MOOD:"mood",MEDIA:"media",CATALOGNUMBER:"catalognumber",RELEASESTATUS:"releasestatus",RELEASETYPE:"releasetype",RELEASECOUNTRY:"releasecountry",SCRIPT:"script",LANGUAGE:"language",COPYRIGHT:"copyright",LICENSE:"license",ENCODEDBY:"encodedby",ENCODERSETTINGS:"encodersettings",BARCODE:"barcode",ISRC:"isrc",ASIN:"asin",MUSICBRAINZ_TRACKID:"musicbrainz_recordingid",MUSICBRAINZ_RELEASETRACKID:"musicbrainz_trackid",MUSICBRAINZ_ALBUMID:"musicbrainz_albumid",MUSICBRAINZ_ARTISTID:"musicbrainz_artistid",MUSICBRAINZ_ALBUMARTISTID:"musicbrainz_albumartistid",MUSICBRAINZ_RELEASEGROUPID:"musicbrainz_releasegroupid",MUSICBRAINZ_WORKID:"musicbrainz_workid",MUSICBRAINZ_TRMID:"musicbrainz_trmid",MUSICBRAINZ_DISCID:"musicbrainz_discid",ACOUSTID_ID:"acoustid_id",ACOUSTID_ID_FINGERPRINT:"acoustid_fingerprint",MUSICIP_PUID:"musicip_puid",WEBSITE:"website",NOTES:"notes",TOTALTRACKS:"totaltracks",TOTALDISCS:"totaldiscs",DISCOGS_ARTIST_ID:"discogs_artist_id",DISCOGS_ARTISTS:"artists",DISCOGS_ARTIST_NAME:"artists",DISCOGS_ALBUM_ARTISTS:"albumartist",DISCOGS_CATALOG:"catalognumber",DISCOGS_COUNTRY:"releasecountry",DISCOGS_DATE:"originaldate",DISCOGS_LABEL:"label",DISCOGS_LABEL_ID:"discogs_label_id",DISCOGS_MASTER_RELEASE_ID:"discogs_master_release_id",DISCOGS_RATING:"discogs_rating",DISCOGS_RELEASED:"date",DISCOGS_RELEASE_ID:"discogs_release_id",DISCOGS_VOTES:"discogs_votes",CATALOGID:"catalognumber",STYLE:"genre",REPLAYGAIN_TRACK_GAIN:"replaygain_track_gain",REPLAYGAIN_TRACK_PEAK:"replaygain_track_peak",REPLAYGAIN_ALBUM_GAIN:"replaygain_album_gain",REPLAYGAIN_ALBUM_PEAK:"replaygain_album_peak",REPLAYGAIN_MINMAX:"replaygain_track_minmax",REPLAYGAIN_ALBUM_MINMAX:"replaygain_album_minmax",REPLAYGAIN_UNDO:"replaygain_undo"};class R extends v{static toRating(e,t,a){return{source:e?e.toLowerCase():void 0,rating:Number.parseFloat(t)/a*v.maxRatingScore}}constructor(){super(["vorbis"],L)}postMap(e){if("RATING"===e.id)e.value=R.toRating(void 0,e.value,100);else if(0===e.id.indexOf("RATING:")){const t=e.id.split(":");e.value=R.toRating(t[1],e.value,1),e.id=t[0]}}}const O={IART:"artist",ICRD:"date",INAM:"title",TITL:"title",IPRD:"album",ITRK:"track",IPRT:"track",COMM:"comment",ICMT:"comment",ICNT:"releasecountry",GNRE:"genre",IWRI:"writer",RATE:"rating",YEAR:"year",ISFT:"encodedby",CODE:"encodedby",TURL:"website",IGNR:"genre",IENG:"engineer",ITCH:"technician",IMED:"media",IRPD:"album"};class $ extends v{constructor(){super(["exif"],O)}}const j={"segment:title":"title","album:ARTIST":"albumartist","album:ARTISTSORT":"albumartistsort","album:TITLE":"album","album:DATE_RECORDED":"originaldate","album:DATE_RELEASED":"releasedate","album:PART_NUMBER":"disk","album:TOTAL_PARTS":"totaltracks","track:ARTIST":"artist","track:ARTISTSORT":"artistsort","track:TITLE":"title","track:PART_NUMBER":"track","track:MUSICBRAINZ_TRACKID":"musicbrainz_recordingid","track:MUSICBRAINZ_ALBUMID":"musicbrainz_albumid","track:MUSICBRAINZ_ARTISTID":"musicbrainz_artistid","track:PUBLISHER":"label","track:GENRE":"genre","track:ENCODER":"encodedby","track:ENCODER_OPTIONS":"encodersettings","edition:TOTAL_PARTS":"totaldiscs",picture:"picture"};class X extends E{constructor(){super(["matroska"],j)}}const G={NAME:"title",AUTH:"artist","(c) ":"copyright",ANNO:"comment"};class W extends v{constructor(){super(["AIFF"],G)}}var H=a(324);class q{constructor(){this.tagMappers={},[new x,new D,new _,new M,new M,new R,new P,new F,new $,new X,new W].forEach((e=>{this.registerTagMapper(e)}))}mapTag(e,t,a){if(this.tagMappers[e])return this.tagMappers[e].mapGenericTag(t,a);throw new H.nK(`No generic tag mapper defined for tag-format: ${e}`)}registerTagMapper(e){for(const t of e.tagTypes)this.tagMappers[t]=e}}var V=a(675);const Y=b("music-metadata:collector"),K=["matroska","APEv2","vorbis","ID3v2.4","ID3v2.3","ID3v2.2","exif","asf","iTunes","AIFF","ID3v1"];class Z{constructor(e){this.format={tagTypes:[],trackInfo:[]},this.native={},this.common={track:{no:null,of:null},disk:{no:null,of:null},movementIndex:{no:null,of:null}},this.quality={warnings:[]},this.commonOrigin={},this.originPriority={},this.tagMapper=new q,this.opts=e;let t=1;for(const e of K)this.originPriority[e]=t++;this.originPriority.artificial=500,this.originPriority.id3v1=600}hasAny(){return Object.keys(this.native).length>0}addStreamInfo(e){Y(`streamInfo: type=${e.type?w.vQ[e.type]:"?"}, codec=${e.codecName}`),this.format.trackInfo.push(e)}setFormat(e,t){Y(`format: ${e} = ${t}`),this.format[e]=t,this.opts?.observer&&this.opts.observer({metadata:this,tag:{type:"format",id:e,value:t}})}async addTag(e,t,a){Y(`tag ${e}.${t} = ${a}`),this.native[e]||(this.format.tagTypes.push(e),this.native[e]=[]),this.native[e].push({id:t,value:a}),await this.toCommon(e,t,a)}addWarning(e){this.quality.warnings.push({message:e})}async postMap(e,t){switch(t.id){case"artist":if(this.commonOrigin.artist===this.originPriority[e])return this.postMap("artificial",{id:"artists",value:t.value});this.common.artists||this.setGenericTag("artificial",{id:"artists",value:t.value});break;case"artists":if(!(this.common.artist&&this.commonOrigin.artist!==this.originPriority.artificial||this.common.artists&&-1!==this.common.artists.indexOf(t.value))){const e={id:"artist",value:(a=(this.common.artists||[]).concat([t.value])).length>2?`${a.slice(0,a.length-1).join(", ")} & ${a[a.length-1]}`:a.join(" & ")};this.setGenericTag("artificial",e)}break;case"picture":return this.postFixPicture(t.value).then((a=>{null!==a&&(t.value=a,this.setGenericTag(e,t))}));case"totaltracks":return void(this.common.track.of=v.toIntOrNull(t.value));case"totaldiscs":return void(this.common.disk.of=v.toIntOrNull(t.value));case"movementTotal":return void(this.common.movementIndex.of=v.toIntOrNull(t.value));case"track":case"disk":case"movementIndex":{const e=this.common[t.id].of;return this.common[t.id]=v.normalizeTrack(t.value),void(this.common[t.id].of=null!=e?e:this.common[t.id].of)}case"bpm":case"year":case"originalyear":t.value=Number.parseInt(t.value,10);break;case"date":{const e=Number.parseInt(t.value.substr(0,4),10);Number.isNaN(e)||(this.common.year=e);break}case"discogs_label_id":case"discogs_release_id":case"discogs_master_release_id":case"discogs_artist_id":case"discogs_votes":t.value="string"==typeof t.value?Number.parseInt(t.value,10):t.value;break;case"replaygain_track_gain":case"replaygain_track_peak":case"replaygain_album_gain":case"replaygain_album_peak":t.value=(0,C.th)(t.value);break;case"replaygain_track_minmax":t.value=t.value.split(",").map((e=>Number.parseInt(e,10)));break;case"replaygain_undo":{const e=t.value.split(",").map((e=>Number.parseInt(e,10)));t.value={leftChannel:e[0],rightChannel:e[1]};break}case"gapless":case"compilation":case"podcast":case"showMovement":t.value="1"===t.value||1===t.value;break;case"isrc":{const e=this.common[t.id];if(e&&-1!==e.indexOf(t.value))return;break}case"comment":"string"==typeof t.value&&(t.value={text:t.value}),"iTunPGAP"===t.value.descriptor&&this.setGenericTag(e,{id:"gapless",value:"1"===t.value.text});break;case"lyrics":"string"==typeof t.value&&(t.value=function(e){const t=e.split("\n"),a=[],i=/\[(\d{2}):(\d{2})\.(\d{2})\]/;for(const e of t){const t=e.match(i);if(t){const r=1e3*(60*Number.parseInt(t[1],10)+Number.parseInt(t[2],10))+10*Number.parseInt(t[3],10),n=e.replace(i,"").trim();a.push({timestamp:r,text:n})}}return{contentType:V.MW.lyrics,timeStampFormat:V.sd.milliseconds,syncText:a}}(t.value))}var a;null!==t.value&&this.setGenericTag(e,t)}toCommonMetadata(){return{format:this.format,native:this.native,quality:this.quality,common:this.common}}async postFixPicture(e){if(e.data&&e.data.length>0){if(!e.format){const t=await p(Uint8Array.from(e.data));if(!t)return null;e.format=t.mime}return e.format=e.format.toLocaleLowerCase(),"image/jpg"===e.format&&(e.format="image/jpeg"),e}return this.addWarning("Empty picture tag found"),null}async toCommon(e,t,a){const i={id:t,value:a},r=this.tagMapper.mapTag(e,i,this);r&&await this.postMap(e,r)}setGenericTag(e,t){Y(`common.${t.id} = ${t.value}`);const a=this.commonOrigin[t.id]||1e3,i=this.originPriority[e];if(r=t.id,I[r]&&!I[r].multiple){if(!(i<=a))return Y(`Ignore native tag (singleton): ${e}.${t.id} = ${t.value}`);this.common[t.id]=t.value,this.commonOrigin[t.id]=i}else if(i===a)!function(e){return!I[e].multiple||I[e].unique||!1}(t.id)||-1===this.common[t.id].indexOf(t.value)?this.common[t.id].push(t.value):Y(`Ignore duplicate value: ${e}.${t.id} = ${t.value}`);else{if(!(i<a))return Y(`Ignore native tag (list): ${e}.${t.id} = ${t.value}`);this.common[t.id]=[t.value],this.commonOrigin[t.id]=i}var r;this.opts?.observer&&this.opts.observer({metadata:this,tag:{type:"common",id:t.id,value:t.value}})}}const J={parserType:"mpeg",extensions:[".mp2",".mp3",".m2a",".aac","aacp"],mimeTypes:["audio/mpeg","audio/mp3","audio/aacs","audio/aacp"],load:async()=>(await a.e(96).then(a.bind(a,764))).MpegParser},Q={parserType:"apev2",extensions:[".ape"],mimeTypes:["audio/ape","audio/monkeys-audio"],load:async()=>(await Promise.resolve().then(a.bind(a,283))).APEv2Parser},ee={parserType:"asf",extensions:[".asf"],mimeTypes:["audio/ms-wma","video/ms-wmv","audio/ms-asf","video/ms-asf","application/vnd.ms-asf"],load:async()=>(await a.e(96).then(a.bind(a,626))).AsfParser},te={parserType:"dsdiff",extensions:[".dff"],mimeTypes:["audio/dsf","audio/dsd"],load:async()=>(await a.e(96).then(a.bind(a,408))).DsdiffParser},ae={parserType:"aiff",extensions:[".aif","aiff","aifc"],mimeTypes:["audio/aiff","audio/aif","audio/aifc","application/aiff"],load:async()=>(await a.e(96).then(a.bind(a,790))).AIFFParser},ie={parserType:"dsf",extensions:[".dsf"],mimeTypes:["audio/dsf"],load:async()=>(await a.e(96).then(a.bind(a,46))).DsfParser},re={parserType:"flac",extensions:[".flac"],mimeTypes:["audio/flac"],load:async()=>(await a.e(96).then(a.bind(a,465))).FlacParser},ne={parserType:"matroska",extensions:[".mka",".mkv",".mk3d",".mks","webm"],mimeTypes:["audio/matroska","audio/webm","video/webm"],load:async()=>(await a.e(96).then(a.bind(a,930))).MatroskaParser},se={parserType:"mp4",extensions:[".mp4",".m4a",".m4b",".m4pa","m4v","m4r","3gp"],mimeTypes:["audio/mp4","audio/m4a","video/m4v","video/mp4"],load:async()=>(await a.e(96).then(a.bind(a,272))).MP4Parser},oe={parserType:"musepack",extensions:[".mpc"],mimeTypes:["audio/musepack"],load:async()=>(await a.e(96).then(a.bind(a,984))).MusepackParser},ce={parserType:"ogg",extensions:[".ogg",".ogv",".oga",".ogm",".ogx",".opus",".spx"],mimeTypes:["audio/ogg","audio/opus","audio/speex","video/ogg"],load:async()=>(await a.e(96).then(a.bind(a,628))).OggParser},le={parserType:"wavpack",extensions:[".wv",".wvp"],mimeTypes:["audio/wavpack"],load:async()=>(await a.e(96).then(a.bind(a,420))).WavPackParser},ue={parserType:"riff",extensions:[".wav","wave",".bwf"],mimeTypes:["audio/vnd.wave","audio/wav","audio/wave"],load:async()=>(await a.e(96).then(a.bind(a,438))).WaveParser},me=b("music-metadata:parser:factory");class de{constructor(){this.parsers=[],[re,J,Q,se,ne,ue,ce,ee,ae,le,oe,ie,te].forEach((e=>this.registerParser(e)))}registerParser(e){this.parsers.push(e)}async parse(e,t,a){if(e.supportsRandomAccess()?(me("tokenizer supports random-access, scanning for appending headers"),await ke(e,a)):me("tokenizer does not support random-access, cannot scan for appending headers"),!t){const a=new Uint8Array(4100);if(e.fileInfo.mimeType&&(t=this.findLoaderForContentType(e.fileInfo.mimeType)),!t&&e.fileInfo.path&&(t=this.findLoaderForExtension(e.fileInfo.path)),!t){me("Guess parser on content..."),await e.peekBuffer(a,{mayBeLess:!0});const i=await p(a);if(!i||!i.mime)throw new H.e6("Failed to determine audio format");if(me(`Guessed file type is mime=${i.mime}, extension=${i.ext}`),!(t=this.findLoaderForContentType(i.mime)))throw new H.qq(`Guessed MIME-type not supported: ${i.mime}`)}}me(`Loading ${t.parserType} parser...`);const i=new Z(a),r=new(await t.load())(i,e,a??{});return me(`Parser ${t.parserType} loaded`),await r.parse(),i.toCommonMetadata()}findLoaderForExtension(e){if(!e)return;const t=function(e){const t=e.lastIndexOf(".");return-1===t?"":e.slice(t)}(e).toLocaleLowerCase()||e;return this.parsers.find((e=>-1!==e.extensions.indexOf(t)))}findLoaderForContentType(e){let t;if(!e)return;try{t=function(e){const t=k.parse(e),a=(0,T.qg)(t.type);return{type:a.type,subtype:a.subtype,suffix:a.suffix,parameters:t.parameters}}(e)}catch(t){return void me(`Invalid HTTP Content-Type header value: ${e}`)}const a=0===t.subtype.indexOf("x-")?t.subtype.substring(2):t.subtype;return this.parsers.find((e=>e.mimeTypes.find((e=>-1!==e.indexOf(`${t.type}/${a}`)))))}getSupportedMimeTypes(){const e=new Set;return this.parsers.forEach((t=>{t.mimeTypes.forEach((t=>{e.add(t),e.add(t.replace("/","/x-"))}))})),Array.from(e)}}var he=a(283),pe=a(191);const fe="LYRICS200";async function ge(e,t={}){const a={mimeType:e.type,size:e.size};return e instanceof File&&(a.path=e.name),async function(e,t,a={}){const r=(0,i.Xx)(e,{fileInfo:"string"==typeof t?{mimeType:t}:t});try{return await function(e,t){return(new de).parse(e,void 0,t)}(r,a)}finally{await r.close()}}(e.stream(),a,t)}async function ke(e,t={}){let a=e.fileInfo.size;if(await(0,pe.zc)(e)){a-=128;const t=await async function(e){const t=e.fileInfo.size;if(t>=143){const a=new Uint8Array(15),i=e.position;await e.readBuffer(a,{position:t-143}),e.setPosition(i);const r=new TextDecoder("latin1").decode(a);if(r.slice(6)===fe)return Number.parseInt(r.slice(0,6),10)+15}return 0}(e);a-=t}t.apeHeader=await he.APEv2Parser.findApeFooterOffset(e,a)}},736:(e,t,a)=>{e.exports=function(e){function t(e){let a,r,n,s=null;function o(...e){if(!o.enabled)return;const i=o,r=Number(new Date),n=r-(a||r);i.diff=n,i.prev=a,i.curr=r,a=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((a,r)=>{if("%%"===a)return"%";s++;const n=t.formatters[r];if("function"==typeof n){const t=e[s];a=n.call(i,t),e.splice(s,1),s--}return a})),t.formatArgs.call(i,e),(i.log||t.log).apply(i,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(r!==t.namespaces&&(r=t.namespaces,n=t.enabled(e)),n),set:e=>{s=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,a){const i=t(this.namespace+(void 0===a?":":a)+e);return i.log=this.log,i}function r(e,t){let a=0,i=0,r=-1,n=0;for(;a<e.length;)if(i<t.length&&(t[i]===e[a]||"*"===t[i]))"*"===t[i]?(r=i,n=a,i++):(a++,i++);else{if(-1===r)return!1;i=r+1,n++,a=n}for(;i<t.length&&"*"===t[i];)i++;return i===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const a=("string"==typeof e?e:"").trim().replace(" ",",").split(",").filter(Boolean);for(const e of a)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const a of t.skips)if(r(e,a))return!1;for(const a of t.names)if(r(e,a))return!0;return!1},t.humanize=a(585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((a=>{t[a]=e[a]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let a=0;for(let t=0;t<e.length;t++)a=(a<<5)-a+e.charCodeAt(t),a|=0;return t.colors[Math.abs(a)%t.colors.length]},t.enable(t.load()),t}},764:(e,t,a)=>{"use strict";a.r(t),a.d(t,{MpegContentError:()=>f,MpegParser:()=>b});var i=a(17),r=a(853),n=a(833),s=a(185),o=a(481);const c=(e,t)=>{const a=s.f5(e,t,0,3),i=s.f5(e,t,6,1),r=s.f5(e,t,7,9)/10;if(a>0)return{type:s.f5(e,t,0,3),origin:s.f5(e,t,3,3),adjustment:i?-r:r}},l={len:27,get:(e,t)=>{const a=i.UINT32_BE.get(e,t+2);return{revision:s.f5(e,t,0,4),vbr_method:s.f5(e,t,4,4),lowpass_filter:100*i.UINT8.get(e,t+1),track_peak:0===a?null:a/2**23,track_gain:c(e,6),album_gain:c(e,8),music_length:i.UINT32_BE.get(e,t+20),music_crc:i.UINT8.get(e,t+24),header_crc:i.UINT16_BE.get(e,t+24)}}},u=new i.StringType(4,"ascii"),m=new i.StringType(6,"ascii"),d={len:4,get:(e,t)=>({frames:s.cD(e,t,31),bytes:s.cD(e,t,30),toc:s.cD(e,t,29),vbrScale:s.cD(e,t,28)})};var h=a(324);const p=n("music-metadata:parser:mpeg");class f extends((0,h.fO)("MPEG")){}const g={AudioObjectTypes:["AAC Main","AAC LC","AAC SSR","AAC LTP"],SamplingFrequencies:[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,null,null,-1]},k=[void 0,["front-center"],["front-left","front-right"],["front-center","front-left","front-right"],["front-center","front-left","front-right","back-center"],["front-center","front-left","front-right","back-left","back-right"],["front-center","front-left","front-right","back-left","back-right","LFE-channel"],["front-center","front-left","front-right","side-left","side-right","back-left","back-right","LFE-channel"]];class T{constructor(e,t){this.bitrateIndex=null,this.sampRateFreqIndex=null,this.padding=null,this.privateBit=null,this.channelModeIndex=null,this.modeExtension=null,this.isOriginalMedia=null,this.version=null,this.bitrate=null,this.samplingRate=null,this.frameLength=0,this.versionIndex=s.f5(e,t+1,3,2),this.layer=T.LayerDescription[s.f5(e,t+1,5,2)],this.versionIndex>1&&0===this.layer?this.parseAdtsHeader(e,t):this.parseMpegHeader(e,t),this.isProtectedByCRC=!s.cD(e,t+1,7)}calcDuration(e){return null==this.samplingRate?null:e*this.calcSamplesPerFrame()/this.samplingRate}calcSamplesPerFrame(){return T.samplesInFrameTable[1===this.version?0:1][this.layer]}calculateSideInfoLength(){if(3!==this.layer)return 2;if(3===this.channelModeIndex){if(1===this.version)return 17;if(2===this.version||2.5===this.version)return 9}else{if(1===this.version)return 32;if(2===this.version||2.5===this.version)return 17}return null}calcSlotSize(){return[null,4,1,1][this.layer]}parseMpegHeader(e,t){this.container="MPEG",this.bitrateIndex=s.f5(e,t+2,0,4),this.sampRateFreqIndex=s.f5(e,t+2,4,2),this.padding=s.cD(e,t+2,6),this.privateBit=s.cD(e,t+2,7),this.channelModeIndex=s.f5(e,t+3,0,2),this.modeExtension=s.f5(e,t+3,2,2),this.isCopyrighted=s.cD(e,t+3,4),this.isOriginalMedia=s.cD(e,t+3,5),this.emphasis=s.f5(e,t+3,7,2),this.version=T.VersionID[this.versionIndex],this.channelMode=T.ChannelMode[this.channelModeIndex],this.codec=`MPEG ${this.version} Layer ${this.layer}`;const a=this.calcBitrate();if(!a)throw new f("Cannot determine bit-rate");if(this.bitrate=1e3*a,this.samplingRate=this.calcSamplingRate(),null==this.samplingRate)throw new f("Cannot determine sampling-rate")}parseAdtsHeader(e,t){p("layer=0 => ADTS"),this.version=2===this.versionIndex?4:2,this.container=`ADTS/MPEG-${this.version}`;const a=s.f5(e,t+2,0,2);this.codec="AAC",this.codecProfile=g.AudioObjectTypes[a],p(`MPEG-4 audio-codec=${this.codec}`);const i=s.f5(e,t+2,2,4);this.samplingRate=g.SamplingFrequencies[i],p(`sampling-rate=${this.samplingRate}`);const r=s.f5(e,t+2,7,3);this.mp4ChannelConfig=k[r],p(`channel-config=${this.mp4ChannelConfig?this.mp4ChannelConfig.join("+"):"?"}`),this.frameLength=s.f5(e,t+3,6,2)<<11}calcBitrate(){if(0===this.bitrateIndex||15===this.bitrateIndex)return null;if(this.version&&this.bitrateIndex){const e=10*Math.floor(this.version)+this.layer;return T.bitrate_index[this.bitrateIndex][e]}return null}calcSamplingRate(){return 3===this.sampRateFreqIndex||null===this.version||null==this.sampRateFreqIndex?null:T.sampling_rate_freq_index[this.version][this.sampRateFreqIndex]}}T.SyncByte1=255,T.SyncByte2=224,T.VersionID=[2.5,null,2,1],T.LayerDescription=[0,3,2,1],T.ChannelMode=["stereo","joint_stereo","dual_channel","mono"],T.bitrate_index={1:{11:32,12:32,13:32,21:32,22:8,23:8},2:{11:64,12:48,13:40,21:48,22:16,23:16},3:{11:96,12:56,13:48,21:56,22:24,23:24},4:{11:128,12:64,13:56,21:64,22:32,23:32},5:{11:160,12:80,13:64,21:80,22:40,23:40},6:{11:192,12:96,13:80,21:96,22:48,23:48},7:{11:224,12:112,13:96,21:112,22:56,23:56},8:{11:256,12:128,13:112,21:128,22:64,23:64},9:{11:288,12:160,13:128,21:144,22:80,23:80},10:{11:320,12:192,13:160,21:160,22:96,23:96},11:{11:352,12:224,13:192,21:176,22:112,23:112},12:{11:384,12:256,13:224,21:192,22:128,23:128},13:{11:416,12:320,13:256,21:224,22:144,23:144},14:{11:448,12:384,13:320,21:256,22:160,23:160}},T.sampling_rate_freq_index={1:{0:44100,1:48e3,2:32e3},2:{0:22050,1:24e3,2:16e3},2.5:{0:11025,1:12e3,2:8e3}},T.samplesInFrameTable=[[0,384,1152,1152],[0,384,1152,576]];class b extends o.k{constructor(){super(...arguments),this.frameCount=0,this.syncFrameCount=-1,this.countSkipFrameData=0,this.totalDataLength=0,this.bitrates=[],this.offset=0,this.frame_size=0,this.crc=null,this.calculateEofDuration=!1,this.samplesPerFrame=null,this.buf_frame_header=new Uint8Array(4),this.mpegOffset=null,this.syncPeek={buf:new Uint8Array(1024),len:0}}async postId3v2Parse(){this.metadata.setFormat("lossless",!1);try{let e=!1;for(;!e;)await this.sync(),e=await this.parseCommonMpegHeader()}catch(e){if(!(e instanceof r.d1))throw e;if(p("End-of-stream"),this.calculateEofDuration&&null!==this.samplesPerFrame){const e=this.frameCount*this.samplesPerFrame;if(this.metadata.setFormat("numberOfSamples",e),this.metadata.format.sampleRate){const t=e/this.metadata.format.sampleRate;p(`Calculate duration at EOF: ${t} sec.`,t),this.metadata.setFormat("duration",t)}}}}finalize(){const e=this.metadata.format,t=!!this.metadata.native.ID3v1;if(null!==this.mpegOffset){if(e.duration&&this.tokenizer.fileInfo.size){const a=this.tokenizer.fileInfo.size-this.mpegOffset-(t?128:0);e.codecProfile&&"V"===e.codecProfile[0]&&this.metadata.setFormat("bitrate",8*a/e.duration)}if(this.tokenizer.fileInfo.size&&"CBR"===e.codecProfile){const a=this.tokenizer.fileInfo.size-this.mpegOffset-(t?128:0);if(null!==this.frame_size&&null!==this.samplesPerFrame){const t=Math.round(a/this.frame_size)*this.samplesPerFrame;if(this.metadata.setFormat("numberOfSamples",t),e.sampleRate&&!e.duration){const a=t/e.sampleRate;p("Calculate CBR duration based on file size: %s",a),this.metadata.setFormat("duration",a)}}}}}async sync(){let e=!1;for(;;){let t=0;if(this.syncPeek.len=await this.tokenizer.peekBuffer(this.syncPeek.buf,{length:1024,mayBeLess:!0}),this.syncPeek.len<=163)throw new r.d1;for(;;){if(e&&!(224&~this.syncPeek.buf[t]))return this.buf_frame_header[0]=T.SyncByte1,this.buf_frame_header[1]=this.syncPeek.buf[t],await this.tokenizer.ignore(t),p(`Sync at offset=${this.tokenizer.position-1}, frameCount=${this.frameCount}`),this.syncFrameCount===this.frameCount&&(p(`Re-synced MPEG stream, frameCount=${this.frameCount}`),this.frameCount=0,this.frame_size=0),void(this.syncFrameCount=this.frameCount);if(e=!1,t=this.syncPeek.buf.indexOf(T.SyncByte1,t),-1===t){if(this.syncPeek.len<this.syncPeek.buf.length)throw new r.d1;await this.tokenizer.ignore(this.syncPeek.len);break}++t,e=!0}}}async parseCommonMpegHeader(){let e;0===this.frameCount&&(this.mpegOffset=this.tokenizer.position-1),await this.tokenizer.peekBuffer(this.buf_frame_header.subarray(1),{length:3});try{t=this.buf_frame_header,e=new T(t,0)}catch(e){if(await this.tokenizer.ignore(1),e instanceof Error)return this.metadata.addWarning(`Parse error: ${e.message}`),!1;throw e}var t;return await this.tokenizer.ignore(3),this.metadata.setFormat("container",e.container),this.metadata.setFormat("codec",e.codec),this.metadata.setFormat("lossless",!1),this.metadata.setFormat("sampleRate",e.samplingRate),this.frameCount++,null!==e.version&&e.version>=2&&0===e.layer?this.parseAdts(e):this.parseAudioFrameHeader(e)}async parseAudioFrameHeader(e){this.metadata.setFormat("numberOfChannels","mono"===e.channelMode?1:2),this.metadata.setFormat("bitrate",e.bitrate),this.frameCount<2e5&&p("offset=%s MP%s bitrate=%s sample-rate=%s",this.tokenizer.position-4,e.layer,e.bitrate,e.samplingRate);const t=e.calcSlotSize();if(null===t)throw new f("invalid slot_size");const a=e.calcSamplesPerFrame();p(`samples_per_frame=${a}`);const i=a/8;if(null!==e.bitrate&&null!=e.samplingRate){const a=i*e.bitrate/e.samplingRate+(e.padding?t:0);this.frame_size=Math.floor(a)}if(this.audioFrameHeader=e,null!==e.bitrate&&this.bitrates.push(e.bitrate),1===this.frameCount)return this.offset=4,await this.skipSideInformation(),!1;if(3===this.frameCount){if(this.areAllSame(this.bitrates)){if(this.samplesPerFrame=a,this.metadata.setFormat("codecProfile","CBR"),this.tokenizer.fileInfo.size)return!0}else if(this.metadata.format.duration)return!0;if(!this.options.duration)return!0}return this.options.duration&&4===this.frameCount&&(this.samplesPerFrame=a,this.calculateEofDuration=!0),this.offset=4,e.isProtectedByCRC?(await this.parseCrc(),!1):(await this.skipSideInformation(),!1)}async parseAdts(e){const t=new Uint8Array(3);if(await this.tokenizer.readBuffer(t),e.frameLength+=s.f5(t,0,0,11),this.totalDataLength+=e.frameLength,this.samplesPerFrame=1024,null!==e.samplingRate){const t=e.samplingRate/this.samplesPerFrame,a=8*(0===this.frameCount?0:this.totalDataLength/this.frameCount)*t+.5;this.metadata.setFormat("bitrate",a),p(`frame-count=${this.frameCount}, size=${e.frameLength} bytes, bit-rate=${a}`)}if(await this.tokenizer.ignore(e.frameLength>7?e.frameLength-7:1),3===this.frameCount){if(this.metadata.setFormat("codecProfile",e.codecProfile),e.mp4ChannelConfig&&this.metadata.setFormat("numberOfChannels",e.mp4ChannelConfig.length),!this.options.duration)return!0;this.calculateEofDuration=!0}return!1}async parseCrc(){return this.crc=await this.tokenizer.readNumber(i.INT16_BE),this.offset+=2,this.skipSideInformation()}async skipSideInformation(){if(this.audioFrameHeader){const e=this.audioFrameHeader.calculateSideInfoLength();if(null!==e)return await this.tokenizer.readToken(new i.Uint8ArrayType(e)),this.offset+=e,void await this.readXtraInfoHeader()}}async readXtraInfoHeader(){const e=await this.tokenizer.readToken(u);switch(this.offset+=u.len,e){case"Info":return this.metadata.setFormat("codecProfile","CBR"),this.readXingInfoHeader();case"Xing":{const e=await this.readXingInfoHeader();if(null!==e.vbrScale){const a=(t=e.vbrScale,`V${Math.floor((100-t)/10)}`);this.metadata.setFormat("codecProfile",a)}return null}case"Xtra":break;case"LAME":{const e=await this.tokenizer.readToken(m);if(null!==this.frame_size&&this.frame_size>=this.offset+m.len)return this.offset+=m.len,this.metadata.setFormat("tool",`LAME ${e}`),await this.skipFrameData(this.frame_size-this.offset),null;this.metadata.addWarning("Corrupt LAME header");break}}var t;const a=this.frame_size-this.offset;return a<0?this.metadata.addWarning(`Frame ${this.frameCount}corrupt: negative frameDataLeft`):await this.skipFrameData(a),null}async readXingInfoHeader(){const e=this.tokenizer.position,t=await async function(e){const t=await e.readToken(d),a={numFrames:null,streamSize:null,vbrScale:null};if(t.frames&&(a.numFrames=await e.readToken(i.UINT32_BE)),t.bytes&&(a.streamSize=await e.readToken(i.UINT32_BE)),t.toc&&(a.toc=new Uint8Array(100),await e.readBuffer(a.toc)),t.vbrScale&&(a.vbrScale=await e.readToken(i.UINT32_BE)),"LAME"===await e.peekToken(new i.StringType(4,"ascii"))){await e.ignore(4),a.lame={version:await e.readToken(new i.StringType(5,"ascii"))};const t=a.lame.version.match(/\d+.\d+/g);if(null!==t){const i=t[0].split(".").map((e=>Number.parseInt(e,10)));i[0]>=3&&i[1]>=90&&(a.lame.extended=await e.readToken(l))}}return a}(this.tokenizer);if(this.offset+=this.tokenizer.position-e,t.lame&&(this.metadata.setFormat("tool",`LAME ${s.F6(t.lame.version)}`),t.lame.extended&&(this.metadata.setFormat("trackPeakLevel",t.lame.extended.track_peak),t.lame.extended.track_gain&&this.metadata.setFormat("trackGain",t.lame.extended.track_gain.adjustment),t.lame.extended.album_gain&&this.metadata.setFormat("albumGain",t.lame.extended.album_gain.adjustment),this.metadata.setFormat("duration",t.lame.extended.music_length/1e3))),t.streamSize&&this.audioFrameHeader&&null!==t.numFrames){const e=this.audioFrameHeader.calcDuration(t.numFrames);return this.metadata.setFormat("duration",e),p("Get duration from Xing header: %s",this.metadata.format.duration),t}const a=this.frame_size-this.offset;return await this.skipFrameData(a),t}async skipFrameData(e){if(e<0)throw new f("frame-data-left cannot be negative");await this.tokenizer.ignore(e),this.countSkipFrameData+=e}areAllSame(e){const t=e[0];return e.every((e=>e===t))}}},790:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AIFFParser:()=>f});var i=a(17),r=a(833),n=a(853),s=a(621),o=a(31),c=a(604),l=a(324);const u={NONE:"not compressed\tPCM\tApple Computer",sowt:"PCM (byte swapped)",fl32:"32-bit floating point IEEE 32-bit float",fl64:"64-bit floating point IEEE 64-bit float\tApple Computer",alaw:"ALaw 2:1\t8-bit ITU-T G.711 A-law",ulaw:"ÂµLaw 2:1\t8-bit ITU-T G.711 Âµ-law\tApple Computer",ULAW:"CCITT G.711 u-law 8-bit ITU-T G.711 Âµ-law",ALAW:"CCITT G.711 A-law 8-bit ITU-T G.711 A-law",FL32:"Float 32\tIEEE 32-bit float "};class m extends((0,l.fO)("AIFF")){}class d{constructor(e,t){this.isAifc=t;const a=t?22:18;if(e.chunkSize<a)throw new m(`COMMON CHUNK size should always be at least ${a}`);this.len=e.chunkSize}get(e,t){const a=i.UINT16_BE.get(e,t+8)-16398,r=i.UINT16_BE.get(e,t+8+2),n={numChannels:i.UINT16_BE.get(e,t),numSampleFrames:i.UINT32_BE.get(e,t+2),sampleSize:i.UINT16_BE.get(e,t+6),sampleRate:a<0?r>>Math.abs(a):r<<a};if(this.isAifc){if(n.compressionType=o.e.get(e,t+18),this.len>22){const a=i.UINT8.get(e,t+22);if(a>0){if(23+a+(a+1)%2!==this.len)throw new m("Illegal pstring length");n.compressionName=new i.StringType(a,"latin1").get(e,t+23)}else n.compressionName=void 0}}else n.compressionName="PCM";return n}}const h={len:8,get:(e,t)=>({chunkID:o.e.get(e,t),chunkSize:Number(BigInt(i.UINT32_BE.get(e,t+4)))})},p=r("music-metadata:parser:aiff");class f extends c.s{constructor(){super(...arguments),this.isCompressed=null}async parse(){if("FORM"!==(await this.tokenizer.readToken(h)).chunkID)throw new m("Invalid Chunk-ID, expected 'FORM'");const e=await this.tokenizer.readToken(o.e);switch(e){case"AIFF":this.metadata.setFormat("container",e),this.isCompressed=!1;break;case"AIFC":this.metadata.setFormat("container","AIFF-C"),this.isCompressed=!0;break;default:throw new m(`Unsupported AIFF type: ${e}`)}this.metadata.setFormat("lossless",!this.isCompressed);try{for(;!this.tokenizer.fileInfo.size||this.tokenizer.fileInfo.size-this.tokenizer.position>=h.len;){p(`Reading AIFF chunk at offset=${this.tokenizer.position}`);const e=await this.tokenizer.readToken(h),t=2*Math.round(e.chunkSize/2),a=await this.readData(e);await this.tokenizer.ignore(t-a)}}catch(e){if(!(e instanceof n.d1))throw e;p("End-of-stream")}}async readData(e){switch(e.chunkID){case"COMM":{if(null===this.isCompressed)throw new m("Failed to parse AIFF.COMM chunk when compression type is unknown");const t=await this.tokenizer.readToken(new d(e,this.isCompressed));return this.metadata.setFormat("bitsPerSample",t.sampleSize),this.metadata.setFormat("sampleRate",t.sampleRate),this.metadata.setFormat("numberOfChannels",t.numChannels),this.metadata.setFormat("numberOfSamples",t.numSampleFrames),this.metadata.setFormat("duration",t.numSampleFrames/t.sampleRate),(t.compressionName||t.compressionType)&&this.metadata.setFormat("codec",t.compressionName??u[t.compressionType]),e.chunkSize}case"ID3 ":{const t=await this.tokenizer.readToken(new i.Uint8ArrayType(e.chunkSize)),a=n.vY(t);return await(new s.S).parse(this.metadata,a,this.options),e.chunkSize}case"SSND":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*e.chunkSize/this.metadata.format.duration),0;case"NAME":case"AUTH":case"(c) ":case"ANNO":return this.readTextChunk(e);default:return p(`Ignore chunk id=${e.chunkID}, size=${e.chunkSize}`),0}}async readTextChunk(e){const t=(await this.tokenizer.readToken(new i.StringType(e.chunkSize,"ascii"))).split("\0").map((e=>e.trim())).filter((e=>e?.length));return await Promise.all(t.map((t=>this.metadata.addTag("AIFF",e.chunkID,t)))),e.chunkSize}}},833:(e,t,a)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const a="color: "+this.color;t.splice(1,0,a,"color: inherit");let i=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(i++,"%c"===e&&(r=i))})),t.splice(r,0,a)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=a(736)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},853:(e,t,a)=>{"use strict";a.d(t,{d1:()=>i,vY:()=>h,Xx:()=>d});class i extends Error{constructor(){super("End-Of-Stream"),this.name="EndOfStreamError"}}class r extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}class n{constructor(){this.endOfStream=!1,this.interrupted=!1,this.peekQueue=[]}async peek(e,t=!1){const a=await this.read(e,t);return this.peekQueue.push(e.subarray(0,a)),a}async read(e,t=!1){if(0===e.length)return 0;let a=this.readFromPeekBuffer(e);if(this.endOfStream||(a+=await this.readRemainderFromStream(e.subarray(a),t)),0===a)throw new i;return a}readFromPeekBuffer(e){let t=e.length,a=0;for(;this.peekQueue.length>0&&t>0;){const i=this.peekQueue.pop();if(!i)throw new Error("peekData should be defined");const r=Math.min(i.length,t);e.set(i.subarray(0,r),a),a+=r,t-=r,r<i.length&&this.peekQueue.push(i.subarray(r))}return a}async readRemainderFromStream(e,t){let a=0;for(;a<e.length&&!this.endOfStream;){if(this.interrupted)throw new r;const i=await this.readFromStream(e.subarray(a),t);if(0===i)break;a+=i}if(!t&&a<e.length)throw new i;return a}}class s extends n{constructor(e){super(),this.reader=e}async abort(){return this.close()}async close(){this.reader.releaseLock()}}class o extends s{async readFromStream(e,t){if(0===e.length)return 0;const a=await this.reader.read(new Uint8Array(e.length),{min:t?void 0:e.length});return a.done&&(this.endOfStream=a.done),a.value?(e.set(a.value),a.value.length):0}}class c extends n{constructor(e){super(),this.reader=e,this.buffer=null}writeChunk(e,t){const a=Math.min(t.length,e.length);return e.set(t.subarray(0,a)),a<t.length?this.buffer=t.subarray(a):this.buffer=null,a}async readFromStream(e,t){if(0===e.length)return 0;let a=0;for(this.buffer&&(a+=this.writeChunk(e,this.buffer));a<e.length&&!this.endOfStream;){const t=await this.reader.read();if(t.done){this.endOfStream=!0;break}t.value&&(a+=this.writeChunk(e.subarray(a),t.value))}if(0===a&&this.endOfStream)throw new i;return a}abort(){return this.interrupted=!0,this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}class l{constructor(e){this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=e?.onClose,e?.abortSignal&&e.abortSignal.addEventListener("abort",(()=>{this.abort()}))}async readToken(e,t=this.position){const a=new Uint8Array(e.len);if(await this.readBuffer(a,{position:t})<e.len)throw new i;return e.get(a,0)}async peekToken(e,t=this.position){const a=new Uint8Array(e.len);if(await this.peekBuffer(a,{position:t})<e.len)throw new i;return e.get(a,0)}async readNumber(e){if(await this.readBuffer(this.numBuffer,{length:e.len})<e.len)throw new i;return e.get(this.numBuffer,0)}async peekNumber(e){if(await this.peekBuffer(this.numBuffer,{length:e.len})<e.len)throw new i;return e.get(this.numBuffer,0)}async ignore(e){if(void 0!==this.fileInfo.size){const t=this.fileInfo.size-this.position;if(e>t)return this.position+=t,t}return this.position+=e,e}async close(){await this.abort(),await(this.onClose?.())}normalizeOptions(e,t){if(!this.supportsRandomAccess()&&t&&void 0!==t.position&&t.position<this.position)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");return{mayBeLess:!1,offset:0,length:e.length,position:this.position,...t}}abort(){return Promise.resolve()}}class u extends l{constructor(e,t){super(t),this.streamReader=e,this.fileInfo=t?.fileInfo??{}}async readBuffer(e,t){const a=this.normalizeOptions(e,t),r=a.position-this.position;if(r>0)return await this.ignore(r),this.readBuffer(e,t);if(r<0)throw new Error("`options.position` must be equal or greater than `tokenizer.position`");if(0===a.length)return 0;const n=await this.streamReader.read(e.subarray(0,a.length),a.mayBeLess);if(this.position+=n,(!t||!t.mayBeLess)&&n<a.length)throw new i;return n}async peekBuffer(e,t){const a=this.normalizeOptions(e,t);let r=0;if(a.position){const t=a.position-this.position;if(t>0){const i=new Uint8Array(a.length+t);return r=await this.peekBuffer(i,{mayBeLess:a.mayBeLess}),e.set(i.subarray(t)),r-t}if(t<0)throw new Error("Cannot peek from a negative offset in a stream")}if(a.length>0){try{r=await this.streamReader.peek(e.subarray(0,a.length),a.mayBeLess)}catch(e){if(t?.mayBeLess&&e instanceof i)return 0;throw e}if(!a.mayBeLess&&r<a.length)throw new i}return r}async ignore(e){const t=Math.min(256e3,e),a=new Uint8Array(t);let i=0;for(;i<e;){const r=e-i,n=await this.readBuffer(a,{length:Math.min(t,r)});if(n<0)return n;i+=n}return i}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return!1}}class m extends l{constructor(e,t){super(t),this.uint8Array=e,this.fileInfo={...t?.fileInfo??{},size:e.length}}async readBuffer(e,t){t?.position&&(this.position=t.position);const a=await this.peekBuffer(e,t);return this.position+=a,a}async peekBuffer(e,t){const a=this.normalizeOptions(e,t),r=Math.min(this.uint8Array.length-a.position,a.length);if(!a.mayBeLess&&r<a.length)throw new i;return e.set(this.uint8Array.subarray(a.position,a.position+r)),r}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(e){this.position=e}}function d(e,t){const a=function(e){try{const t=e.getReader({mode:"byob"});return t instanceof ReadableStreamDefaultReader?new c(t):new o(t)}catch(t){if(t instanceof TypeError)return new c(e.getReader());throw t}}(e),i=t??{},r=i.onClose;return i.onClose=async()=>{if(await a.close(),r)return r()},new u(a,i)}function h(e,t){return new m(e,t)}},864:(e,t)=>{"use strict";var a=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;function i(e,t,a){this.type=e,this.subtype=t,this.suffix=a}t.qg=function(e){if(!e)throw new TypeError("argument string is required");if("string"!=typeof e)throw new TypeError("argument string is required to be a string");var t=a.exec(e.toLowerCase());if(!t)throw new TypeError("invalid media type");var r,n=t[1],s=t[2],o=s.lastIndexOf("+");return-1!==o&&(r=s.substr(o+1),s=s.substr(0,o)),new i(n,s,r)}},902:(e,t,a)=>{"use strict";a.d(t,{Y:()=>r});var i=a(17);class r{constructor(e,t){this.data=e,this.offset=t}readInt32(){const e=i.UINT32_LE.get(this.data,this.offset);return this.offset+=4,e}readStringUtf8(){const e=this.readInt32(),t=new TextDecoder("utf-8").decode(this.data.subarray(this.offset,this.offset+e));return this.offset+=e,t}parseUserComment(){const e=this.offset,t=this.readStringUtf8(),a=t.indexOf("=");return{key:t.slice(0,a).toUpperCase(),value:t.slice(a+1),len:this.offset-e}}}},930:(e,t,a)=>{"use strict";a.r(t),a.d(t,{MatroskaParser:()=>k});var i=a(833),r=a(604);const n={name:"dtd",container:{440786851:{name:"ebml",container:{17030:{name:"ebmlVersion",value:1},17143:{name:"ebmlReadVersion",value:1},17138:{name:"ebmlMaxIDWidth",value:1},17139:{name:"ebmlMaxSizeWidth",value:1},17026:{name:"docType",value:0},17031:{name:"docTypeVersion",value:1},17029:{name:"docTypeReadVersion",value:1}}},408125543:{name:"segment",container:{290298740:{name:"seekHead",container:{19899:{name:"seek",multiple:!0,container:{21419:{name:"id",value:4},21420:{name:"position",value:1}}}}},357149030:{name:"info",container:{29604:{name:"uid",value:2},29572:{name:"filename",value:0},3979555:{name:"prevUID",value:2},3965867:{name:"prevFilename",value:0},4110627:{name:"nextUID",value:2},4096955:{name:"nextFilename",value:0},2807729:{name:"timecodeScale",value:1},17545:{name:"duration",value:5},17505:{name:"dateUTC",value:1},31657:{name:"title",value:0},19840:{name:"muxingApp",value:0},22337:{name:"writingApp",value:0}}},524531317:{name:"cluster",multiple:!0,container:{231:{name:"timecode",value:2},22743:{name:"silentTracks ",multiple:!0},167:{name:"position",value:2},171:{name:"prevSize",value:2},160:{name:"blockGroup"},163:{name:"simpleBlock"}}},374648427:{name:"tracks",container:{174:{name:"entries",multiple:!0,container:{215:{name:"trackNumber",value:1},29637:{name:"uid",value:2},131:{name:"trackType",value:1},185:{name:"flagEnabled",value:3},136:{name:"flagDefault",value:3},21930:{name:"flagForced",value:3},156:{name:"flagLacing",value:3},28135:{name:"minCache",value:1},28136:{name:"maxCache",value:1},2352003:{name:"defaultDuration",value:1},2306383:{name:"timecodeScale",value:5},21358:{name:"name",value:0},2274716:{name:"language",value:0},134:{name:"codecID",value:0},25506:{name:"codecPrivate",value:4},2459272:{name:"codecName",value:0},3839639:{name:"codecSettings",value:0},3883072:{name:"codecInfoUrl",value:0},2536e3:{name:"codecDownloadUrl",value:0},170:{name:"codecDecodeAll",value:3},28587:{name:"trackOverlay",value:1},224:{name:"video",container:{154:{name:"flagInterlaced",value:3},21432:{name:"stereoMode",value:1},176:{name:"pixelWidth",value:1},186:{name:"pixelHeight",value:1},21680:{name:"displayWidth",value:1},21690:{name:"displayHeight",value:1},21683:{name:"aspectRatioType",value:1},3061028:{name:"colourSpace",value:1},3126563:{name:"gammaValue",value:5}}},225:{name:"audio",container:{181:{name:"samplingFrequency",value:5},30901:{name:"outputSamplingFrequency",value:5},159:{name:"channels",value:1},148:{name:"channels",value:1},32123:{name:"channelPositions",value:4},25188:{name:"bitDepth",value:1}}},28032:{name:"contentEncodings",container:{25152:{name:"contentEncoding",container:{20529:{name:"order",value:1},20530:{name:"scope",value:3},20531:{name:"type",value:1},20532:{name:"contentEncoding",container:{16980:{name:"contentCompAlgo",value:1},16981:{name:"contentCompSettings",value:4}}},20533:{name:"contentEncoding",container:{18401:{name:"contentEncAlgo",value:1},18402:{name:"contentEncKeyID",value:4},18403:{name:"contentSignature ",value:4},18404:{name:"ContentSigKeyID  ",value:4},18405:{name:"contentSigAlgo ",value:1},18406:{name:"contentSigHashAlgo ",value:1}}},25188:{name:"bitDepth",value:1}}}}}}}}},475249515:{name:"cues",container:{187:{name:"cuePoint",container:{179:{name:"cueTime",value:2},183:{name:"positions",container:{247:{name:"track",value:1},241:{name:"clusterPosition",value:1},21368:{name:"blockNumber",value:1},234:{name:"codecState",value:1},219:{name:"reference",container:{150:{name:"time",value:1},151:{name:"cluster",value:1},21343:{name:"number",value:1},235:{name:"codecState",value:1}}},240:{name:"relativePosition",value:1}}}}}}},423732329:{name:"attachments",container:{24999:{name:"attachedFiles",multiple:!0,container:{18046:{name:"description",value:0},18030:{name:"name",value:0},18016:{name:"mimeType",value:0},18012:{name:"data",value:4},18094:{name:"uid",value:2}}}}},272869232:{name:"chapters",container:{17849:{name:"editionEntry",container:{182:{name:"chapterAtom",container:{29636:{name:"uid",value:2},145:{name:"timeStart",value:1},146:{name:"timeEnd",value:2},152:{name:"hidden",value:3},17816:{name:"enabled",value:2},143:{name:"track",container:{137:{name:"trackNumber",value:2},128:{name:"display",container:{133:{name:"string",value:0},17276:{name:"language ",value:0},17278:{name:"country ",value:0}}}}}}}}}}},307544935:{name:"tags",container:{29555:{name:"tag",multiple:!0,container:{25536:{name:"target",container:{25541:{name:"tagTrackUID",value:2},25540:{name:"tagChapterUID",value:1},25542:{name:"tagAttachmentUID",value:2},25546:{name:"targetType",value:0},26826:{name:"targetTypeValue",value:1},25545:{name:"tagEditionUID",value:2}}},26568:{name:"simpleTags",multiple:!0,container:{17827:{name:"name",value:0},17543:{name:"string",value:0},17541:{name:"binary",value:4},17530:{name:"language",value:0},17531:{name:"languageIETF",value:0},17540:{name:"default",value:3}}}}}}}}}}};var s=a(207),o=a(17),c=a(853),l=a(324);const u=i("music-metadata:parser:ebml");class m extends((0,l.fO)("EBML")){}class d{constructor(e){this.padding=0,this.parserMap=new Map,this.ebmlMaxIDLength=4,this.ebmlMaxSizeLength=8,this.tokenizer=e,this.parserMap.set(1,(e=>this.readUint(e))),this.parserMap.set(0,(e=>this.readString(e))),this.parserMap.set(4,(e=>this.readBuffer(e))),this.parserMap.set(2,(async e=>this.readBuffer(e))),this.parserMap.set(3,(e=>this.readFlag(e))),this.parserMap.set(5,(e=>this.readFloat(e)))}async iterate(e,t,a){return this.parseContainer(p(e),t,a)}async parseContainer(e,t,a){const i={};for(;this.tokenizer.position<t;){let r;const n=this.tokenizer.position;try{r=await this.readElement()}catch(e){if(e instanceof c.d1)break;throw e}const s=e.container[r.id];if(s)switch(a.startNext(s)){case 0:if(r.id,u(`Read element: name=${f(s)}{id=0x${r.id.toString(16)}, container=${!!s.container}} at position=${n}`),s.container){const e=await this.parseContainer(s,r.len>=0?this.tokenizer.position+r.len:-1,a);s.multiple?(i[s.name]||(i[s.name]=[]),i[s.name].push(e)):i[s.name]=e,await a.elementValue(s,e,n)}else{const e=this.parserMap.get(s.value);if("function"==typeof e){const t=await e(r);i[s.name]=t,await a.elementValue(s,t,n)}}break;case 5:u(`Go to next element: name=${f(s)}, element.id=0x${r.id}, container=${!!s.container} at position=${n}`);break;case 2:u(`Ignore element: name=${f(s)}, element.id=0x${r.id}, container=${!!s.container} at position=${n}`),await this.tokenizer.ignore(r.len);break;case 3:u(`Ignore remaining container, at: name=${f(s)}, element.id=0x${r.id}, container=${!!s.container} at position=${n}`),await this.tokenizer.ignore(t-this.tokenizer.position);break;case 4:return u(`Terminate parsing at element: name=${f(s)}, element.id=0x${r.id}, container=${!!s.container} at position=${n}`),i}else 236===r.id?(this.padding+=r.len,await this.tokenizer.ignore(r.len)):(u(`parseEbml: parent=${f(e)}, unknown child: id=${r.id.toString(16)} at position=${n}`),this.padding+=r.len,await this.tokenizer.ignore(r.len))}return i}async readVintData(e){const t=await this.tokenizer.peekNumber(o.UINT8);let a=128,i=1;for(;!(t&a);){if(i>e)throw new m("VINT value exceeding maximum size");++i,a>>=1}const r=new Uint8Array(i);return await this.tokenizer.readBuffer(r),r}async readElement(){const e=await this.readVintData(this.ebmlMaxIDLength),t=await this.readVintData(this.ebmlMaxSizeLength);return t[0]^=128>>t.length-1,{id:h(e,e.length),len:h(t,t.length)}}async readFloat(e){switch(e.len){case 0:return 0;case 4:return this.tokenizer.readNumber(o.Float32_BE);case 8:case 10:return this.tokenizer.readNumber(o.Float64_BE);default:throw new m(`Invalid IEEE-754 float length: ${e.len}`)}}async readFlag(e){return 1===await this.readUint(e)}async readUint(e){return h(await this.readBuffer(e),e.len)}async readString(e){return(await this.tokenizer.readToken(new o.StringType(e.len,"utf-8"))).replace(/\x00.*$/g,"")}async readBuffer(e){const t=new Uint8Array(e.len);return await this.tokenizer.readBuffer(t),t}}function h(e,t){return Number(function(e,t){const a=new Uint8Array(8),i=e.subarray(0,t);try{return a.set(i,8-t),o.UINT64_BE.get(a,0)}catch(e){return BigInt(-1)}}(e,t))}function p(e){return e.container&&Object.keys(e.container).map((t=>{const a=e.container[t];return a.id=Number.parseInt(t),a})).forEach((t=>{t.parent=e,p(t)})),e}function f(e){let t="";return e.parent&&"dtd"!==e.parent.name&&(t+=`${f(e.parent)}/`),t+e.name}const g=i("music-metadata:parser:matroska");class k extends r.s{constructor(){super(...arguments),this.seekHeadOffset=0,this.flagUseIndexToSkipClusters=this.options.mkvUseIndex??!1}async parse(){const e=this.tokenizer.fileInfo.size??Number.MAX_SAFE_INTEGER,t=new d(this.tokenizer);g("Initializing DTD end MatroskaIterator"),await t.iterate(n,e,{startNext:e=>{switch(e.id){case 475249515:return g(`Skip element: name=${e.name}, id=0x${e.id.toString(16)}`),2;case 524531317:if(this.flagUseIndexToSkipClusters&&this.seekHead){const e=this.seekHead.seek.find((e=>e.position+this.seekHeadOffset>this.tokenizer.position));if(e){const t=e.position+this.seekHeadOffset-this.tokenizer.position;return g(`Use index to go to next position, ignoring ${t} bytes`),this.tokenizer.ignore(t),5}}return 2;default:return 0}},elementValue:async(e,t,a)=>{switch(g(`Received: name=${e.name}, value=${t}`),e.id){case 17026:this.metadata.setFormat("container",`EBML/${t}`);break;case 290298740:this.seekHead=t,this.seekHeadOffset=a;break;case 357149030:{const e=t,a=e.timecodeScale?e.timecodeScale:1e6;if("number"==typeof e.duration){const t=e.duration*a/1e9;await this.addTag("segment:title",e.title),this.metadata.setFormat("duration",Number(t))}}break;case 374648427:{const e=t;if(e?.entries){e.entries.forEach((e=>{const t={codecName:e.codecID.replace("A_","").replace("V_",""),codecSettings:e.codecSettings,flagDefault:e.flagDefault,flagLacing:e.flagLacing,flagEnabled:e.flagEnabled,language:e.language,name:e.name,type:e.trackType,audio:e.audio,video:e.video};this.metadata.addStreamInfo(t)}));const t=e.entries.filter((e=>e.trackType===s.S.audio)).reduce(((e,t)=>e?t.flagDefault&&!e.flagDefault||t.trackNumber<e.trackNumber?t:e:t),null);t&&(this.metadata.setFormat("codec",t.codecID.replace("A_","")),this.metadata.setFormat("sampleRate",t.audio.samplingFrequency),this.metadata.setFormat("numberOfChannels",t.audio.channels))}}break;case 307544935:{const e=t;await Promise.all(e.tag.map((async e=>{const t=e.target,a=t?.targetTypeValue?s.yK[t.targetTypeValue]:t?.targetType?t.targetType:"track";await Promise.all(e.simpleTags.map((async e=>{const t=e.string?e.string:e.binary;await this.addTag(`${a}:${e.name}`,t)})))})))}break;case 423732329:{const e=t;await Promise.all(e.attachedFiles.filter((e=>e.mimeType.startsWith("image/"))).map((e=>this.addTag("picture",{data:e.data,format:e.mimeType,description:e.description,name:e.name}))))}}}})}async addTag(e,t){await this.metadata.addTag("matroska",e,t)}}},984:(e,t,a)=>{"use strict";a.r(t),a.d(t,{MusepackParser:()=>S});var i=a(833),r=a(17),n=a(481),s=a(604),o=a(283),c=a(31),l=a(185);const u=i("music-metadata:parser:musepack:sv8"),m=new r.StringType(2,"latin1"),d={len:5,get:(e,t)=>({crc:r.UINT32_LE.get(e,t),streamVersion:r.UINT8.get(e,t+4)})},h={len:2,get:(e,t)=>({sampleFrequency:[44100,48e3,37800,32e3][l.f5(e,t,0,3)],maxUsedBands:l.f5(e,t,3,5),channelCount:l.f5(e,t+1,0,4)+1,msUsed:l.cD(e,t+1,4),audioBlockFrames:l.f5(e,t+1,5,3)})};class p{get tokenizer(){return this._tokenizer}set tokenizer(e){this._tokenizer=e}constructor(e){this._tokenizer=e}async readPacketHeader(){const e=await this.tokenizer.readToken(m),t=await this.readVariableSizeField();return{key:e,payloadLength:t.value-2-t.len}}async readStreamHeader(e){const t={};u(`Reading SH at offset=${this.tokenizer.position}`);const a=await this.tokenizer.readToken(d);e-=d.len,Object.assign(t,a),u(`SH.streamVersion = ${a.streamVersion}`);const i=await this.readVariableSizeField();e-=i.len,t.sampleCount=i.value;const r=await this.readVariableSizeField();e-=r.len,t.beginningOfSilence=r.value;const n=await this.tokenizer.readToken(h);return e-=h.len,Object.assign(t,n),await this.tokenizer.ignore(e),t}async readVariableSizeField(e=1,t=0){let a=await this.tokenizer.readNumber(r.UINT8);return 128&a?(a&=127,a+=t,this.readVariableSizeField(e+1,a<<7)):{len:e,value:t+a}}}var f=a(324);class g extends((0,f.fO)("Musepack")){}const k=i("music-metadata:parser:musepack");class T extends s.s{constructor(){super(...arguments),this.audioLength=0}async parse(){if("MPCK"!==await this.tokenizer.readToken(c.e))throw new g("Invalid Magic number");return this.metadata.setFormat("container","Musepack, SV8"),this.parsePacket()}async parsePacket(){const e=new p(this.tokenizer);for(;;){const t=await e.readPacketHeader();switch(k(`packet-header key=${t.key}, payloadLength=${t.payloadLength}`),t.key){case"SH":{const a=await e.readStreamHeader(t.payloadLength);this.metadata.setFormat("numberOfSamples",a.sampleCount),this.metadata.setFormat("sampleRate",a.sampleFrequency),this.metadata.setFormat("duration",a.sampleCount/a.sampleFrequency),this.metadata.setFormat("numberOfChannels",a.channelCount);break}case"AP":this.audioLength+=t.payloadLength,await this.tokenizer.ignore(t.payloadLength);break;case"RG":case"EI":case"SO":case"ST":case"CT":await this.tokenizer.ignore(t.payloadLength);break;case"SE":return this.metadata.format.duration&&this.metadata.setFormat("bitrate",8*this.audioLength/this.metadata.format.duration),o.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options);default:throw new g(`Unexpected header: ${t.key}`)}}}}class b{constructor(e){this.pos=0,this.dword=null,this.tokenizer=e}async read(e){for(;null===this.dword;)this.dword=await this.tokenizer.readToken(r.UINT32_LE);let t=this.dword;return this.pos+=e,this.pos<32?(t>>>=32-this.pos,t&(1<<e)-1):(this.pos-=32,0===this.pos?(this.dword=null,t&(1<<e)-1):(this.dword=await this.tokenizer.readToken(r.UINT32_LE),this.pos&&(t<<=this.pos,t|=this.dword>>>32-this.pos),t&(1<<e)-1))}async ignore(e){if(this.pos>0){const t=32-this.pos;this.dword=null,e-=t,this.pos=0}const t=e%32,a=(e-t)/32;return await this.tokenizer.ignore(4*a),this.read(t)}}const w={len:24,get:(e,t)=>{const a={signature:new TextDecoder("latin1").decode(e.subarray(t,t+3)),streamMinorVersion:l.f5(e,t+3,0,4),streamMajorVersion:l.f5(e,t+3,4,4),frameCount:r.UINT32_LE.get(e,t+4),maxLevel:r.UINT16_LE.get(e,t+8),sampleFrequency:[44100,48e3,37800,32e3][l.f5(e,t+10,0,2)],link:l.f5(e,t+10,2,2),profile:l.f5(e,t+10,4,4),maxBand:l.f5(e,t+11,0,6),intensityStereo:l.cD(e,t+11,6),midSideStereo:l.cD(e,t+11,7),titlePeak:r.UINT16_LE.get(e,t+12),titleGain:r.UINT16_LE.get(e,t+14),albumPeak:r.UINT16_LE.get(e,t+16),albumGain:r.UINT16_LE.get(e,t+18),lastFrameLength:r.UINT32_LE.get(e,t+20)>>>20&2047,trueGapless:l.cD(e,t+23,0)};return a.lastFrameLength=a.trueGapless?r.UINT32_LE.get(e,20)>>>20&2047:0,a}},y=i("music-metadata:parser:musepack");class I extends s.s{constructor(){super(...arguments),this.bitreader=null,this.audioLength=0,this.duration=null}async parse(){const e=await this.tokenizer.readToken(w);if("MP+"!==e.signature)throw new g("Unexpected magic number");y(`stream-version=${e.streamMajorVersion}.${e.streamMinorVersion}`),this.metadata.setFormat("container","Musepack, SV7"),this.metadata.setFormat("sampleRate",e.sampleFrequency);const t=1152*(e.frameCount-1)+e.lastFrameLength;this.metadata.setFormat("numberOfSamples",t),this.duration=t/e.sampleFrequency,this.metadata.setFormat("duration",this.duration),this.bitreader=new b(this.tokenizer),this.metadata.setFormat("numberOfChannels",e.midSideStereo||e.intensityStereo?2:1);const a=await this.bitreader.read(8);return this.metadata.setFormat("codec",(a/100).toFixed(2)),await this.skipAudioData(e.frameCount),y(`End of audio stream, switching to APEv2, offset=${this.tokenizer.position}`),o.APEv2Parser.tryParseApeHeader(this.metadata,this.tokenizer,this.options)}async skipAudioData(e){for(;e-- >0;){const e=await this.bitreader.read(20);this.audioLength+=20+e,await this.bitreader.ignore(e)}const t=await this.bitreader.read(11);this.audioLength+=t,null!==this.duration&&this.metadata.setFormat("bitrate",this.audioLength/this.duration)}}const v=i("music-metadata:parser:musepack");class S extends n.k{async postId3v2Parse(){let e;switch(await this.tokenizer.peekToken(new r.StringType(3,"latin1"))){case"MP+":v("Stream-version 7"),e=new I(this.metadata,this.tokenizer,this.options);break;case"MPC":v("Stream-version 8"),e=new T(this.metadata,this.tokenizer,this.options);break;default:throw new g("Invalid signature prefix")}return e.parse()}}}}]);